title: Potential Qakbot Registry Activity
id: 1c8e96cd-2bed-487d-9de0-b46c90cade56
status: test
description: Detects a registry key used by IceID in a campaign that distributes malicious
  OneNote files
references:
- https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution
author: Hieu Tran
date: 2023-03-13
tags:
- attack.defense-evasion
- attack.t1112
logsource:
  category: registry_event
  product: windows
detection:
  selection:
    TargetObject|endswith: '\Software\firm\soft\Name'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potential malicious activity associated with the Qakbot malware by monitoring specific registry changes on Windows systems. It specifically looks for alterations or access to a registry key that typically signifies the presence of IceID malware, which is known to distribute malicious OneNote files as part of its campaign. The rule captures events related to registry modifications, particularly those targeting the key located at `\Software\firm\soft\Name`. When such activity is detected, it may indicate that Qakbot is attempting to establish persistence or execute further malicious actions on the compromised system.
  The primary technical data source leveraged for this detection is the Windows registry event logs. By monitoring these logs, security teams can identify suspicious modifications that could signal a breach or an ongoing attack. Investigating these detected events can provide valuable insights into potential infection vectors and network behavior, allowing for timely incident response measures.
  ### Investigation Steps
  - Utilize Endpoint Detection and Response (EDR) tools to track the processes associated with the registry modification to identify any related suspicious activity.
  - Examine Windows event logs for additional context surrounding the registry changes, focusing on user and system events around the time of the activity.
  - Query antivirus logs and detections to determine if there are any known signatures or blocks related to Qakbot or IceID.
  - Analyze network traffic logs through Next-Generation Firewalls (NGFW) or Network Detection and Response (NDR) tools to identify any unusual outbound connections or data exfiltration attempts linked to the affected endpoint.
