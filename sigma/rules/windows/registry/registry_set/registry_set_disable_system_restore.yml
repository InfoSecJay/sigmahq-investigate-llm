title: Registry Disable System Restore
id: 5de03871-5d46-4539-a82d-3aa992a69a83
status: test
description: Detects the modification of the registry to disable a system restore
  on the computer
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-9---disable-system-restore-through-registry
author: frack113
date: 2022-04-04
modified: 2023-08-17
tags:
- attack.impact
- attack.t1490
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    TargetObject|contains:
    - '\Policies\Microsoft\Windows NT\SystemRestore'
    - '\Microsoft\Windows NT\CurrentVersion\SystemRestore'
    TargetObject|endswith:
    - DisableConfig
    - DisableSR
    Details: 'DWORD (0x00000001)'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  The "Registry Disable System Restore" Sigma rule detects unauthorized modifications to the Windows registry that disable the System Restore feature. Specifically, it looks for entries in the registry paths related to System Restore where the value for "DisableConfig" or "DisableSR" is set to `1`. The System Restore feature is critical for recovery in case of system failure, and altering this setting can be indicative of malicious activity aimed at making a system more difficult to restore or investigate post-compromise. The data sources involved in this detection include Windows Security Event Logs, particularly those that audit registry changes. This rule aligns with the MITRE ATT&CK technique T1490 (Inhibiting System Recovery) under the Impact tactic, where adversaries seek to disrupt system recovery processes to hinder investigation efforts.
  ### Investigation Steps
  - **Check Registry Logs:** Use the Windows Event Logs to identify when the registry modifications occurred and determine the responsible process or user account.
  - **Validate Alert Context:** Cross-reference the alert with contextual logs from EDR tools to understand the execution context around the time of the registry change.
  - **Assess System Restore Points:** Investigate existing restore points to establish if any pre-existing states can be used for recovery.
  - **Evaluate User Activity:** Review user activity logs in Windows Security to establish if any authorized changes to the System Restore feature were made prior to the change.
  ### Prioritization
  Given that disabling System Restore dramatically impacts an organization's ability to recover from infections or data loss, alerts generated by this rule are assigned a high severity level.
  ### Blind Spots and Assumptions
  This rule assumes proper logging is enabled for registry changes and may not fire if registry auditing is not configured. Adversaries may employ techniques that utilize legitimate accounts or tools to modify registry settings discreetly, leading to potential evasion of this detection. Additionally, there may be benign scenarios where system administrators disable System Restore for legitimate reasons, which could lead to false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
