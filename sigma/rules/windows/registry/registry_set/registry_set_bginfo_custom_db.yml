title: New BgInfo.EXE Custom DB Path Registry Configuration
id: 53330955-dc52-487f-a3a2-da24dcff99b5
status: test
description: Detects setting of a new registry database value related to BgInfo configuration.
  Attackers can for example set this value to save the results of the commands executed
  by BgInfo in order to exfiltrate information.
references:
- Internal Research
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-08-16
tags:
- attack.defense-evasion
- attack.t1112
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    EventType: SetValue
    TargetObject|endswith: '\Software\Winternals\BGInfo\Database'
  condition: selection
falsepositives:
- Legitimate use of external DB to save the results
level: medium
notes: |
  n
  ### Technical Context
  The rule "New BgInfo.EXE Custom DB Path Registry Configuration" is designed to detect changes to the Windows Registry that may indicate a potential security threat involving the BgInfo application. Specifically, it monitors for `SetValue` events targeting the registry path associated with BgInfo's database configurations. Attackers may exploit this setting to redirect outputs or command results generated by BgInfo to an unauthorized location, allowing them to exfiltrate sensitive information undetected. The primary data source for this detection is the Windows Registry, which logs relevant modifications in the system. This rule aligns with the MITRE ATT&CK technique for Defense Evasion (T1112).
  ### Investigation Steps
  - **Check Registry Logs**: Utilize Windows Security/Event logs to verify if the registry modification coincides with other suspicious activities, especially around process creation events that could leverage BgInfo.
  - **Correlate with EDR Data**: Review endpoint detection and response logs for any related processes initiated by BgInfo before or after the registry modification.
  - **Assess User Context**: Identify the user account that made the registry change by examining the event's metadata to analyze its normal activity and motive.
  - **Cross-Verify with Network Logs**: Inspect network connection logs, especially DNS queries and other outbound traffic, to determine if any exfiltration attempts occurred post-registry modification.
  ### Prioritization
  The alert is rated as medium severity, as while legitimate use cases for BgInfo exist, unauthorized modifications to its configuration could signify an adversaryâ€™s attempt to exfiltrate sensitive data, warranting immediate investigative actions.
  ### Blind Spots and Assumptions
  This detection rule may not fire if the adversary uses legitimate accounts to modify the registry, masking malicious intent. Additionally, if BgInfo is uninstalled or not present on the endpoint, the rule will not trigger. There is an assumption that admins are aware of all legitimate usage of BgInfo, but in heterogeneous environments, this may not be true, leading to false negatives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
