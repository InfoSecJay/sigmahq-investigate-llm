title: Disable PUA Protection on Windows Defender
id: 8ffc5407-52e3-478f-9596-0a7371eafe13
status: test
description: Detects disabling Windows Defender PUA protection
references:
- https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html
author: Austin Songer @austinsonger
date: 2021-08-04
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1562.001
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    TargetObject|contains: '\Policies\Microsoft\Windows Defender\PUAProtection'
    Details: 'DWORD (0x00000000)'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This Sigma rule is designed to detect when the Potentially Unwanted Application (PUA) protection feature of Windows Defender is disabled on Windows systems. The rule specifically monitors registry changes indicating the alteration of PUA protection settings, looking for modifications to the key located at `\Policies\Microsoft\Windows Defender\PUAProtection`, where the value is set to 'DWORD (0x00000000)', signifying that PUA protection is turned off. Such an action can facilitate the execution of malicious software that may otherwise be blocked, thereby constituting a technique of defense evasion (MITRE ATT&CK technique T1562.001). By analyzing the registry logs, security teams can identify unauthorized changes that may signify broader compromise activity.
  ### Investigation Steps
  - **Check Registry Logs:** Utilize Windows Security logs to confirm the exact time and user involved in disabling PUA protection by querying the registry changes recorded by Sysmon or Event Viewer.
  - **Analyze Process Activity:** Investigate whether any processes executed around the same time attempt to exploit the disabled PUA protection, leveraging EDR tools to view process creation and command-line arguments.
  - **Review EDR Alerts:** Look for any alerts from EDR regarding unusual activities, or behavioral indicators related to PUA or related malware executables post the registry change.
  - **Correlate with Network Traffic:** Inspect proxy or firewall logs for unusual outbound connections indicating potential malware attempts outside normal user behavior.
  ### Prioritization
  As disabling PUA protection is considered a significant security risk, an alert generated by this rule is prioritized as high severity. This action can enable malware to operate unchecked, posing a major threat to the enterprise's security posture.
  ### Blind Spots and Assumptions
  This rule may not fire if the registry change is performed by a user with administrative privileges or via a legitimate software application that has permissions to alter system settings. Additionally, if an attacker employs advanced techniques to bypass logging or uses tools that do not trigger this specific registry event, the detection may not occur. Engineers should remain aware that this rule's effectiveness depends on proper logging configuration and the typical behavior of users and applications within the enterprise.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
