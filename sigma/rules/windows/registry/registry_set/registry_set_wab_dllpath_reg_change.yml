title: Execution DLL of Choice Using WAB.EXE
id: fc014922-5def-4da9-a0fc-28c973f41bfb
status: test
description: This rule detects that the path to the DLL written in the registry is
  different from the default one. Launched WAB.exe tries to load the DLL from Registry.
references:
- https://github.com/LOLBAS-Project/LOLBAS/blob/8283d8d91552213ded165fd36deb6cb9534cb443/yml/OSBinaries/Wab.yml
- https://twitter.com/Hexacorn/status/991447379864932352
- http://www.hexacorn.com/blog/2018/05/01/wab-exe-as-a-lolbin/
author: oscd.community, Natalia Shornikova
date: 2020-10-13
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1218
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    TargetObject|endswith: '\Software\Microsoft\WAB\DLLPath'
  filter:
    Details: '%CommonProgramFiles%\System\wab32.dll'
  condition: selection and not filter
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This detection rule identifies a potentially malicious use of the Windows Address Book (WAB) executable, WAB.EXE. The rule specifically monitors for modifications in the Windows Registry that deviate from the standard path for the WAB dynamic link library (DLL). When WAB.EXE is executed, it typically attempts to load a DLL located at the default path `%CommonProgramFiles%\System\wab32.dll`. The rule detects cases where a different DLL path is registered, which may indicate an attempt to load a malicious DLL in order to execute unauthorized actions on the system. This behavior aligns with the MITRE ATT&CK technique [T1218: Signed Binary Proxy Execution], which describes how adversaries may leverage legitimate binaries to execute their own payloads while evading detection.
  ### Investigation Steps
  - **Check Registry Modifications:** Utilize Windows Event Logs to review any changes made to the `HKEY_CURRENT_USER\Software\Microsoft\WAB\DLLPath` registry key, identifying any suspicious DLL paths that differ from the expected default.
  - **Examine Process Activity:** Utilize EDR tools to monitor the execution history of WAB.EXE, focusing on command-line arguments and parent processes to identify any irregularities or unusual execution patterns.
  - **Analyze Network Connections:** Investigate network logs (from NDR/NGFW) linked to the execution of WAB.EXE to identify any outbound connections that may suggest command and control communications or data exfiltration.
  - **Review DLL Integrity:** Use antivirus and file integrity monitoring tools to examine the loaded DLLs associated with WAB.EXE for any known malware signatures or deviations from expected file hashes.
  ### Prioritization
  Alerts generated by this rule are categorized as high severity due to the potential for adversaries to use trusted system binaries to load malicious code, which can lead to significant data breaches or system compromise in an enterprise environment.
  ### Blind Spots and Assumptions
  This rule may not fire if the registry changes are performed by an administrator with sufficient permissions, as they may not be logged as suspicious activity. Additionally, the rule assumes that any malicious DLL will be registered explicitly but may not account for situations where an adversary modifies less common execution paths or relies on in-memory execution tactics. It may also be defeated through the use of obfuscation or other methods that mask changes in the expected behavior of WAB.EXE.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
