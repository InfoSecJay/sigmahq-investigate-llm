title: NET NGenAssemblyUsageLog Registry Key Tamper
id: 28036918-04d3-423d-91c0-55ecf99fb892
status: test
description: |
  Detects changes to the NGenAssemblyUsageLog registry key.
  .NET Usage Log output location can be controlled by setting the NGenAssemblyUsageLog CLR configuration knob in the Registry or by configuring an environment variable (as described in the next section).
  By simplify specifying an arbitrary value (e.g. fake output location or junk data) for the expected value, a Usage Log file for the .NET execution context will not be created.
references:
- https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/
author: frack113
date: 2022-11-18
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1112
logsource:
  product: windows
  category: registry_set
detection:
  selection:
    TargetObject|endswith: 'SOFTWARE\Microsoft\.NETFramework\NGenAssemblyUsageLog'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The Sigma rule titled "NET NGenAssemblyUsageLog Registry Key Tamper" is designed to detect unauthorized modifications to the NGenAssemblyUsageLog registry key on Windows systems. The NGenAssemblyUsageLog is a component of the .NET framework, which logs data about the usage of native images. By altering this registry key, an attacker can prevent the generation of the usage log, thereby evading detection mechanisms that rely on these logs for monitoring .NET application execution. The rule specifically looks for changes made to the registry key `SOFTWARE\Microsoft\.NETFramework\NGenAssemblyUsageLog`, which can be indicative of an adversary attempting to mask their activities and evade defenses.
  This detection aligns with the MITRE ATT&CK framework under the tactic of "Defense Evasion" and technique "T1112: Modify Registry." The detection leverages Windows Registry change logs, which provide a critical telemetry source for identifying potential tampering and unauthorized activity. Analysts should view alerts generated by this rule as actionable indicators necessitating further investigation.
  ### Investigation Steps
  - **Review Registry Changes**: Utilize Windows Security Event Logs to check for recent `RegistrySetValue` events that target the `NGenAssemblyUsageLog` key, correlating with the time of the alert.
  - **Check EDR for Process Activity**: Query your EDR solution to analyze process creation activities around the time of registry modification, focusing on processes that may exhibit unusual behavior or command line arguments.
  - **Analyze Event Logs**: Inspect Sysmon logs for further context on the processes that accessed or modified the registry, particularly any suspicious parent-child relationships.
  - **Network Traffic Inspection**: Review network logs to identify any suspicious outbound connections or attempts that may correlate with the activities of the altered registry key, indicating a potential exploit or data exfiltration.
  ### Prioritization
  The alert is categorized as high severity as unauthorized modifications to the NGenAssemblyUsageLog registry key can indicate attempts by adversaries to bypass detection, which is a serious threat in an enterprise environment that could lead to undetected compromises.
  ### Blind Spots and Assumptions
  One recognized blind spot is the possibility that legitimate applications might modify the NGenAssemblyUsageLog registry key for valid purposes, leading to false positives. Additionally, if an attacker uses a technique that does not involve direct registry modifications, such as targeting different configuration files, this rule would not trigger. It assumes that the monitoring of the registry is robust and that relevant logs are being captured consistently; if log collection is incomplete or delayed, legitimate threats may go undetected.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
