title: Potential Attachment Manager Settings Associations Tamper
id: a9b6c011-ab69-4ddb-bc0a-c4f21c80ec47
status: test
description: Detects tampering with attachment manager settings policies associations
  to lower the default file type risks (See reference for more information)
references:
- https://support.microsoft.com/en-us/topic/information-about-the-attachment-manager-in-microsoft-windows-c48a4dcd-8de5-2af5-ee9b-cd795ae42738
- https://www.virustotal.com/gui/file/2bcd5702a7565952c44075ac6fb946c7780526640d1264f692c7664c02c68465
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-08-01
modified: 2023-08-17
tags:
- attack.defense-evasion
logsource:
  category: registry_set
  product: windows
detection:
  selection_main:
    TargetObject|contains: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Associations\'
  selection_value_default_file_type_rsik:
    TargetObject|endswith: '\DefaultFileTypeRisk'
    Details: 'DWORD (0x00006152)'
  selection_value_low_risk_filetypes:
    TargetObject|endswith: '\LowRiskFileTypes'
    Details|contains:     # Add more as you see fit
    - '.zip;'
    - '.rar;'
    - '.exe;'
    - '.bat;'
    - '.com;'
    - '.cmd;'
    - '.reg;'
    - '.msi;'
    - '.htm;'
    - '.html;'
  condition: selection_main and 1 of selection_value_*
falsepositives:
- Unlikely
level: high
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potential tampering with the Attachment Manager settings within Windows environments. The Attachment Manager is a security feature in Microsoft Windows that assists in managing file types and their associated risks by controlling how specific file types are handled and informing users of potentially unsafe files. The rule examines registry modification events that target specific keys associated with the Attachment Manager policies, particularly those related to default file type risks and low-risk file types. By monitoring these registry keys, security analysts can identify suspicious changes that could lower the security postures of file handling mechanisms, which are crucial in preventing malware and other risks. This detection falls under the MITRE ATT&CK framework's tactic of "Defense Evasion," specifically focusing on techniques that could be utilized by adversaries trying to bypass security mechanisms.
  ### Investigation Steps
  - **Check Registry Logs:** Review recent Windows registry change logs in your EDR to identify any unauthorized edits to the Attachment Manager settingsâ€”specifically under `\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Associations\`.
  - **Analyze User Activity:** Utilize Windows Event Logs to determine which user account made changes to the registry and assess whether these actions are legitimate or suspicious in nature.
  - **Correlate with Process Creation Events:** Investigate process creation logs to identify any associated processes that executed around the same time as the registry changes, looking for unusual behavior or known malicious indicators.
  - **Review File Activity:** Inspect any file activity around the time of the registry modification, especially for files that are known to be a risk or are commonly exploited by malware (e.g., .exe, .zip, .rar).
  ### Prioritization
  Alerts generated by this rule are considered high severity due to the potential for significant risk posed by lowering file type protections, which exposes the environment to malware and unauthorized access.
  ### Blind spots and Assumptions
  Alerts may not trigger if an adversary uses a legitimate account to make registry modifications, thus hiding their activity among normal user actions. Additionally, if registry auditing is disabled or not correctly configured, relevant changes might not be logged, leading to potential blind spots for monitoring. Moreover, if attackers utilize methods to bypass standard logging frameworks (e.g., direct memory manipulation or other advanced evasion techniques), this rule may fail to detect their actions.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
