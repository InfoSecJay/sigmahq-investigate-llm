title: Potential Provisioning Registry Key Abuse For Binary Proxy Execution - REG
id: 7021255e-5db3-4946-a8b9-0ba7a4644a69
related:
- id: 7f5d1c9a-3e83-48df-95a7-2b98aae6c13c     # CLI Generic
  type: similar
- id: f9999590-1f94-4a34-a91e-951e47bedefd     # CLI Abuse
  type: similar
- id: 2a4b3e61-9d22-4e4a-b60f-6e8f0cde6f25     # CLI Registry
  type: similar
status: test
description: Detects potential abuse of the provisioning registry key for indirect
  command execution through "Provlaunch.exe".
references:
- https://lolbas-project.github.io/lolbas/Binaries/Provlaunch/
- https://twitter.com/0gtweet/status/1674399582162153472
author: Swachchhanda Shrawan Poudel
date: 2023-08-02
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1218
logsource:
  category: registry_set
  product: windows
  definition: 'Requirements: The registry key "\SOFTWARE\Microsoft\Provisioning\Commands\"
    and its subkey must be monitored'
detection:
  selection:
    TargetObject|contains: '\SOFTWARE\Microsoft\Provisioning\Commands\'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  This detection rule aims to identify the abuse of the provisioning registry key associated with `Provlaunch.exe`. Adversaries may utilize this key for executing commands indirectly, a tactic that falls under the MITRE ATT&CK framework Tactic: Defense Evasion (Technique T1218). By monitoring modifications to the registry path `\SOFTWARE\Microsoft\Provisioning\Commands\`, the rule captures instances where potentially malicious activity occurs.
  The rule inspects changes made to registry keys, specifically looking for entries that target the aforementioned path. When processes leverage `Provlaunch.exe`, they can execute arbitrary commands indirectly from the registry, making this monitoring necessary for early detection of potential threats. The main technical data sources involved in this rule include Windows Registry logs that record the creation of registry keys and related modifications.
  ### Investigation Steps
  - **Verify the Registry Change**: Utilize a registry monitoring tool or EDR to locate the specific changes made under `\SOFTWARE\Microsoft\Provisioning\Commands\`. Confirm that the timing and context align with legitimate administrative activities.
  - **Correlate with Process Activity**: Check Windows Security Event Logs or Sysmon logs for any process creation events linked to `Provlaunch.exe` around the time of the registry modification to investigate the legitimacy of the command execution.
  - **Examine Network Activity**: Utilize the EDR or NDR tools to check for any network connections initiated by the `Provlaunch.exe` process. This can help identify whether any unusual outbound communications were made following registry changes.
  - **Review Related User Activity**: Analyze user activities logged via Windows Event Logs to check if the user associated with the registry modification and command execution has legitimate reasons for those actions.
  ### Prioritization
  Alerts generated by this rule are marked high severity due to the potential for adversaries to execute arbitrary commands on a target system, launching subtle attacks that can circumvent traditional defenses.
  ### Blind Spots and Assumptions
  This rule assumes that modifications to the relevant registry key will be logged appropriately. If a malicious actor uses other techniques to disguise or clear evidence of their activity in the registry, such as utilizing admin-level privileges or other tools to manipulate logs, the detection might fail to trigger. Furthermore, if a legitimate application uses the `Provlaunch.exe` process in a way that mimics malicious behavior, false positives may occur.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
