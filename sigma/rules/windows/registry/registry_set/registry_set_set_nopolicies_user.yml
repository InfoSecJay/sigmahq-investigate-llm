title: Registry Explorer Policy Modification
id: 1c3121ed-041b-4d97-a075-07f54f20fb4a
status: test
description: Detects registry modifications that disable internal tools or functions
  in explorer (malware like Agent Tesla uses this technique)
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md
author: frack113
date: 2022-03-18
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1112
logsource:
  category: registry_set
  product: windows
detection:
  selection_set_1:
    TargetObject|endswith:
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoLogOff'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoDesktop'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoRun'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoFind'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoControlPanel'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoFileMenu'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoClose'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoSetTaskbar'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoPropertiesMyDocuments'
    - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoTrayContextMenu'
    Details: 'DWORD (0x00000001)'
  condition: selection_set_1
falsepositives:
- Legitimate admin script
level: medium
notes: |
  ### Technical Context
  The "Registry Explorer Policy Modification" detection rule identifies unauthorized modifications to critical registry keys that can disable key functionalities of the Windows Explorer interface. Such modifications may serve as tactics employed by malicious actors, particularly malware such as Agent Tesla, to impair system usability and facilitate further evasion. The rule specifically monitors the Windows Registry for changes to certain "Policies\Explorer" entriesâ€”these entries govern fundamental Explorer behaviors such as access to the control panel, desktop visibility, and the taskbar context menu. The rule utilizes registry set logs generated by Windows, focusing on entries that are commonly manipulated during nefarious campaigns, signaling possible defense evasion attempts as per the MITRE ATT&CK technique T1112 (Modify Registry). 
  ### Investigation Steps
  - **Check Registry Logs:** Utilize Sysmon or Windows Event Logs to review the registry set events and confirm the changes made to the targeted "Policies\Explorer" keys. Pay attention to the timing and user context of these modifications.
  - **Analyze Process Activity:** Use EDR tools to assess process creation and execution times surrounding the registry modifications. Identify any suspicious processes that accessed or modified the registry keys, especially those not typically associated with genuine administrative actions.
  - **Review Authentication and Access Control Logs:** Examine authentication logs to determine if an unauthorized user account or service executed the registry changes. Investigate if the account has a history of other questionable activity.
  - **Correlate with Other Security Tools:** Leverage SIEM and other security tools to cross-reference network traffic and endpoint logs for any signs of malicious activity correlating with the registry modification events. This can help uncover broader attack patterns.
  ### Prioritization
  Alerts from this rule should be treated with medium priority, as modifications of critical registry settings can indicate potential compromise or malicious activity. However, it is important to verify the context of such changes to rule out benign administrative actions.
  ### Blind Spots and Assumptions
  This rule may not trigger in scenarios where legitimate administrative scripts modify the registry without proper logging or where alternate means of registry modification are employed outside of standard Windows mechanisms. Additionally, it assumes that sufficient telemetry is enabled to capture registry changes, which may not be the case in all environments. Therefore, engineers should also consider other avenues of detection for similar malicious behaviors.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
