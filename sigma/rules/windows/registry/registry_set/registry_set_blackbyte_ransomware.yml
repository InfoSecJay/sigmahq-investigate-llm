title: Blackbyte Ransomware Registry
id: 83314318-052a-4c90-a1ad-660ece38d276
status: test
description: BlackByte set three different registry values to escalate privileges
  and begin setting the stage for lateral movement and encryption
references:
- https://redcanary.com/blog/blackbyte-ransomware/?utm_source=twitter&utm_medium=social
- https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/blackbyte-ransomware-pt-1-in-depth-analysis/
author: frack113
date: 2022-01-24
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1112
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    TargetObject:
    - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy
    - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLinkedConnections
    - HKLM\SYSTEM\CurrentControlSet\Control\FileSystem\LongPathsEnabled
    Details: DWORD (0x00000001)
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The Sigma rule titled "Blackbyte Ransomware Registry" is designed to detect a series of changes made to the Windows Registry that are indicative of BlackByte ransomware activity. Specifically, the rule looks for changes to three particular registry values that enable various system configurations aimed at escalating privileges, facilitating lateral movement, and preparing for data encryption. The registry keys targeted include `LocalAccountTokenFilterPolicy`, `EnableLinkedConnections`, and `LongPathsEnabled`, each of which plays a critical role in altering the systemâ€™s default security posture.
  When the BlackByte ransomware modifies these registry values, it is setting the stage for more severe stages of an attack, including lateral movement across systems and encryption of files. This activity aligns with the MITRE ATT&CK tactic of "Defense Evasion" (T1112) as it allows the malware to bypass certain protections and maintain persistence on the infected system. The primary data sources leveraged for this rule are Windows Registry logs, which provide direct visibility into registry modifications.
  ### Investigation Steps
  - **Collect Registry Logs:** Gather detailed logs from the Windows Registry focusing on the specified keys to verify if and when any unauthorized changes occurred.
  - **Evaluate Process Activity:** Check EDR for any suspicious process creations around the time of the registry modifications to identify potential malware activity or unauthorized access.
  - **Correlate with Network Activity:** Review network connection logs (NDR) during the timeline of the registry changes to uncover any unusual outbound traffic or connections made by the affected host.
  - **Assess User Activity:** Analyze Windows Security logs to determine if there are any abnormal logins or user account activities associated with the machines impacted by the registry modifications.
  ### Prioritization
  The alert generated by this detection rule is considered high severity due to the potential implications of registry modifications associated with ransomware activities. Such changes can lead to unauthorized access and significant data loss, making it critical for the SOC to investigate promptly.
  ### Blind spots and Assumptions
  The rule may not fire if registry logging is not enabled on the target systems or if administrative privileges are used to modify the registry without triggering standard logging mechanisms. Additionally, if the adversary employs techniques to obscure their tracks or utilize alternative paths to achieve their objectives, the rule might also fail to detect these activities. It is essential for detection engineers to be aware that sophisticated attackers might modify registry entries in ways that bypass traditional logging.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
