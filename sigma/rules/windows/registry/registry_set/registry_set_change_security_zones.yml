title: IE Change Domain Zone
id: 45e112d0-7759-4c2a-aa36-9f8fb79d3393
related:
- id: d88d0ab2-e696-4d40-a2ed-9790064e66b3
  type: derived
status: test
description: Hides the file extension through modification of the registry
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-4---add-domain-to-trusted-sites-zone
- https://learn.microsoft.com/en-us/troubleshoot/developer/browsers/security-privacy/ie-security-zones-registry-entries
author: frack113
date: 2022-01-22
modified: 2023-08-17
tags:
- attack.persistence
- attack.t1137
logsource:
  category: registry_set
  product: windows
detection:
  selection_domains:
    TargetObject|contains: \SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\
  filter:
    Details:
    - DWORD (0x00000000)         # My Computer
    - DWORD (0x00000001)         # Local Intranet Zone
    - '(Empty)'
  condition: selection_domains and not filter
falsepositives:
- Administrative scripts
level: medium
notes: |
  ### Technical Context
  This detection rule monitors changes to the Windows registry, specifically targeting modifications made to the Internet Explorer Security Zones configuration. The rule watches for registry changes indicating that a domain has been added to a specific security zone, which can be exploited by threat actors to hide malicious files or enable phishing sites by rerouting trusted domain traffic. It inspects entries in the registry path `\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\`, along with their associated DWORD values that represent different security zones. The rule aligns with the MITRE ATT&CK tactics for persistence and the technique T1137 (Office Application Startup).
  ### Investigation Steps
  - **Check Registry Entries:** Verify changes to the registry keys noted in the alert using Sysinternals tools such as RegEdit or REG.exe to confirm unauthorized modifications.
  - **Review System Logs:** Investigate Windows Security and Application logs for other related events preceding or following the registry change to assess if additional suspicious behavior occurred.
  - **Correlate with User Activity:** Utilize EDR tools to review user behavior and application usage around the time of the registry modification to determine if legitimate user actions were misused for malicious purposes.
  - **Analyze Network Traffic:** Use NDR or proxy logs to identify any connections made to suspicious or newly added domains, assessing for potential data exfiltration or communication with command and control servers.
  ### Prioritization
  Alerts generated by this rule are considered medium severity because they may indicate an attempt to manipulate Internet Explorer's security settings, potentially leading to the execution of crowded threat scenarios or data exfiltration.
  ### Blind Spots and Assumptions
  This rule may not fire if the attacker uses techniques to directly manipulate trusted domains without changing registry settings or if administrative scripts are in use to intentionally alter these values for legitimate purposes. Additionally, environments with Group Policies enforcing specific registry values may mask unauthorized changes. Other indirect routes of achieving similar outcomes (such as using alternate browsers or proxy configurations that bypass Internet Explorer settings) could also evade detection.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
