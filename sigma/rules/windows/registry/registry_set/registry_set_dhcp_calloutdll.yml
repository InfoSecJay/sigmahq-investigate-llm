title: DHCP Callout DLL Installation
id: 9d3436ef-9476-4c43-acca-90ce06bdf33a
status: test
description: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled
  parameter in Registry, which can be used to execute code in context of the DHCP
  server (restart required)
references:
- https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html
- https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx
- https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx
author: Dimitrios Slamaris
date: 2017-05-15
modified: 2023-08-17
tags:
- attack.defense-evasion
- attack.t1574.002
- attack.t1112
logsource:
  category: registry_set
  product: windows
detection:
  selection:
    TargetObject|endswith:
    - '\Services\DHCPServer\Parameters\CalloutDlls'
    - '\Services\DHCPServer\Parameters\CalloutEnabled'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The "DHCP Callout DLL Installation" detection rule identifies unauthorized modifications to the Windows registry associated with Dynamic Host Configuration Protocol (DHCP) server settings. Specifically, the rule looks for changes to the `CalloutDlls` and `CalloutEnabled` parameters within the `\Services\DHCPServer\Parameters\` path in the registry, which can indicate a potential attempt to execute malicious code in the context of the DHCP server. Adversaries may leverage these settings to install a callout DLL that can intercept or manipulate DHCP requests and responses, creating opportunities for exploitation or lateral movements within the network. This rule aligns with the MITRE ATT&CK tactics of Defense Evasion (T1574.002), as it involves circumventing security measures to install potentially harmful code.
  The relevant technical data sources include Windows Registry events, which can be monitored via the Sysmon tool or native Windows logging, and they allow for detection of registry set operations. By keeping an eye on these particular registry keys, security teams can identify possible indicators of compromise early, helping to mitigate the risks associated with malicious actions targeting DHCP infrastructure.
  ### Investigation Steps
  - **Verify Registry Changes:** Review recent changes to the registry paths, specifically `\Services\DHCPServer\Parameters\CalloutDlls` and `\Services\DHCPServer\Parameters\CalloutEnabled`, to confirm unauthorized modifications.
  - **Analyze Process Creation:** Utilize EDR to examine any processes created around the time of the registry modification, especially looking for unusual executable names or command-line arguments that could indicate malicious intent.
  - **Check Network Activity:** Inspect network connections established by the DHCP server using NDR to determine if any suspicious traffic correlates with the registry changes, which may indicate data exfiltration or further compromise.
  - **Review AV Logs:** Search through antivirus logs for any alerts related to unauthorized DLLs or executables that have interacted with the DHCP service to identify potential malware.
  ### Prioritization
  The severity level for alerts generated by this rule is high due to the criticality of the DHCP server role in a network infrastructure. Modifications to its registry settings can lead to severe security breaches, including unauthorized network access and potential lateral movement by adversaries.
  ### Blind Spots and Assumptions
  This rule may not trigger in scenarios where monitoring of registry modifications is not adequately configured, or if the attack is performed using techniques that evade detection, such as using privileged accounts to modify the registry. Additionally, the rule assumes that all legitimate software and configurations are known and that any unexpected changes are indeed malicious. Adversaries may also employ direct registry manipulation or stealth techniques to bypass detection.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
