title: Folder Removed From Exploit Guard ProtectedFolders List - Registry
id: 272e55a4-9e6b-4211-acb6-78f51f0b1b40
status: test
description: Detects the removal of folders from the "ProtectedFolders" list of of
  exploit guard. This could indicate an attacker trying to launch an encryption process
  or trying to manipulate data inside of the protected folder
references:
- https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-08-05
modified: 2023-02-08
tags:
- attack.defense-evasion
- attack.t1562.001
logsource:
  category: registry_delete
  product: windows
detection:
  selection:
    EventType: DeleteValue
    TargetObject|contains: 'SOFTWARE\Microsoft\Windows Defender\Windows Defender Exploit
      Guard\Controlled Folder Access\ProtectedFolders'
  condition: selection
falsepositives:
- Legitimate administrators removing applications (should always be investigated)
level: high
notes: |
  ### Technical Context
  This Sigma rule is designed to detect the removal of folders from the "ProtectedFolders" list within the Windows Defender Exploit Guard. The rule specifically targets registry deletion events related to the "ProtectedFolders" configuration by looking for the `DeleteValue` event type in Windows registry logs. When an attacker compromises a system, they may attempt to modify the "ProtectedFolders" list to remove safety controls that help protect sensitive data from unauthorized access or encryption, typically as part of a broader attack strategy. These events are crucial indicators of potential defense evasion tactics as outlined by the MITRE ATT&CK framework, specifically under Tactic: Defense Evasion and Technique: T1562.001.
  To effectively utilize this rule, the focus is on the collection of Windows registry logs, particularly looking for modifications made by malicious actors that could signify an impending data compromise or ransomware attack. Alerting on these specific registry deletions can provide security operations teams the visibility needed to act before significant damage occurs.
  ### Investigation Steps
  - **Check EDR for Detailed Activity:** Review the endpoint's EDR data around the time of the registry event to identify any related malicious processes or unexpected application behavior.
  - **Verify with Windows Security Logs:** Cross-reference the Windows Security Logs to examine user activity and permissions to determine if unauthorized users made the changes.
  - **Inspect Events around User Activity:** Analyze any remote access or administrative actions leading up to the registry change to ensure they were legitimate and authorized.
  - **Review Network Connections:** Utilize the network detection tools to check for any unusual outbound connections to known malicious IPs following the event which might indicate exfiltration attempts.
  ### Prioritization
  The severity level is classified as high because the removal of folders from the "ProtectedFolders" list can be indicative of serious threats such as ransomware attacks, which require immediate investigation to protect enterprise data integrity.
  ### Blind spots and Assumptions
  There are scenarios where this rule may not fire, such as if an attacker uses legitimate administrative accounts to perform the registry modification without needing to exploit any vulnerabilities, or if the logging level for registry events is insufficient. Another blind spot includes potential benign removals by trusted user accounts in administration roles, which might dilute the effectiveness of this rule. Engineers should consider implementing additional contextual monitoring around administrator actions to better distinguish between legitimate activities and potential compromises.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
