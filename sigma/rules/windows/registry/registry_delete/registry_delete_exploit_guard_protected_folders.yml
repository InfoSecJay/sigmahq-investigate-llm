title: Folder Removed From Exploit Guard ProtectedFolders List - Registry
id: 272e55a4-9e6b-4211-acb6-78f51f0b1b40
status: test
description: Detects the removal of folders from the "ProtectedFolders" list of of
  exploit guard. This could indicate an attacker trying to launch an encryption process
  or trying to manipulate data inside of the protected folder
references:
- https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-08-05
modified: 2023-02-08
tags:
- attack.defense-evasion
- attack.t1562.001
logsource:
  category: registry_delete
  product: windows
detection:
  selection:
    EventType: DeleteValue
    TargetObject|contains: 'SOFTWARE\Microsoft\Windows Defender\Windows Defender Exploit
      Guard\Controlled Folder Access\ProtectedFolders'
  condition: selection
falsepositives:
- Legitimate administrators removing applications (should always be investigated)
level: high
notes: |
  ### Technical Context
  This detection rule identifies the removal of folders from the "ProtectedFolders" list in Windows Defender Exploit Guard. The Exploit Guard feature provides a security mechanism that protects sensitive folders from unauthorized access, especially from ransomware or malicious processes. By monitoring registry delete events, particularly the deletion of values within the path `SOFTWARE\Microsoft\Windows Defender\Windows Defender Exploit Guard\Controlled Folder Access\ProtectedFolders`, the rule can flag potential attempts by an attacker to disable protective measures. Such actions may indicate that the attacker is attempting to manipulate or encrypt files within these critical folders, raising the risk of data loss or compromise. 
  The primary data source involved is Windows registry delete logs, which capture any changes to settings that could impact system security. This rule offers a valuable early warning sign of potential malicious activity targeting system integrity.
  ### Investigation Steps
  - Review the registry delete event logs for the specific folder paths that were removed from the ProtectedFolders list. Check for multiple deletions in a short time frame, which could indicate automation.
  - Utilize EDR tools to investigate the processes that initiated the registry changes. Look for any suspicious or known bad executables running around the same time as the delete events.
  - Correlate security alerts from AV or NGFW solutions for any additional indicators of compromise related to the same time frame, focusing on unusual network activity or file access patterns.
  - Investigate the user context that performed the deletion. Assess whether this user account has the necessary administrative rights and examine any recent changes in account status or privileges.
