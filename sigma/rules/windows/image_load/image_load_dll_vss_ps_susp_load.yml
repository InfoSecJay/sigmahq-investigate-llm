title: Suspicious Volume Shadow Copy VSS_PS.dll Load
id: 333cdbe8-27bb-4246-bf82-b41a0dca4b70
related:
- id: 48bfd177-7cf2-412b-ad77-baf923489e82     # vsstrace.dll
  type: similar
- id: 37774c23-25a1-4adb-bb6d-8bb9fd59c0f8     # vssapi.dll
  type: similar
status: test
description: Detects the image load of vss_ps.dll by uncommon executables
references:
- https://www.virustotal.com/gui/file/ba88ca45589fae0139a40ca27738a8fc2dfbe1be5a64a9558f4e0f52b35c5add
- https://twitter.com/am0nsec/status/1412232114980982787
author: Markus Neis, @markus_neis
date: 2021-07-07
modified: 2024-03-28
tags:
- attack.defense-evasion
- attack.impact
- attack.t1490
logsource:
  category: image_load
  product: windows
detection:
  selection:
    ImageLoaded|endswith: '\vss_ps.dll'
  filter_legit:
    Image|startswith: 'C:\Windows\'
    Image|endswith:
    - '\clussvc.exe'
    - '\dismhost.exe'
    - '\dllhost.exe'
    - '\inetsrv\appcmd.exe'
    - '\inetsrv\iissetup.exe'
    - '\msiexec.exe'
    - '\rundll32.exe'
    - '\searchindexer.exe'
    - '\srtasks.exe'
    - '\svchost.exe'
    - '\System32\SystemPropertiesAdvanced.exe'
    - '\taskhostw.exe'
    - '\thor.exe'
    - '\thor64.exe'
    - '\tiworker.exe'
    - '\vssvc.exe'
    - '\WmiPrvSE.exe'
    - '\wsmprovhost.exe'
  filter_programfiles:
        # When using this rule in your environment replace the "Program Files" folder by the exact applications you know use this. Examples would be software such as backup solutions
    Image|startswith:
    - 'C:\Program Files\'
    - 'C:\Program Files (x86)\'
  filter_update:
    CommandLine|startswith: 'C:\$WinREAgent\Scratch\'
    CommandLine|contains: '\dismhost.exe {'
  filter_image_null:
    Image:
  condition: selection and not 1 of filter_*
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The Sigma rule titled **Suspicious Volume Shadow Copy VSS_PS.dll Load** aims to detect the loading of `vss_ps.dll`, a component associated with Windows Volume Shadow Copy Service (VSS), when executed by uncommon or suspicious processes. This DLL can be leveraged by adversaries to manipulate shadow copies, potentially for evading detection during data exfiltration or compromise. The rule functions primarily by monitoring the image load events, specifically looking for instances where the `vss_ps.dll` is loaded by processes that do not typically use this library in their normal operation. 
  The key data sources for this rule include Windows Sysmon logs, particularly focusing on image load events (`image_load` category). The telemetry examines the `ImageLoaded` field for entries ending in `\vss_ps.dll`, while the detection includes filters to exclude legitimate processes (e.g., standard Windows services and applications) that might legitimately interact with this DLL, thus mitigating false positives. This rule aligns with the MITRE ATT&CK framework under **Defense Evasion (T1490)** and **Impact (T1490)**, helping to identify potential malicious activities manipulating backup systems.
  ### Investigation Steps
  - **Review Process Activity:** Examine the process that triggered the alert in your EDR. Look for abnormal parent-child relationships, command-line arguments, and execution paths to determine the legitimacy of the invoking process.
  - **Correlate with Event Logs:** Check Windows Event Logs, especially Security, System, and Application logs, for any related events around the time of the alert that may provide additional context about the suspicious process or user activity.
  - **Inspect Command-Line Parameters:** Analyze the command-line parameters associated with the process from Sysmon logs and correlate them with known bad indicators or tactics to identify any attempt at lateral movement or privilege escalation.
  - **Cross-reference Known Bad:** Search for the triggering process in threat intelligence databases or security vendor logs. Check if the process has been linked to malicious activities previously, utilizing both AV and threat databases to evaluate risk.
  ### Prioritization
  Alerts generated by this rule should be regarded as high severity due to the potential risk associated with the misuse of Volume Shadow Copy. The loading of `vss_ps.dll` by uncommon executables could indicate an attempt to bypass security measures and manipulate backup copies to facilitate data exfiltration or to hide malicious activities, warranting immediate investigation.
  ### Blind Spots and Assumptions
  This rule may not fire in scenarios where legitimate applications or processes that interact with `vss_ps.dll` are present in a compromised environment, causing them to be included as exceptions. If an adversary employs a valid executable that matches the filter criteria or uses a sophisticated evasion technique that avoids standard process paths or command-line patterns, the rule may fail to detect malicious activities. Additionally, reliance on Sysmon for capturing image load events assumes that logging is appropriately configured and operational across all requisite endpoints.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
