title: GAC DLL Loaded Via Office Applications
id: 90217a70-13fc-48e4-b3db-0d836c5824ac
status: test
description: Detects any GAC DLL being loaded by an Office Product
references:
- https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16
author: Antonlovesdnb
date: 2020-02-19
modified: 2023-02-10
tags:
- attack.execution
- attack.t1204.002
logsource:
  category: image_load
  product: windows
detection:
  selection:
    Image|endswith:
    - '\excel.exe'
    - '\mspub.exe'
    - '\onenote.exe'
    - '\onenoteim.exe'         # Just in case
    - '\outlook.exe'
    - '\powerpnt.exe'
    - '\winword.exe'
    ImageLoaded|startswith: 'C:\Windows\Microsoft.NET\assembly\GAC_MSIL'
  condition: selection
falsepositives:
- Legitimate macro usage. Add the appropriate filter according to your environment
level: high
notes: |
  ### Technical Context
  This detection rule identifies instances where a Global Assembly Cache (GAC) DLL is loaded by Microsoft Office applications, such as Excel, Word, and PowerPoint. The rule monitors "Image Load" events generated by Windows, specifically looking for processes that end with the names of common Office applications and validating that they are loading DLLs from the GAC. The GAC is often used by attackers to execute malicious code via macros or to exploit vulnerable Office product functionalities. The rule is tied to the MITRE ATT&CK tactic of Execution under the technique T1204.002 (Malicious File Execution), highlighting how attackers may leverage trusted applications to execute payloads in an enterprise environment.
  ### Investigation Steps
  - **Verify the Image Load Event:** Examine the corresponding image load event in the Windows event logs or EDR to confirm the occurrence of a GAC DLL being loaded by the specified Office application.
  - **Check Process Context:** Retrieve details about the parent process and command-line arguments for the Office application to identify any suspicious behavior or unusual parameters.
  - **Review Associated User Activities:** Investigate the user's activity in Office applications leading up to the event, focusing on any recent document downloads or macro execution that may indicate malicious intent.
  - **Correlate with Other Logs:** Cross-reference network logs and proxy logs for any outbound connections initiated by the Office applications that may suggest data exfiltration or C2 communication.
  ### Prioritization
  This alert is classified as high severity due to the potential for significant impact; GAC DLLs can enable attackers to execute unauthorized code within trusted applications, making detection crucial for preventing data breaches or system compromise.
  ### Blind Spots and Assumptions
  This rule may not trigger if the malicious DLL is loaded using other means, such as through non-Office applications, or if the loading process is obfuscated. Additionally, legitimate usage of macros and GAC DLLs in Office documents may result in false positives. It is assumed that the environment is properly configured to log image load events so that the detection can function effectively. Adversaries may bypass this detection by manipulating the loading process, thus creating gaps in visibility.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environments and operational needs. Please communicate any changes to the detection engineering team.
