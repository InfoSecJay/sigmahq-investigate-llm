title: DNS Query Request By Regsvr32.EXE
id: 36e037c4-c228-4866-b6a3-48eb292b9955
related:
- id: c7e91a02-d771-4a6d-a700-42587e0b1095
  type: derived
status: test
description: Detects DNS queries initiated by "Regsvr32.exe"
references:
- https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/
- https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/
author: Dmitriy Lifanov, oscd.community
date: 2019-10-25
modified: 2023-09-18
tags:
- attack.execution
- attack.t1559.001
- attack.defense-evasion
- attack.t1218.010
logsource:
  category: dns_query
  product: windows
detection:
  selection:
    Image|endswith: '\regsvr32.exe'
  condition: selection
falsepositives:
- Unknown
level: medium
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect DNS queries made by the legitimate Windows utility `Regsvr32.exe`. Typically used to register and unregister OLE controls or DLL files, `Regsvr32.exe` being used to initiate DNS requests may indicate an attempt to bypass normal application whitelisting controls or engage in other malicious activities. The rule specifically leverages DNS query logs from Windows to monitor for instances where `Regsvr32.exe` is responsible for initiating a DNS request, signifying a potential sign of anomalous behavior as per the MITRE ATT&CK Tactic of Execution (ATT&CK ID: T1559.001) and Defense Evasion (ATT&CK ID: T1218.010).
  The detection condition centers on logs indicating the image path of the executable, specifically filtering for instances where the path ends with `\regsvr32.exe`. By utilizing Windows DNS query logs, the rule identifies when this executable is attempting to resolve domain names, which could be part of a broader exploitation attempt by adversaries seeking to leverage unmonitored or less scrutinized processes for malicious command and control activities.
  ### Investigation Steps
  - **Examine DNS Logs:** Review the Windows DNS query logs to identify the specific domain names that `Regsvr32.exe` attempted to resolve. This information can highlight potential exfiltration points or command and control domains.
  - **Correlate with Process Logs:** Check process creation logs for `Regsvr32.exe` execution details, including command-line arguments and parent processes that may provide context on how it was invoked.
  - **Assess EDR Alerts:** Use the EDR tool to investigate any alerts associated with `Regsvr32.exe`, focusing on its lifecycle and any unusual processes or network connections spawned during its execution.
  - **Conduct a Tampering Review:** Verify if there have been any application whitelisting bypass attempts linked to `Regsvr32.exe`, paying special attention to security configurations around this executable.
  ### Prioritization
  Given that `Regsvr32.exe` is often leveraged in offensive security contexts to evade detection, alerts generated by this rule warrant a medium severity level. Investigating these alerts is crucial as they may indicate attempts to exploit vulnerabilities within an organization's security posture.
  ### Blind Spots and Assumptions
  The rule may not fire if `Regsvr32.exe` executes without initiating a DNS query, or if the DNS traffic is obscured or routed through a proxy that does not log requests. Additionally, there are assumptions about the environment's DNS monitoring and logging capabilities; if these are disabled or not configured properly, the detection will fail. Lastly, adversaries could possibly invoke similar behaviors using other legitimate utilities, which may lead to missed detections.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
