title: HackTool - Potential CobaltStrike Process Injection
id: 6309645e-122d-4c5b-bb2b-22e4f9c2fa42
status: test
description: Detects a potential remote threat creation with certain characteristics
  which are typical for Cobalt Strike beacons
references:
- https://medium.com/@olafhartong/cobalt-strike-remote-threads-detection-206372d11d0f
- https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/
author: Olaf Hartong, Florian Roth (Nextron Systems), Aleksey Potapov, oscd.community
date: 2018-11-30
modified: 2023-05-05
tags:
- attack.defense-evasion
- attack.t1055.001
logsource:
  product: windows
  category: create_remote_thread
detection:
  selection:
    StartAddress|endswith:
    - '0B80'
    - '0C7C'
    - '0C88'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potential Cobalt Strike process injection attempts, a technique frequently employed by adversaries to establish persistent control over a compromised system. It specifically focuses on monitoring the creation of remote threads within processes, which is a hallmark of Cobalt Strike beacon behavior. By watching for thread start addresses that end with specific hex values ('0B80', '0C7C', '0C88'), the rule captures suspicious remote thread activity indicative of manipulation by malicious actors. The primary data source involved in this detection is Windows Sysmon's `create_remote_thread` event, which logs instances where a process creates a thread in another processâ€™s memory space. This detection falls under the MITRE ATT&CK framework technique T1055.001, related to the Control of Remote Services that adversaries exploit to execute malicious payloads stealthily.
  ### Investigation Steps
  - **Review Sysmon Logs:** Begin by examining Sysmon logs for `create_remote_thread` events and filter them based on the identified start addresses. Look for other indicators, such as the parent process and its activity prior to the thread creation.
  - **Analyze Process Creation:** Utilize EDR tools to trace the process creation chain linked to the identified suspicious thread activity. Confirm whether the parent process is known or trusted, or if there are unexpected behaviors associated.
  - **Check Network Connections:** Investigate any related network connections using enterprise NDR tools to identify unusual outbound traffic patterns or connections to known malicious IPs or domains associated with Cobalt Strike.
  - **Evaluate Other Security Alerts:** Cross-reference other security alerts from AV, NGFW, and proxy logs around the same timeframe. Look for additional signs of compromise, such as payload deliveries or lateral movement that may correlate with the detected remote thread creation.
  ### Prioritization
  The alert generated by this rule is classified as high severity due to the association with advanced persistent threats (APTs) and the potential for widespread impact within the enterprise environment. Cobalt Strike is a well-known tool used by adversaries for post-exploitation, potentially leading to further compromises if not addressed promptly.
  ### Blind Spots and Assumptions
  This rule may not fire in scenarios where the process injection technique is implemented successfully via other less detectable means or when the monitored processes are whitelisted in the environment. Additionally, environmental factors such as misconfigured Sysmon installations or lack of visibility into specific event types can lead to missed detections. Adversaries may employ obfuscation techniques or utilize new start addresses outside of those specified in this rule, reducing its effectiveness.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
