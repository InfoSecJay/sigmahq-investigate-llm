title: Communication To Uncommon Destination Ports
id: 6d8c3d20-a5e1-494f-8412-4571d716cf5c
related:
- id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382
  type: similar
status: test
description: Detects programs that connect to uncommon destination ports
references:
- https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo
author: Florian Roth (Nextron Systems)
date: 2017-03-19
modified: 2024-03-12
tags:
- attack.persistence
- attack.command-and-control
- attack.t1571
logsource:
  category: network_connection
  product: windows
detection:
  selection:
    Initiated: 'true'
    DestinationPort:
    - 8080
    - 8888
  filter_main_local_ranges:
    DestinationIp|cidr:
    - '127.0.0.0/8'
    - '10.0.0.0/8'
    - '172.16.0.0/12'
    - '192.168.0.0/16'
    - '169.254.0.0/16'
    - '::1/128'          # IPv6 loopback
    - 'fe80::/10'          # IPv6 link-local addresses
    - 'fc00::/7'          # IPv6 private addresses
  filter_optional_sys_directories:
    Image|startswith:
    - 'C:\Program Files\'
    - 'C:\Program Files (x86)\'
  condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The "Communication To Uncommon Destination Ports" Sigma rule is designed to identify network connections initiated by programs that connect to specified uncommon destination ports, specifically ports 8080 and 8888. The rule leverages the Windows event logs pertaining to network connections, focusing on process characteristics such as the destination port and the initiating process image path. By filtering out local and well-known private IP ranges, along with ignoring common system directories, the rule aims to detect potential command-and-control (C2) communications or persistent backdoor activities that typically utilize these uncommon ports. This detection aligns with the MITRE ATT&CK framework under the tactic of persistence and the technique T1571, which addresses application layer protocol tunneling commonly used by attackers.
  ### Investigation Steps
  - **Verify Originating Process:** Utilize the EDR platform to investigate the originating processes of the flagged connections, checking for any signs of unusual behavior or known vulnerabilities.
  - **Analyze Network Traffic:** Review the network traffic to the detected IPs using Network Detection and Response (NDR) tools to determine if this communication pattern is legitimate or indicative of malicious activity.
  - **Inspect Related Logs:** Query the Windows Security Event Logs for account activities around the time of the connection to identify potential unauthorized access or suspicious logins.
  - **Cross-reference with Threat Intelligence:** Utilize threat intelligence feeds to compare flagged destination IPs against known malicious indicators to ascertain if any of the destination ports or IPs have history related to adversarial activity.
  ### Prioritization
  The severity level of this alert is set to medium due to the potential for these uncommon ports to be associated with malicious activities such as backdoors or C2 channels. Therefore, timely investigation is crucial to verify if the detected behavior represents an actual threat.
  ### Blind Spots and Assumptions
  This rule may not fire if the uncommon destination ports are masked by encryption or used in a legitimate context, making detection difficult. Additionally, if an attacker uses custom or unexpected ports, this detection will fail to trigger. There's an assumption that all relevant network communication is logged; missing logs can lead to undetected threats. Adversaries can also evade detection by utilizing typical ports or by using legitimate applications with whitelisted paths for their communications.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
