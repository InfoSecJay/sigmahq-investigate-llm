title: Communication To Uncommon Destination Ports
id: 6d8c3d20-a5e1-494f-8412-4571d716cf5c
related:
- id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382
  type: similar
status: test
description: Detects programs that connect to uncommon destination ports
references:
- https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo
author: Florian Roth (Nextron Systems)
date: 2017-03-19
modified: 2024-03-12
tags:
- attack.persistence
- attack.command-and-control
- attack.t1571
logsource:
  category: network_connection
  product: windows
detection:
  selection:
    Initiated: 'true'
    DestinationPort:
    - 8080
    - 8888
  filter_main_local_ranges:
    DestinationIp|cidr:
    - '127.0.0.0/8'
    - '10.0.0.0/8'
    - '172.16.0.0/12'
    - '192.168.0.0/16'
    - '169.254.0.0/16'
    - '::1/128'          # IPv6 loopback
    - 'fe80::/10'          # IPv6 link-local addresses
    - 'fc00::/7'          # IPv6 private addresses
  filter_optional_sys_directories:
    Image|startswith:
    - 'C:\Program Files\'
    - 'C:\Program Files (x86)\'
  condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The "Communication To Uncommon Destination Ports" Sigma rule focuses on detecting network connections made by programs to uncommon destination ports, specifically 8080 and 8888. It fine-tunes its detections by excluding connections made to local addresses, such as private IP ranges and local system directories, ensuring that the alerts produced are more relevant to potential malicious activity. The detection relies on network connection logs generated by Windows systems, identifying initiated connections to these uncommon ports while filtering out benign traffic and common internal communication, which may lead to false positives.
  Identifying unusual destination ports is a crucial element in network security monitoring, as these can signal attempts at persistence or command-and-control operations by threat actors. By focusing on specified ports, the rule aims to spotlight potentially malicious behavior that would otherwise blend in with typical traffic patterns, facilitating rapid response actions by security teams.
  ### Investigation Steps
   
  Review Windows EDR logs to identify processes that initiated connections to ports 8080 or 8888, noting the associated process details and command-line parameters.
   
  Analyze network traffic logs to trace the destination IP addresses tied to the flagged connections and determine if they are known bad actors or suspicious domains.
   
  Consult firewall logs to check if any unusual outbound connections are being allowed or blocked that correspond with the alerts raised by the Sigma rule.
   
  Examine proxy logs for any related web requests or connections that align with the flagged ports to identify possible exfiltration or command-and-control attempts.
