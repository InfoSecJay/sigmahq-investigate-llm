title: Office Application Initiated Network Connection Over Uncommon Ports
id: 3b5ba899-9842-4bc2-acc2-12308498bf42
status: experimental
description: Detects an office suit application (Word, Excel, PowerPoint, Outlook)
  communicating to target systems over uncommon ports.
references:
- https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit
author: X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2023-07-12
modified: 2024-07-02
tags:
- attack.defense-evasion
- attack.command-and-control
logsource:
  category: network_connection
  product: windows
detection:
  selection:
    Initiated: 'true'
    Image|endswith:
    - '\excel.exe'
    - '\outlook.exe'
    - '\powerpnt.exe'
    - '\winword.exe'
    - '\wordview.exe'
  filter_main_common_ports:
    DestinationPort:
    - 53         # DNS
    - 80         # HTTP
    - 139         # NETBIOS
    - 443         # HTTPS
    - 445         # SMB
  filter_main_outlook_ports:
    Image|contains: ':\Program Files\Microsoft Office\'
    Image|endswith: '\OUTLOOK.EXE'
    DestinationPort:
    - 143
    - 465         # SMTP
    - 587         # SMTP
    - 993         # IMAP
    - 995         # POP3
  condition: selection and not 1 of filter_main_*
falsepositives:
- Other ports can be used, apply additional filters accordingly
level: medium
notes: |
  ### Technical Context
  This Sigma rule is designed to detect anomalous network activity initiated by common Microsoft Office applications—namely Word, Excel, PowerPoint, and Outlook—when they communicate with external systems over ports that are less commonly used for their operations. Typically, Office applications utilize standard networking protocols and ports such as HTTP (80) and HTTPS (443) for functions like checking for updates or online resource access. By focusing on unusual ports—those that are not typical for these applications—it aims to uncover potential command-and-control operations or other malicious behaviors where benign applications may be exploited for unauthorized network communication. The detection leverages Windows network connection logs, which provide information about process initiation and destination ports. This rule relates to MITRE ATT&CK techniques associated with defense evasion and command-and-control, particularly highlighting potential misuse of trusted applications for malicious purposes.
  ### Investigation Steps
  - **Check EDR logs:** Review endpoint detection and response (EDR) logs for additional details about the detected Office application, including any suspicious command-line arguments and previous process activity to establish context for the network connection.
    
  - **Analyze network traffic:** Utilize the Network Detection and Response (NDR) tool to monitor the traffic generated by the Office application for unusual patterns, such as data exfiltration or communication with known malicious IP addresses.
    
  - **Examine firewall logs:** Inspect next-generation firewall (NGFW) logs to confirm if traffic on the uncommon ports is being allowed or blocked, and identify any specific patterns or anomalies correlating with user behavior.
    
  - **Review recent changes:** Check the change management logs to ascertain any recent updates or modifications to the Office applications, which may provide insight into why they are using uncommon ports.
  ### Prioritization
  This alert is considered medium severity due to the potential risk of a compromised Office application being used to establish unauthorized network connections, which could indicate a foothold in the environment or preparatory actions for data exfiltration.
  ### Blind Spots and Assumptions
  The rule may not fire for several reasons, such as misconfigured firewall rules that allow expected office application traffic through unusual ports without logging, or if the malicious traffic occurs during a legitimate software update scenario. Additionally, some organizations may utilize proxy settings that can obscure the source of the communication, making it harder to identify misuse of trusted applications. There's also an assumption that typical administrative controls and monitoring around network usage are active and functioning; if not, the effectiveness of this detection could diminish significantly.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
