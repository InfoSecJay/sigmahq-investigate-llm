title: Communication To LocaltoNet Tunneling Service Initiated
id: 3ab65069-d82a-4d44-a759-466661a082d1
status: experimental
description: |
  Detects an executable initiating a network connection to "LocaltoNet" tunneling sub-domains.
  LocaltoNet is a reverse proxy that enables localhost services to be exposed to the Internet.
  Attackers have been seen to use this service for command-and-control activities to bypass MFA and perimeter controls.
references:
- https://localtonet.com/documents/supported-tunnels
- https://cloud.google.com/blog/topics/threat-intelligence/unc3944-targets-saas-applications
author: Andreas Braathen (mnemonic.io)
date: 2024-06-17
tags:
- attack.command-and-control
- attack.t1572
- attack.t1090
- attack.t1102
logsource:
  category: network_connection
  product: windows
detection:
  selection:
    DestinationHostname|endswith:
    - '.localto.net'
    - '.localtonet.com'
    Initiated: 'true'
  condition: selection
falsepositives:
- Legitimate use of the LocaltoNet service.
level: high
notes: |
  ### Technical Context
  The Sigma rule titled "Communication To LocaltoNet Tunneling Service Initiated" is designed to detect the initiation of network connections to the LocaltoNet service, specifically targeting its sub-domains such as `.localto.net` and `.localtonet.com`. This rule focuses on identifying executables that establish these connections, suggesting potential command-and-control communications which are common in malicious activities, especially when attackers leverage LocaltoNet services to bypass security measures like multi-factor authentication (MFA). It taps into the "Network Connection" logs provided by Windows, monitoring for outbound traffic to these critical sub-domains used frequently in illicit tunneling and data exfiltration scenarios. 
  This detection aligns with the MITRE ATT&CK framework, specifically under the tactics of Command and Control (T1072) and Application Layer Protocol (T1090), indicating its relevance in identifying network activities that are not only unusual but also indicative of potential compromise. Understanding this context is crucial as it empowers SOC analysts to discern appropriate responses to alerts generated by this rule.
  ### Investigation Steps
  - **Check Network Logs**: Review recent network connection logs in the EDR for connections initiated to “LocaltoNet” sub-domains. Ensure that the source of these connections is related to potentially suspicious executables.
    
  - **Analyze Process Creation Events**: Investigate associated process creation logs in Sysmon to determine if a legitimate process initiated the connection or if an unusual process could signal malicious activity.
  - **Review Fallback Connections**: Assess any fallback or secondary connections made by the same process to other hosts that could indicate a wider attack strategy beyond just LocaltoNet.
  - **Cross-check with Threat Intelligence**: Utilize threat intelligence from AV and NDR solutions to gather insights about known malicious behaviors linked to the LocaltoNet tunneling service, ensuring a comprehensive assessment.
  ### Prioritization
  This alert is classified as high severity because connections to tunneling services like LocaltoNet may indicate attempts to evade detection during a data breach or other adversarial activities. Given the potential implications for perimeter security and data integrity, any generated alerts should be treated with urgency.
  ### Blind Spots and Assumptions
  This rule may not fire in situations such as legitimate uses of the LocaltoNet service, where authorized personnel may be utilizing these connections for valid purposes. Additionally, sophisticated adversaries might employ tactics like altering process names or using encrypted communications to hide their activities, potentially circumventing detection. Further, if misconfigured environmental settings prevent logging or if the connections are made via uncommon or ad-hoc methods, the effectiveness of this rule could be reduced. 
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
