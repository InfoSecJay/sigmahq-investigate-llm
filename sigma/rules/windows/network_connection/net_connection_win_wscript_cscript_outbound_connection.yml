title: Outbound Network Connection Initiated By Script Interpreter
id: 992a6cae-db6a-43c8-9cec-76d7195c96fc
related:
- id: 08249dc0-a28d-4555-8ba5-9255a198e08c
  type: derived
status: test
description: Detects a script interpreter wscript/cscript opening a network connection
  to a non-local network. Adversaries may use script to download malicious payloads.
references:
- https://github.com/redcanaryco/atomic-red-team/blob/28d190330fe44de6ff4767fc400cc10fa7cd6540/atomics/T1105/T1105.md
author: frack113, Florian Roth (Nextron Systems)
date: 2022-08-28
modified: 2024-03-13
tags:
- attack.command-and-control
- attack.t1105
logsource:
  category: network_connection
  product: windows
detection:
  selection:
    Initiated: 'true'
    Image|endswith:
    - '\wscript.exe'
    - '\cscript.exe'
  filter_main_local_ranges:
    DestinationIp|cidr:
    - '127.0.0.0/8'
    - '10.0.0.0/8'
    - '172.16.0.0/12'
    - '192.168.0.0/16'
    - '169.254.0.0/16'
    - '::1/128'          # IPv6 loopback
    - 'fe80::/10'          # IPv6 link-local addresses
    - 'fc00::/7'          # IPv6 private addresses
  filter_main_ms_ranges:
    DestinationIp|cidr: '20.0.0.0/11'     # Microsoft range, caused some FPs
  condition: selection and not 1 of filter_main_*
falsepositives:
- Legitimate scripts
level: high
notes: |
  ### Technical Context
  This detection rule identifies outbound network connections initiated by script interpreters, specifically `wscript.exe` and `cscript.exe`. These script engines are commonly utilized for executing VBScript and JScript files, often in administrative tasks or automation scripts. However, adversaries may leverage these interpreters to execute malicious scripts that connect to external IP ranges for downloading payloads. The rule looks for network connections that are initiated by these script engines, filtering out local and internal addresses to focus on external destinations. 
  The relevant telemetry sources for this rule include logs from the network connection category in Windows, and it aligns with the MITRE ATT&CK tactic of Command and Control (Technique T1105), which involves adversaries establishing connections to retrieve malicious content from external sources.
  ### Investigation Steps
  - **Check Network Connection Logs:** Review the network connection logs in your SIEM for any connections made by `wscript.exe` or `cscript.exe` to external IP addresses. Pay special attention to suspicious or unrecognized destinations.
  - **Analyze Script Execution History:** Utilize EDR tools to examine the execution history of the scripts to determine their origin and legitimacy. Look for any indicators that suggest the execution was unauthorized or abnormal.
  - **Review Endpoint Activity:** Investigate related events on the endpoint where the script interpreter was executed. Check for other potentially malicious activities, such as process creation events or suspicious file access patterns.
  - **Cross-Reference with Threat Intelligence:** Compare the destination IP addresses with threat intelligence feeds to check if they are associated with known malicious activity. This can further inform the risk assessment of the incident.
  ### Prioritization
  Given the potential for script interpreters to be exploited by adversaries for Command and Control purposes, alerts generated by this rule are considered high severity. Prompt investigation is essential to mitigate the risks of data exfiltration or further compromise.
  ### Blind Spots and Assumptions
  This rule may not trigger if legitimate scripts are running under `wscript.exe` or `cscript.exe`, especially in environments where such scripts are commonly used for automation. Additionally, if an adversary uses alternate methods or tools to execute their scripts, or if they employ obfuscation techniques that evade detection, the rule may fail to fire. It's important for detection engineers to stay vigilant to these tactics and incorporate additional telemetry where necessary to reduce blind spots.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
