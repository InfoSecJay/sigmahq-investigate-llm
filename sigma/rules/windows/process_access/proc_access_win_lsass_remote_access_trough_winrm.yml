title: Remote LSASS Process Access Through Windows Remote Management
id: aa35a627-33fb-4d04-a165-d33b4afca3e8
status: stable
description: Detects remote access to the LSASS process via WinRM. This could be a
  sign of credential dumping from tools like mimikatz.
references:
- https://pentestlab.blog/2018/05/15/lateral-movement-winrm/
author: Patryk Prauze - ING Tech
date: 2019-05-20
modified: 2023-11-29
tags:
- attack.credential-access
- attack.execution
- attack.t1003.001
- attack.t1059.001
- attack.lateral-movement
- attack.t1021.006
- attack.s0002
logsource:
  category: process_access
  product: windows
detection:
  selection:
    TargetImage|endswith: '\lsass.exe'
    SourceImage|endswith: ':\Windows\system32\wsmprovhost.exe'
  filter_main_access:
    GrantedAccess: '0x80000000'
  condition: selection and not 1 of filter_main_*
falsepositives:
- Unlikely
level: high
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect unauthorized remote access to the Local Security Authority Subsystem Service (LSASS) process, targeting Windows systems. Specifically, it monitors for instances where the `wsmprovhost.exe`, a component used for Windows Remote Management (WinRM), is accessing the LSASS process (lsass.exe). The rule looks for process access events where a remote connection is established, which could indicate malicious activity such as credential dumping, typically performed by tools like Mimikatz. This falls under the MITRE ATT&CK tactics for Credential Access (T1003.001) and Lateral Movement (T1021.006), showing an advanced persistent threat (APT) actor's intent to harvest credentials or maneuver further within the network.
  ### Investigation Steps
  - **Check Process Access Logs:** Examine process access events in your EDR solution to identify any instances where `wsmprovhost.exe` accessed `lsass.exe`. Look specifically for the `GrantedAccess` value of '0x80000000', indicating a request for process-level rights.
  - **Verify User Context:** Investigate the user account that triggered the remote access. Determine if this account was expected to have permissions for WinRM operations and if any anomalies can be linked to suspicious activity or unauthorized access.
  - **Correlate with Network Traffic:** Use NDR or firewall logs to look for anomalous WinRM traffic originating from unusual source IPs or during odd hours that could point to lateral movement by an attacker.
  - **Review Event Logs:** Check Windows Security logs for logon attempts, especially those involving remote desktop or WinRM, as well as any recent changes in permissions or group memberships that may have been exploited.
  ### Prioritization
  Given the sensitivity of the LSASS process, which contains memory for sensitive credential data, alerts generated by this rule should be treated with high severity. Prompt investigation is critical, as this behavior often signals potential credential theft or a compromise of the environment.
  ### Blind Spots and Assumptions
  This rule may not fire if the attacker uses more sophisticated techniques to manipulate the WinRM service or if access to LSASS is achieved through non-standard processes. Additionally, if alerts from monitoring tools are suppressed or misconfigured, legitimate traffic could evade detection. The rule assumes that remote access via WinRM is not typical in your environment and may not account for scenarios where this type of access is legitimate, potentially leading to false negatives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
