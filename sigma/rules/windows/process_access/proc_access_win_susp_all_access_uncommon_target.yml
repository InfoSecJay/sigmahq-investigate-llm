title: Uncommon Process Access Rights For Target Image
id: a24e5861-c6ca-4fde-a93c-ba9256feddf0
status: experimental
description: |
  Detects process access request to uncommon target images with a "PROCESS_ALL_ACCESS" access mask.
references:
- https://learn.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights
author: Nasreddine Bencherchali (Nextron Systems), frack113
date: 2024-05-27
tags:
- attack.defense-evasion
- attack.privilege-escalation
- attack.t1055.011
logsource:
  category: process_access
  product: windows
detection:
  selection:
    TargetImage|endswith:
            # Note: Add additional uncommon targets to increase coverage.
    - '\calc.exe'
    - '\calculator.exe'
    - '\mspaint.exe'
    - '\notepad.exe'
    - '\ping.exe'
    - '\wordpad.exe'
    - '\write.exe'
    GrantedAccess: '0x1FFFFF'     # PROCESS_ALL_ACCESS - All possible access rights for a process object.
  condition: selection
falsepositives:
- Unknown
# Note: please upgrade to a higher level after an initial test/tuning.
level: low
notes: |
  ### Technical Context
  This Sigma rule is designed to detect uncommon process access requests where the `PROCESS_ALL_ACCESS` access mask is granted to certain target images, which could indicate potential security threats or unusual behavior in an enterprise environment. The rule specifically monitors for access attempts to processes like `calc.exe`, `mspaint.exe`, and others that are generally not configured to require such extensive access rights. 
  The core of this detection relies on the `process_access` logs, which provide insights into interactions with processing objects within the Windows operating system. By examining the target images and the requested access rights, the rule identifies potentially malicious activities that may involve privilege escalation or defense evasion techniques, as mapped to the MITRE ATT&CK framework under tactic `Defense Evasion` (ID: T1055.011).
  ### Investigation Steps
  - **Review Process Access Events:** Use EDR to investigate process access logs for the specified target images to identify instances where `PROCESS_ALL_ACCESS` was granted. Anomalies should be examined for legitimacy.
  - **Cross-reference with User Activity:** Check Windows Event Logs for relevant user activity around the time of the access request. This can help determine if the access was made by an authorized user.
  - **Analyze Related Network Activity:** Query NDR tools for any associated network traffic that occurred during the timeframe of the detected access to further contextualize the alert.
  - **Check for Known False Positives:** Review known false positive cases in previous alerts. Document and adjust any tuning suggestions as necessary based on the findings.
  ### Prioritization
  Alerts generated by this rule are generally categorized as low severity due to the common nature of the target images and the potential for legitimate use. However, any alert should not be dismissed without review, as misuse of access can indicate emerging threats.
  ### Blind Spots and Assumptions
  This rule may not fire if the adversary utilizes more common processes that are not included in the `TargetImage` list or if they circumvent process access logging altogether. Additionally, a legitimate application requiring `PROCESS_ALL_ACCESS` might generate alerts without any malicious intent. Assumption of the legitimate use of targeted processes must always be validated to reduce noise and false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
