title: Sysmon Blocked File Shredding
id: c3e5c1b1-45e9-4632-b242-27939c170239
status: test
description: Triggers on any Sysmon "FileBlockShredding" event, which indicates a
  violation of the configured shredding policy.
references:
- https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon
author: frack113
date: 2023-07-20
tags:
- attack.defense-evasion
logsource:
  product: windows
  service: sysmon
detection:
  selection:
    EventID: 28      # this is fine, we want to match any FileBlockShredding event
  condition: selection
falsepositives:
- Unlikely
level: high
notes: |
  ### Technical Context
  The Sysmon Blocked File Shredding rule is designed to detect attempts at file shredding that violate the configured shredding policy within a Windows environment. This rule focuses on EventID 28, which is generated by Sysmon when a file shredding operation is prevented or blocked. Shredding files refers to the process of permanently deleting them in a way that makes recovery impossible, often used by malicious actors to remove evidence of their activities. The alert ultimately indicates a potential defense evasion attempt, making it crucial for security teams to respond promptly. Utilizing telemetry data from Sysmon, including file access and process creation logs, allows the SOC team to identify suspicious behaviors and track unauthorized attempts to manipulate or delete critical files. This aligns with the MITRE ATT&CK tactic: **Defense Evasion** (T1565).
  ### Investigation Steps
  - **Check Sysmon Logs:** Review the Sysmon logs for EventID 28 to identify the specific times and processes involved in the file shredding attempt. Look for patterns or multiple occurrences that may indicate a broader attempt to evade detection.
  - **Correlate with EDR Alerts:** Use your EDR solution to cross-reference any associated alerts with the identified file shredding events. Investigate whether the processes tied to these events have a history of suspicious behavior.
  - **Review User Activity Logs:** Check the Windows Security logs to retrieve user logins and actions around the time of the shredding attempts. This helps in establishing a timeline and understanding user intent.
  - **Assess Other Logs:** Examine logs from other relevant systems and services, such as AV logs, proxy logs, and cloud access logs, for additional context related to the user or process identified in the Sysmon event.
  ### Prioritization
  Given the high severity level of this alert, it indicates that potentially malicious actors may be attempting to destroy critical evidence, warranting immediate investigation and response to safeguard data and systems.
  ### Blind spots and Assumptions
  There are some limitations to this rule's effectiveness. It assumes that Sysmon is configured correctly across all endpoints and that the logging level is sufficient to capture EventID 28. An adversary may try to modify or disable Sysmon or implement stealthy file deletion techniques that do not trigger this event. Additionally, legitimate user activity considered benign (such as a software application with authorized shredding capabilities) could potentially lead to false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
