title: HackTool - SafetyKatz Execution
id: b1876533-4ed5-4a83-90f3-b8645840a413
status: test
description: Detects the execution of the hacktool SafetyKatz via PE information and
  default Image name
references:
- https://github.com/GhostPack/SafetyKatz
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-10-20
modified: 2023-02-04
tags:
- attack.credential-access
- attack.t1003.001
logsource:
  category: process_creation
  product: windows
detection:
  selection:
  - Image|endswith: '\SafetyKatz.exe'
  - OriginalFileName: 'SafetyKatz.exe'
  - Description: 'SafetyKatz'
  condition: selection
falsepositives:
- Unlikely
level: critical
notes: |
  ### Technical Context
  The Sigma rule "HackTool 
  - SafetyKatz Execution" is designed to detect the execution of the SafetyKatz tool, which is primarily used for credential extraction on Windows systems. This detection works by analyzing process creation logs to identify instances where an executable file named `SafetyKatz.exe` is launched. The rule employs three key indicators: it checks if the image path of the executed process ends with `\SafetyKatz.exe`, verifies that the original file name matches 'SafetyKatz.exe', and confirms that the description of the executable is 'SafetyKatz'. These indicators are collected primarily from Windows process creation logs, specifically from Sysmon logs, which provide detailed information about running processes and their attributes. The rule aligns with the MITRE ATT&CK framework under the tactics of "Credential Access," specifically technique T1003.001 (Credential Dumping: LSASS Memory).
  ### Investigation Steps
  - **Review Process Creation Logs:** Use Windows event logs to search for the execution of `SafetyKatz.exe`. Pay attention to timestamps and user accounts associated with the execution.
  - **Analyze Sysmon Data:** Access Sysmon logs to gain detailed insights into the process creation, including command-line arguments and parent-child process relationships that may provide context for the execution.
  - **Check Network Connections:** Investigate any outbound network connections initiated by the process. This can help determine if the tool is attempting to exfiltrate credentials or communicate with external malicious servers.
  - **Assess EDR/AV Alerts:** Look for any alerts generated by EDR or antivirus solutions that may indicate suspicious behavior associated with SafetyKatz or related processes, guiding further investigation actions.
  ### Prioritization
  This alert is classified as critical due to the nature of SafetyKatz as a credential dumping tool that poses significant risks to the security of enterprise systems and sensitive data.
  ### Blind Spots and Assumptions
  There are a few blind spots and assumptions related to this rule. One assumption is that the execution of SafetyKatz will always be accurately logged, which may not occur if logs are misconfigured or if the tool is run in a way that obscures its execution path. Additionally, malware authors may rename or modify the tool to bypass detection, which could result in undetected activity. This rule may also not fire if the process is executed under a different name or with altered properties, illustrating the need for continuous monitoring and contextual investigations.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
