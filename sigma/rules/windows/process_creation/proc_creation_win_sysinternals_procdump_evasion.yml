title: Potential SysInternals ProcDump Evasion
id: 79b06761-465f-4f88-9ef2-150e24d3d737
status: test
description: Detects uses of the SysInternals ProcDump utility in which ProcDump or
  its output get renamed, or a dump file is moved or copied to a different name
references:
- https://twitter.com/mrd0x/status/1480785527901204481
author: Florian Roth (Nextron Systems)
date: 2022-01-11
modified: 2023-05-09
tags:
- attack.defense-evasion
- attack.t1036
- attack.t1003.001
logsource:
  category: process_creation
  product: windows
detection:
  selection_1:
    CommandLine|contains:
    - 'copy procdump'
    - 'move procdump'
  selection_2:
    CommandLine|contains|all:
    - 'copy '
    - '.dmp '
    CommandLine|contains:
    - '2.dmp'
    - 'lsass'
    - 'out.dmp'
  selection_3:
    CommandLine|contains:
    - 'copy lsass.exe_'          # procdump default pattern e.g. lsass.exe_220111_085234.dmp
    - 'move lsass.exe_'          # procdump default pattern e.g. lsass.exe_220111_085234.dmp
  condition: 1 of selection_*
falsepositives:
- False positives are expected in cases in which ProcDump just gets copied to a different
  directory without any renaming
level: high
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect potential evasion tactics related to the SysInternals ProcDump utility within a Windows environment. ProcDump is often used by attackers to capture memory dumps, specifically of sensitive processes such as lsass.exe, which contains authentication credentials. The rule monitors for command-line activity that indicates an attempt to rename or move these dump files, utilizing specific keywords associated with copying or moving the ProcDump utility output files. The relevant telemetry sources include process creation logs, specifically analyzing the command line parameters used when executing processes on Windows. The rule associates with the MITRE ATT&CK techniques for defense evasion (T1036) and credential dumping (T1003.001), highlighting the risk of unauthorized access to sensitive information.
  ### Investigation Steps
  - **Review Process Creation Logs:** Examine the associated command-line arguments from Windows Security Event Logs (Event ID 4688) for any instances of ProcDump being executed or for suspicious commands related to file manipulation.
  - **Analyze EDR Alerts:** Utilize your EDR solution to identify any processes that may have launched ProcDump and verify if any anomalous processes are related to the activity of copying or moving sensitive memory dumps.
  - **Inspect Network Activity Logs:** Investigate any corresponding network connections that may correlate with the ProcDump activity, particularly focusing on communications to external hosts that could indicate exfiltration attempts.
  - **Check File System Changes:** Utilize file integrity monitoring to identify if there were any unauthorized changes or access to the output files, especially in sensitive directories that contain dump files.
  ### Prioritization
  Alerts generated by this rule are marked as high severity because the evasion of credentials can lead to significant security breaches within an enterprise. The presence of unauthorized ProcDump usage may indicate an ongoing attack or compromise.
  ### Blind Spots and Assumptions
  This rule may not fire in scenarios where an adversary renames or moves the memory dump files using alternative methods, or if ProcDump is executed with parameters that do not match the specified criteria. Additionally, legitimate administrative or support activities that involve copying or renaming the tool's output may produce false positives. Furthermore, if logging levels are insufficient, the command-line arguments might not be captured, leading to gaps in detection capabilities.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
