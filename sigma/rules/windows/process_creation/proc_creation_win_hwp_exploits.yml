title: Suspicious HWP Sub Processes
id: 023394c4-29d5-46ab-92b8-6a534c6f447b
status: test
description: Detects suspicious Hangul Word Processor (Hanword) sub processes that
  could indicate an exploitation
references:
- https://www.securitynewspaper.com/2016/11/23/technical-teardown-exploit-malware-hwp-files/
- https://www.hybrid-analysis.com/search?query=context:74940dcc5b38f9f9b1a0fea760d344735d7d91b610e6d5bd34533dd0153402c5&from_sample=5db135000388385a7644131f&block_redirect=1
- https://twitter.com/cyberwar_15/status/1187287262054076416
- https://blog.alyac.co.kr/1901
- https://en.wikipedia.org/wiki/Hangul_(word_processor)
author: Florian Roth (Nextron Systems)
date: 2019-10-24
modified: 2021-11-27
tags:
- attack.initial-access
- attack.t1566.001
- attack.execution
- attack.t1203
- attack.t1059.003
- attack.g0032
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    ParentImage|endswith: '\Hwp.exe'
    Image|endswith: '\gbb.exe'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The "Suspicious HWP Sub Processes" Sigma rule is designed to identify potentially harmful behaviors associated with the Hangul Word Processor (HWP) application, specifically when it spawns sub-processes such as `gbb.exe`. This rule targets the `process_creation` logs in Windows, focusing on instances where the parent process is the legitimate HWP executable (`Hwp.exe`) and a child process is created that matches the maliciously associated executable (`gbb.exe`). The detection is rooted in the understanding that attackers may exploit file formats associated with HWP to execute their payloads and gain initial access to an organization's network, which aligns with the MITRE ATT&CK tactics of Initial Access (TA0001) and Execution (TA0002). By monitoring the specific relationships and behaviors between these processes, we can effectively detect and mitigate potential threats that leverage the HWP application as an entry vector.
  ### Investigation Steps
  - **Verify Process Tree:** Utilize EDR tools to examine the process tree stemming from `Hwp.exe`, ensuring that the context of `gbb.exe` is thoroughly understood in relation to its parent process.
  - **Check Command-Line Arguments:** Review the command-line arguments used to launch `gbb.exe` from Windows Event Logs or Sysmon logs, as abnormal or suspicious parameters can indicate attempted exploitation.
  - **Assess Network Connections:** Analyze network activity associated with the child process using your network detection tools to identify any communication with known malicious IPs or domains.
  - **Examine File Behavior:** Utilize AV and endpoint tools to review any recent changes made by `gbb.exe` to the filesystem, such as the creation or modification of suspicious files, to confirm malicious intent.
  ### Prioritization
  The alert is classified as high severity due to the nature of the processes involved and the potential for exploitation, making timely investigation paramount to mitigate risks of data breaches or malware infections.
  ### Blind Spots and Assumptions
  This rule may miss alerts in scenarios where the process names or paths are obfuscated or changed by adversaries to evade detection. Additionally, it assumes that the processes in question will always execute in context directly from `Hwp.exe`, which may not hold true in every attack scenario. Furthermore, if `gbb.exe` is not present on all systems where HWP is used, legitimate activities could generate false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
