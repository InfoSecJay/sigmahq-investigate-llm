title: HackTool - Rubeus Execution
id: 7ec2c172-dceb-4c10-92c9-87c1881b7e18
related:
- id: 7ec2c172-dceb-4c10-92c9-87c1881b7e18
  type: similar
status: stable
description: Detects the execution of the hacktool Rubeus via PE information of command
  line parameters
references:
- https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus
- https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html
- https://github.com/GhostPack/Rubeus
author: Florian Roth (Nextron Systems)
date: 2018-12-19
modified: 2023-04-20
tags:
- attack.credential-access
- attack.t1003
- attack.t1558.003
- attack.lateral-movement
- attack.t1550.003
logsource:
  category: process_creation
  product: windows
detection:
  selection:
  - Image|endswith: '\Rubeus.exe'
  - OriginalFileName: 'Rubeus.exe'
  - Description: 'Rubeus'
  - CommandLine|contains:
    - 'asreproast '
    - 'dump /service:krbtgt '
    - 'dump /luid:0x'
    - 'kerberoast '
    - 'createnetonly /program:'
    - 'ptt /ticket:'
    - '/impersonateuser:'
    - 'renew /ticket:'
    - 'asktgt /user:'
    - 'harvest /interval:'
    - 's4u /user:'
    - 's4u /ticket:'
    - 'hash /password:'
    - 'golden /aes256:'
    - 'silver /user:'
  condition: selection
falsepositives:
- Unlikely
level: critical
notes: |
  n
  ### Technical Context
  This detection rule identifies the execution of the Rubeus tool, which is often used for credential theft and lateral movement within Windows environments. Rubeus can execute various Kerberos-related tasks, such as ticket extraction or impersonation, leveraging specific command-line arguments that are indicative of its operations. The primary data sources utilized by this detection are Windows process creation logs, particularly capturing the execution details of processes like `Rubeus.exe`, which include the executable's image name, original filename, description, and command-line parameters. When certain flags or commands that are unique to Rubeus are detected, an alert is generated. This rule specifically maps to the MITRE ATT&CK techniques of T1003 (Credential Dumping) and T1558.003 (Valid Accounts â€“ Domain Accounts).
  ### Investigation Steps
  - **Check Process Creation Logs:** Review process creation logs within your EDR for instances of `Rubeus.exe` execution, particularly focusing on command-line parameters that may indicate improper usage.
  - **Analyze User Context:** Determine the user account that executed the command and verify whether it aligns with normal operational behavior or authorized administrative actions.
  - **Review Network Activity:** Examine network connection logs to identify any suspicious outbound connections that might correlate with Rubeus activity, particularly to known command and control servers.
  - **Cross-reference with Authentication Logs:** Use Windows Security logs to check for anomalous authentication attempts or Kerberos ticket requests that may indicate misuse of credentials following Rubeus execution.
  ### Prioritization
  The alert generated by this rule is categorized as critical due to Rubeus being a well-known tool employed for credential theft and lateral movement. Its successful execution could indicate a severe compromise of user credentials, necessitating immediate investigation.
  ### Blind Spots and Assumptions
  The effectiveness of this rule may be limited in environments where Rubeus has been extensively whitelisted or if users have legitimate reasons to invoke Rubeus for authorized security testing. Additionally, stealthy adversaries may modify the command-line parameters or execution context to evade detection. The rule assumes that the process creation logs are intact and not being filtered or modified by threat actors.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
