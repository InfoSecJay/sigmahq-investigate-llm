title: Psexec Execution
id: 730fc21b-eaff-474b-ad23-90fd265d4988
status: test
description: Detects user accept agreement execution in psexec commandline
references:
- https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html
author: omkar72
date: 2020-10-30
modified: 2023-02-28
tags:
- attack.execution
- attack.t1569
- attack.t1021
logsource:
  category: process_creation
  product: windows
detection:
  selection:
  - Image|endswith: '\psexec.exe'
  - OriginalFileName: 'psexec.c'
  condition: selection
falsepositives:
- Administrative scripts.
level: medium
notes: |
  ### Technical Context
  The Sigma rule for Psexec Execution aims to detect instances where the PsExec tool is executed with a user agreement prompt in the command line. PsExec is a powerful tool often used for executing commands remotely on Windows systems. This rule specifically targets the process creation logs generated by Windows, looking for any instances where the executable `psexec.exe` is called. The rule verifies that the `OriginalFileName` matches `psexec.c`, ensuring that it specifically identifies legitimate executions of the PsExec tool. The detection aligns with the MITRE ATT&CK technique T1569 (Remote Services), which encapsulates the behaviors associated with remote execution tools. By monitoring for such executions, security teams can discern unauthorized usage which may indicate potential lateral movement by threat actors within the environment.
  ### Investigation Steps
  - **Check Process Execution:** Examine the process creation logs in your EDR to identify the specific user and machine from which `psexec.exe` was executed, along with the command-line arguments used.
    
  - **Review User Activity:** Investigate the userâ€™s recent activity through Windows Security and Application logs to ensure their activity aligns with their role and privileges for executing remote commands.
  - **Analyze Network Connections:** Use network logs to monitor incoming and outgoing connections established by the executing process to identify any unusual or unauthorized communications.
  - **Correlate with Other Alerts:** Cross-reference this alert with any existing alerts from AV, proxy logs, or firewall logs to identify any associated malicious activity or patterns indicating compromise.
  ### Prioritization
  This alert is classified as medium severity because while it can signify unauthorized remote command execution, it may also stem from legitimate administrative tasks, thus requiring further investigation to validate its context.
  ### Blind Spots and Assumptions
  This rule may not detect PsExec executions if they are obfuscated in a way that modifies the arguments or if the tool is executed from a non-standard path. Additionally, if administrative scripts use PsExec without user interaction, there may be no user agreement prompt logged, rendering the rule ineffective. It's also assumed that the logs are properly configured to record the necessary process creation events; any logging misconfigurations could lead to missed detections.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
