title: Service Started/Stopped Via Wmic.EXE
id: 0b7163dc-7eee-4960-af17-c0cd517f92da
status: test
description: Detects usage of wmic to start or stop a service
references:
- https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-06-20
modified: 2023-02-14
tags:
- attack.execution
- attack.t1047
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - OriginalFileName: 'wmic.exe'
  - Image|endswith: '\WMIC.exe'
  selection_cli:
    CommandLine|contains|all:
    - ' service '
    - ' call '
    CommandLine|contains:
    - 'stopservice'
    - 'startservice'
  condition: all of selection_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The rule titled "Service Started/Stopped Via Wmic.EXE" is designed to detect the execution of the Windows Management Instrumentation Command-line (WMIC) tool for starting or stopping services on a Windows system. This detection focuses on monitoring process creation events, specifically looking for instances where `wmic.exe` is invoked with command-line arguments that include 'service' alongside calls to either `stopservice` or `startservice`. By leveraging Windows Sysmon logs that record process creation data, the rule identifies potentially unauthorized or malicious activity intended to manipulate system services, which can be a tactic used by adversaries for persistence or privilege escalation (MITRE ATT&CK technique T1047).
  Through filtering on the `OriginalFileName` of `wmic.exe` and ensuring that relevant command-line parameters are included, the rule effectively narrows down events of interest. Such actions might indicate an exploitation attempt or misuse of system commands by a malicious actor. The rule operates within the context of execution tactics (ATT&CK technique T1047), emphasizing the need for vigilance regarding the legitimate use of administrative tools and scriptable interfaces in Windows environments.
  ### Investigation Steps
  - **Review Process Creation Logs**: Utilize Sysmon or Windows Security Logs to gather detailed event information for the identified `wmic.exe` process and check for any suspicious parent processes that may indicate an unauthorized execution context.
    
  - **Analyze Command-Line Arguments**: Examine the command line in the process creation logs for the specific arguments used in the `wmic.exe` call, particularly focusing on any 'startservice' or 'stopservice' calls that may pertain to critical system services.
  - **Cross-reference with EDR**: Investigate any related events in the EDR that might provide context or additional indicators of compromise associated with the execution of `wmic.exe`, including any process injections or lateral movement attempts from detected public-facing hosts.
  - **Audit Service Modifications**: Check Windows event logs related to service modifications (Event ID 7045 or similar) to identify any changes made to service configuration or undesired alterations that align with the actions captured by the detection rule.
  ### Prioritization
  The alert generated by this rule is categorized as medium severity since unauthorized service manipulation could signify an ongoing attack, such as privilege escalation or lateral movement, that warrants thorough investigation.
  ### Blind spots and Assumptions
  This detection rule may not fire in cases where `wmic.exe` is invoked in a legitimate context, such as by system administrators performing standard administration tasks. Furthermore, adversaries might utilize obfuscation techniques, alternative command-line tools, or scripts to carry out similar operations without triggering this detection. Assumptions include that the `wmic.exe` binary has not been renamed or replaced, and that adequate Sysmon logging is enabled and configured to capture all relevant process creation events. 
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
