title: Recon Command Output Piped To Findstr.EXE
id: ccb5742c-c248-4982-8c5c-5571b9275ad3
related:
- id: fe63010f-8823-4864-a96b-a7b4a0f7b929
  type: derived
status: experimental
description: |
  Detects the execution of a potential recon command where the results are piped to "findstr". This is meant to trigger on inline calls of "cmd.exe" via the "/c" or "/k" for example.
  Attackers often time use this technique to extract specific information they require in their reconnaissance phase.
references:
- https://github.com/redcanaryco/atomic-red-team/blob/02cb591f75064ffe1e0df9ac3ed5972a2e491c97/atomics/T1057/T1057.md#atomic-test-6---discover-specific-process---tasklist
- https://www.hhs.gov/sites/default/files/manage-engine-vulnerability-sector-alert-tlpclear.pdf
- https://www.trendmicro.com/en_us/research/22/d/spring4shell-exploited-to-deploy-cryptocurrency-miners.html
author: Nasreddine Bencherchali (Nextron Systems), frack113
date: 2023-07-06
modified: 2024-06-27
tags:
- attack.discovery
- attack.t1057
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains:
            # Note: Add additional CLI to increase and enhance coverage
            # Note: We use wildcards in this instance to avoid writing a lot of variations that can be avoided easily. You can switch to regex if its supported by your backend.
    - 'ipconfig*|*find'
    - 'net*|*find'
    - 'netstat*|*find'
    - 'ping*|*find'
    - 'systeminfo*|*find'
    - 'tasklist*|*find'
    - 'whoami*|*find'
  condition: selection
falsepositives:
- Unknown
level: medium
notes: |
  n
  ### Technical Context
  This detection rule aims to identify potential reconnaissance activity through the execution of command-line instructions that involve piping output to `findstr.exe`. Reconnaissance is a key phase in many cyber attacks where adversaries gather information about a target's network, services, and user information. The rule specifically checks for the use of `cmd.exe` with parameters `/c` or `/k`, indicating an inline command that outputs the result of system commands like `ipconfig` or `whoami` piped to `findstr.exe`, which is often used to filter command output. By monitoring process creation logs (specifically the CommandLine field) on Windows systems, this rule leverages the MITRE ATT&CK technique T1057 (Process Discovery) to highlight suspicious command executions that may indicate an attempted reconnaissance.
  ### Investigation Steps
  - **Review Process Creation Events:** Investigate the process creation logs in your EDR system for instances of `cmd.exe` being executed with suspicious command lines that include piping to `findstr.exe`.
  - **Analyze Command Output:** If available, check if the output of the recognized commands accessed specific sensitive information (e.g., user accounts, network configurations) that could justify the reconnaissance actions.
  - **Correlate with Network Logs:** Look for any corresponding network connections or abnormal outbound activities around the same time as the command execution to identify potential data exfiltration attempts.
  - **Check for User Behavior:** Examine the user account associated with the command execution to determine if their activity aligns with their role and typical behavior within the organization.
  ### Prioritization
  The alert generated by this detection rule is classified as medium severity since reconnaissance activities, while often preparatory, can indicate potential insider threats or active outside attackers gathering information that could lead to a more severe attack.
  ### Blind spots and Assumptions
  This detection rule may not trigger if attackers use methods to disguise their commands or utilize other tools that do not invoke `cmd.exe` directly or bypass normal process execution logging. Furthermore, the effectiveness of this rule relies on the proper configuration of Sysmon to log process creation events accurately. Additionally, if users regularly run these commands for legitimate administrative purposes, it might lead to false positives, requiring further contextual investigation.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
