title: Tor Client/Browser Execution
id: 62f7c9bf-9135-49b2-8aeb-1e54a6ecc13c
status: test
description: Detects the use of Tor or Tor-Browser to connect to onion routing networks
references:
- https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/
author: frack113
date: 2022-02-20
modified: 2023-02-13
tags:
- attack.command-and-control
- attack.t1090.003
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    Image|endswith:
    - '\tor.exe'
    - '\Tor Browser\Browser\firefox.exe'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  The "Tor Client/Browser Execution" Sigma rule is designed to identify instances where Tor or the Tor Browser is being executed on Windows systems. By capturing process creation events, this rule specifically looks for the execution of processes associated with Tor, such as `tor.exe` and `firefox.exe` found in the Tor Browser installation directory. This detection is based on process creation logs that provide insights into the command-line parameters and the paths of running applications. The rule aligns with the MITRE ATT&CK framework, specifically addressing the Command and Control tactic, highlighting technique T1090.003, which pertains to the use of Tor for establishing anonymous communications.
  ### Investigation Steps
  - **Review Process Creation Logs**: Check Windows Security logs or Sysmon logs for events related to the identified Tor processes, noting the execution time and user context.
  - **Analyze Network Connections**: Utilize your EDR and NDR tools to examine outbound network connections at the time of Tor execution, focusing on any connections to known Tor exit nodes or onion services.
  - **Inspect User Activity**: Correlate user activity during the time of the Tor execution to assess if it aligns with typical usage patterns or if it raises suspicion of malicious intent.
  - **Check System Integrity**: Run checks on the file integrity of the Tor installation and related components to ensure no file tampering has occurred, which may suggest a bypass of detection mechanisms.
  ### Prioritization
  Alerts generated by this rule are classified as high severity, given that the use of Tor can indicate attempts to hide malicious activities such as data exfiltration or command and control communication, both of which pose significant risks to enterprise security.
  ### Blind Spots and Assumptions
  One recognized blind spot is that users may legitimate reasons to utilize Tor, potentially leading to false positives. Additionally, the rule may fail to fire if the attacker uses alternative tools to achieve anonymization or modifies the executable names to evade detection. Assumptions around user permissions can also affect the rule's efficacy, as instances run with administrative rights may bypass standard monitoring mechanisms.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
