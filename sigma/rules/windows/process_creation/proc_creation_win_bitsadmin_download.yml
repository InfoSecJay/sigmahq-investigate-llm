title: File Download Via Bitsadmin
id: d059842b-6b9d-4ed1-b5c3-5b89143c6ede
status: test
description: Detects usage of bitsadmin downloading a file
references:
- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin
- https://isc.sans.edu/diary/22264
- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/
author: Michael Haag, FPT.EagleEye
date: 2017-03-09
modified: 2023-02-15
tags:
- attack.defense-evasion
- attack.persistence
- attack.t1197
- attack.s0190
- attack.t1036.003
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - Image|endswith: '\bitsadmin.exe'
  - OriginalFileName: 'bitsadmin.exe'
  selection_cmd:
    CommandLine|contains: ' /transfer '
  selection_cli_1:
    CommandLine|contains:
    - ' /create '
    - ' /addfile '
  selection_cli_2:
    CommandLine|contains: 'http'
  condition: selection_img and (selection_cmd or all of selection_cli_*)
fields:
- CommandLine
- ParentCommandLine
falsepositives:
- Some legitimate apps use this, but limited.
level: medium
notes: |
  ### Technical Context
  The Sigma rule titled "File Download Via Bitsadmin" is designed to identify potentially malicious usage of the Bitsadmin tool, a Windows command-line utility primarily used for managing background downloads and uploads. The rule specifically looks for instances where Bitsadmin is invoked with the `/transfer`, `/create`, or `/addfile` command-line parameters, particularly when these commands include HTTP URLs. These command-line patterns may signify attempts by an attacker to download files using a native Windows tool to evade detection by security systems. 
  The relevant technical data sources for this detection include process creation logs that capture the execution of processes, command-line parameters passed to these processes, and the properties of the executable (e.g., original file name). The detection aligns with the MITRE ATT&CK tactics of Defense Evasion (T1573) and Persistence (T1197), as malicious actors may use Bitsadmin to download and execute additional payloads stealthily.
  ### Investigation Steps
  - **Check Process Creation Logs:** Review the process creation logs in your EDR or Sysmon to confirm unauthorized execution of `bitsadmin.exe` and gather context around the parent process that initiated it.
  - **Analyze Command-Line Parameters:** Investigate the command line associated with the Bitsadmin execution to identify if the transfer commands contained URLs leading to potentially malicious files; pay particular attention to any use of HTTP or non-standard file sources.
  - **Cross-reference with Historical Data:** Use Windows Security logs or EDR telemetry to correlate the time of the suspicious Bitsadmin use with other alerts or anomalies in the environment to understand if this is part of a larger campaign.
  - **Review Network Traffic:** Analyze network connection logs from your firewall or NDR tools around the time of the Bitsadmin execution to identify any outbound connections to known malicious IPs or domains.
  ### Prioritization
  The alert generated by this rule is considered of medium severity due to the potential for both legitimate and malicious usage of Bitsadmin. However, given the tool's affinity for evading detection, notably when associated with suspicious command-line behaviors, it warrants timely investigation.
  ### Blind spots and Assumptions
  - **Legitimate Use Cases:** The rule might not trigger for legitimate applications that utilize Bitsadmin for valid purposes. This points to a recognized blind spot, as the detection is context-sensitive.
  - **User-Agent Obfuscation:** Adversaries can change their techniques or employ additional layers of obfuscation that may bypass this detection by using alternative command-line options or tools.
  - **Environment Variability:** The assumption that all systems will generate consistent logs may not hold true, especially in environments where logging is misconfigured or Sysmon isnâ€™t implemented across all devices. 
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
