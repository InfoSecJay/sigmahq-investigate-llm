title: Suspicious File Download From File Sharing Domain Via Curl.EXE
id: 56454143-524f-49fb-b1c6-3fb8b1ad41fb
status: experimental
description: Detects potentially suspicious file download from file sharing domains
  using curl.exe
references:
- https://labs.withsecure.com/publications/fin7-target-veeam-servers
- https://github.com/WithSecureLabs/iocs/blob/344203de742bb7e68bd56618f66d34be95a9f9fc/FIN7VEEAM/iocs.csv
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-05-05
modified: 2024-10-21
tags:
- attack.execution
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - Image|endswith: '\curl.exe'
  - OriginalFileName: 'curl.exe'
  selection_websites:
    CommandLine|contains:
    - '.githubusercontent.com'               # Includes both gists and github repositories / Michael Haag (idea)
    - 'anonfiles.com'
    - 'cdn.discordapp.com'
    - 'ddns.net'
    - 'dl.dropboxusercontent.com'
    - 'ghostbin.co'
    - 'glitch.me'
    - 'gofile.io'
    - 'hastebin.com'
    - 'mediafire.com'
    - 'mega.nz'
    - 'onrender.com'
    - 'pages.dev'
    - 'paste.ee'
    - 'pastebin.com'
    - 'pastebin.pl'
    - 'pastetext.net'
    - 'pixeldrain.com'
    - 'privatlab.com'
    - 'privatlab.net'
    - 'send.exploit.in'
    - 'sendspace.com'
    - 'storage.googleapis.com'
    - 'storjshare.io'
    - 'supabase.co'
    - 'temp.sh'
    - 'transfer.sh'
    - 'trycloudflare.com'
    - 'ufile.io'
    - 'w3spaces.com'
    - 'workers.dev'
  selection_http:
    CommandLine|contains: 'http'
  selection_flag:
    CommandLine|contains:
    - ' -O'          # covers the alias for --remote-name and --output
    - '--remote-name'
    - '--output'
  selection_ext:
    CommandLine|endswith:
    - ".ps1"
    - ".ps1'"
    - '.ps1"'
    - ".dat"
    - ".dat'"
    - '.dat"'
    - ".msi"
    - ".msi'"
    - '.msi"'
    - ".bat"
    - ".bat'"
    - '.bat"'
    - ".exe"
    - ".exe'"
    - '.exe"'
    - ".vbs"
    - ".vbs'"
    - '.vbs"'
    - ".vbe"
    - ".vbe'"
    - '.vbe"'
    - ".hta"
    - ".hta'"
    - '.hta"'
    - ".dll"
    - ".dll'"
    - '.dll"'
    - ".psm1"
    - ".psm1'"
    - '.psm1"'
  condition: all of selection_*
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This detection rule triggers an alert for suspicious file downloads performed using `curl.exe` from known file-sharing domains. `curl.exe` is a command-line tool widely used for transferring data with URLs, and malicious actors often misuse it to download data, especially executable files or scripts from various external sources. The rule looks for process creation events where the command line executed contains specific parameters indicating that a file is being downloaded. It monitors not only the image name of the process (ensuring it's `curl.exe`) but also examines the command line for URLs associated with common file-sharing sites, the indication of output redirection (like `-O` or `--output`), and the file extensions typical for suspicious files (.exe, .ps1, .vbs, etc.). This aligns with the MITRE ATT&CK technique T1203 (Exploitation for Client Execution), providing visibility into potentially harmful downloads and subsequent exploits.
  ### Investigation Steps
  - **Check EDR for Alerts:** Investigate the endpoint where the alert was generated by checking for additional alerts related to process creation, unusual command line activity, or other file transfers.
  - **Analyze Network Traffic:** Use NDR tools to assess outgoing and incoming traffic related to the suspicious download; specifically, look for connections to the flagged domains during the timeframe of the alert.
  - **Review Windows Event Logs:** Inspect Windows Security and Sysmon logs for any related events that may indicate unauthorized access or suspicious behavior that further correlates with the alert.
  - **Cross-reference Files:** If a file was downloaded, check the hash and file contents against known malware databases or run it in a sandbox to determine if it is malicious.
  ### Prioritization
  The severity level is marked as high due to the potential for attackers to download malicious payloads onto organizational systems. Such downloads can lead to further exploitation, lateral movement, or data exfiltration, warranting immediate investigation.
  ### Blind Spots and Assumptions
  This rule assumes that all executions of `curl.exe` are being logged and that the detection covers typical malicious behavior patterns. However, if attackers obfuscate their commands or use alternative tools for downloads, such as PowerShell scripts, the rule may fail to fire. Moreover, if certain URLs or command line parameters evolve or if the environment has restricted logging configurations, legitimate downloads could be erroneously flagged as malicious.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
