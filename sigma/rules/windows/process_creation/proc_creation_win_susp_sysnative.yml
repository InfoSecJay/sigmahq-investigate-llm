title: Process Creation Using Sysnative Folder
id: 3c1b5fb0-c72f-45ba-abd1-4d4c353144ab
status: test
description: Detects process creation events that use the Sysnative folder (common
  for CobaltStrike spawns)
references:
- https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/
author: Max Altgelt (Nextron Systems)
date: 2022-08-23
modified: 2023-12-14
tags:
- attack.defense-evasion
- attack.privilege-escalation
- attack.t1055
logsource:
  category: process_creation
  product: windows
detection:
  sysnative:
  - CommandLine|contains: ':\Windows\Sysnative\'
  - Image|contains: ':\Windows\Sysnative\'
  condition: sysnative
falsepositives:
- Unknown
level: medium
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect process creation events that utilize the Sysnative folder, which is often associated with malicious activities, such as those conducted using Cobalt Strike. The Sysnative folder provides a way for 32-bit applications to access the 64-bit system directory on Windows, and when processes spawn from this directory, it can indicate an attempt to evade detection or escalate privileges. The rule leverages data sources including process creation logs and command-line parameters to identify instances where the command line or image path contains the string `:\Windows\Sysnative\`. This detection aligns with the MITRE ATT&CK techniques of Defense Evasion (T1070.001) and Privilege Escalation (T1055).
  ### Investigation Steps
  - **Check EDR Alerts:** Review alerts generated by the EDR for any flagged process creation events that include the usage of the Sysnative directory. Investigate the parent process to assess the context and intent of the creation.
  - **Analyze Command-Line Parameters:** Examine the command-line parameters associated with the process creation events to identify any unusual or suspicious flags that may indicate malicious activity.
  - **Inspect Sysmon Logs:** Query Sysmon logs for additional details on the created processes and their relationships with other processes, focusing on timestamps and any associated user accounts.
  - **Review Network Connections:** Use network detection tools to identify any outbound connections made by the processes that originated from the Sysnative folder, which could further corroborate malicious intent.
  ### Prioritization
  The alert is categorized as medium severity due to the association of the Sysnative directory with advanced evasion techniques commonly used by sophisticated threats, such as Cobalt Strike. While not all instances are inherently malicious, they warrant closer scrutiny due to the potential risk of privilege escalation or further compromise.
  ### Blind spots and Assumptions
  This rule may not fire in environments where the Sysnative directory is legitimately used by benign applications. Additionally, if an adversary is aware of this detection rule, they may employ techniques to avoid using the Sysnative folder altogether, thereby bypassing detection. Finally, false positives might arise if legitimate applications or scripts reference this folder.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
