title: New Virtual Smart Card Created Via TpmVscMgr.EXE
id: c633622e-cab9-4eaa-bb13-66a1d68b3e47
status: test
description: Detects execution of "Tpmvscmgr.exe" to create a new virtual smart card.
references:
- https://learn.microsoft.com/en-us/windows/security/identity-protection/virtual-smart-cards/virtual-smart-card-tpmvscmgr
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-06-15
tags:
- attack.execution
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
    Image|endswith: '\tpmvscmgr.exe'
    OriginalFileName: 'TpmVscMgr.exe'
  selection_cli:
    CommandLine|contains: 'create'
  condition: all of selection_*
falsepositives:
- Legitimate usage by an administrator
level: medium
notes: |
  n
  ### Technical Context
  This detection rule identifies the creation of new virtual smart cards through the execution of `TpmVscMgr.exe`, a legitimate Windows utility for managing Trusted Platform Module (TPM) virtual smart cards. The rule triggers upon recognizing process creation events where `TpmVscMgr.exe` is invoked with a command line parameter containing the word "create." Specifically, it examines process creation logs as the primary data source, focusing on both the executed image and the command-line parameters to differentiate between normal usage and potential misuse.
  Security teams should be aware that while the execution of `TpmVscMgr.exe` can be indicative of administrative tasks, it may also represent an attempt to bypass security measures by creating unauthorized virtual smart cards. Thus, proper analysis of alerts generated by this rule is essential to ensure legitimate operations are distinguished from malicious activities.
  ### Investigation Steps
  - Review process creation logs in your EDR tool to verify the execution of `TpmVscMgr.exe` and assess the originating user account and context around the command.
  - Analyze the command-line parameters used with `TpmVscMgr.exe` to confirm if the action aligns with legitimate administrative tasks or if it raises suspicions of tampering.
  - Cross-reference the timing and source of the alert with access logs from VPN or Proxy to determine whether non-standard access patterns coincide with the execution.
  - Consult relevant cloud platform logs (AWS, GCP, Azure) for any associated activities or connections that may indicate compromised credentials or unauthorized attempts at accessing critical infrastructures.
