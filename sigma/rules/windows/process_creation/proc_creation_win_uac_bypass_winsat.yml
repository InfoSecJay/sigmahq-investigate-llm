title: UAC Bypass Abusing Winsat Path Parsing - Process
id: 7a01183d-71a2-46ad-ad5c-acd989ac1793
status: test
description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe
  (UACMe 52)
references:
- https://github.com/hfiref0x/UACME
author: Christian Burkard (Nextron Systems)
date: 2021-08-30
modified: 2024-12-01
tags:
- attack.defense-evasion
- attack.privilege-escalation
- attack.t1548.002
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    IntegrityLevel:
    - 'High'
    - 'System'
    - 'S-1-16-16384'         # System
    - 'S-1-16-12288'         # High
    ParentImage|endswith: '\AppData\Local\Temp\system32\winsat.exe'
    ParentCommandLine|contains: 'C:\Windows \system32\winsat.exe'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This detection rule identifies potential User Account Control (UAC) bypass attempts that leverage a path parsing issue in the Windows System Assessment Tool (winsat.exe). The mechanism works by monitoring process creation events for instances where processes are spawned with elevated privileges (High or System Integrity Levels) and are initiated by a parent process that improperly references winsat.exe. Specifically, the rule looks for processes that either originate from a specific directory—`C:\AppData\Local\Temp\system32\winsat.exe`—or contain clues in their parent command line arguments that may indicate a manipulation of the expected execution path. This exploitation tactic is documented within the MITRE ATT&CK framework under the tactic of “Defense Evasion” and the technique identifier T1548.002.
  To gather data for this rule, Windows process creation logs such as those generated by Sysmon are analyzed. These logs provide insights into which processes are being executed, their command-line parameters, and the integrity levels associated with them. By cross-referencing this data against the established criteria, this rule flags potentially malicious behavior that attempts to bypass established security constraints in the Windows operating environment.
  ### Investigation Steps
  - **Check Process Execution Context:** Review the logs for the specific execution of winsat.exe. Confirm the parent process and command line to determine if it aligns with known exploitation patterns.
    
  - **Inspect Integrity Levels:** Verify the integrity levels of the flagged processes using EDR tools. This can help ascertain if a process is operating with elevated privileges that may indicate an exploitation attempt.
    
  - **Correlate Previous Activities:** Use AV and SIEM solutions to correlate this alert with previous alerts or behaviors of the affected system. Identifying any previous suspicious activity can provide context for the current incident.
    
  - **Review User Actions:** Examine user activity logs on the impacted machine, focusing on any unusual behavior that might suggest the execution of malicious scripts or commands leading to the alert.
  ### Prioritization
  Given the potential for privilege escalation and the ability of the exploit to bypass crucial system defenses, this alert is considered high severity. Such tactics can lead to unauthorized access to sensitive data and critical network resources.
  ### Blind Spots and Assumptions
  This rule may not trigger if the attacker is utilizing software or techniques that sufficiently obscure the parent process or command line properties. Additionally, if the exploitation is carried out in a way that does not adhere to the specified patterns or uses renamed binaries, it may go undetected. It is presumed that alerts will only be raised in environments where Sysmon and process creation logging are properly configured and monitored.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
