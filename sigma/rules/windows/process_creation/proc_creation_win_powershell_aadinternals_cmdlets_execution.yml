title: AADInternals PowerShell Cmdlets Execution - ProccessCreation
id: c86500e9-a645-4680-98d7-f882c70c1ea3
related:
- id: 91e69562-2426-42ce-a647-711b8152ced6
  type: similar
status: test
description: Detects ADDInternals Cmdlet execution. A tool for administering Azure
  AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office
  365.
references:
- https://o365blog.com/aadinternals/
- https://github.com/Gerenios/AADInternals
author: Austin Songer (@austinsonger), Nasreddine Bencherchali (Nextron Systems),
  Swachchhanda Shrawan Poudel (Nextron Systems)
date: 2022-12-23
modified: 2025-02-06
tags:
- attack.execution
- attack.reconnaissance
- attack.discovery
- attack.credential-access
- attack.impact
logsource:
  product: windows
  category: process_creation
detection:
  selection_img:
  - Image|endswith:
    - '\powershell.exe'
    - '\powershell_ise.exe'
    - '\pwsh.exe'
  - OriginalFileName:
    - 'PowerShell.Exe'
    - 'pwsh.dll'
  selection_cli:
    CommandLine|contains:
            # Since most of the cmdlets use a unique enough string which is "-AADInt" we only used that portion. For a complete list please check the references linked above
    - 'Add-AADInt'
    - 'ConvertTo-AADInt'
    - 'Disable-AADInt'
    - 'Enable-AADInt'
    - 'Export-AADInt'
    - 'Find-AADInt'
    - 'Get-AADInt'
    - 'Grant-AADInt'
    - 'Initialize-AADInt'
    - 'Install-AADInt'
    - 'Invoke-AADInt'
    - 'Join-AADInt'
    - 'New-AADInt'
    - 'Open-AADInt'
    - 'Read-AADInt'
    - 'Register-AADInt'
    - 'Remove-AADInt'
    - 'Reset-AADInt'
    - 'Resolve-AADInt'
    - 'Restore-AADInt'
    - 'Save-AADInt'
    - 'Search-AADInt'
    - 'Send-AADInt'
    - 'Set-AADInt'
    - 'Start-AADInt'
    - 'Unprotect-AADInt'
    - 'Update-AADInt'
  condition: all of selection_*
falsepositives:
- Legitimate use of the library for administrative activity
level: high
notes: |
  ### Technical Context
  The Sigma rule "AADInternals PowerShell Cmdlets Execution 
  - ProcessCreation" is designed to monitor and detect the execution of specific PowerShell cmdlets associated with AADInternals, a tool used for managing Azure AD and Office 365. The rule focuses on process creation events in Windows environments, specifically by observing PowerShell (or its variants) invocations that include command-line parameters indicative of AADInternals usage, such as `Add-AADInt`, `Get-AADInt`, and others related to Azure AD manipulation. This activity is relevant to the MITRE ATT&CK tactics of Execution, Reconnaissance, Discovery, Credential Access, and Impact, highlighting the potential for adversaries to utilize this powerful toolkit for malicious purposes.
  The primary data sources leveraged by this detection rule include process creation logs from Windows Security, capturing details such as the image name and command-line parameters involved in the execution of PowerShell instances. By focusing on the patterns and keywords unique to AADInternals, the rule aims to identify instances where this tool may be executed, which could signify either legitimate administrative activity or malicious attempts to extend control or access sensitive data within Azure services.
  ### Investigation Steps
  - **Analyze the Alert Context:** Review the alert details in your SIEM for associated user accounts and timelines to identify whether the executed commands align with known administrative activities.
  - **Examine Process Tree:** Use EDR tools to analyze the parent-child process relationship around the process creation event to determine what initiated the PowerShell command and if it was spawned by a potentially malicious context.
  - **Correlate With Azure Logs:** Cross-reference the alert with Azure AD activity logs to see if any unauthorized changes or access attempts correlate with the execution of the AADInternals cmdlets.
  - **Review User Activity:** Check the userâ€™s historical activity and behavior with the Proxy and VPN logs to assess if this behavior is typical or an indication of potential account compromise or abuse.
  ### Prioritization
  Given the ease with which AADInternals can be misused by threat actors to gain unauthorized access or perform malicious actions within Azure environments, alerts generated by this rule should be considered high severity. Prompt investigation is essential to mitigate potential security incidents.
  ### Blind Spots and Assumptions
  This rule may not fire in environments where PowerShell is restricted or monitored specifically for administrative actions, thus limiting legitimate usage. Additionally, should an adversary execute commands by disguising their intent, such as through legitimate software or obfuscation techniques, the rule may fail to detect such activities. It assumes that the cmdlets are accurately invoked and logged; therefore, any discrepancies or altered logging configurations might hinder detection capabilities.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and to provide accurate guidance, we recommend validating the content and adapting it to suit specific environmental and operational needs. Please communicate any changes to the detection engineering team.
