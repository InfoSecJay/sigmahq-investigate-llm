title: File Download Via Bitsadmin To An Uncommon Target Folder
id: 6e30c82f-a9f8-4aab-b79c-7c12bce6f248
status: test
description: Detects usage of bitsadmin downloading a file to uncommon target folder
references:
- https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin
- https://isc.sans.edu/diary/22264
- https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/
- https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/
author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2022-06-28
modified: 2023-02-15
tags:
- attack.defense-evasion
- attack.persistence
- attack.t1197
- attack.s0190
- attack.t1036.003
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - Image|endswith: '\bitsadmin.exe'
  - OriginalFileName: 'bitsadmin.exe'
  selection_flags:
    CommandLine|contains:
    - ' /transfer '
    - ' /create '
    - ' /addfile '
  selection_folder:
    CommandLine|contains:
    - '%AppData%'
    - '%temp%'
    - '%tmp%'
    - '\AppData\Local\'
    - 'C:\Windows\Temp\'
  condition: all of selection_*
fields:
- CommandLine
- ParentCommandLine
falsepositives:
- Unknown
level: medium
notes: |
  n
  ### Technical Context
  This Sigma rule detects the usage of the `bitsadmin.exe` utility to download files to uncommon target folders, specifically those associated with temporary files or user-specific application data. The rule looks for command line parameters that indicate the creation and management of downloads, such as `/transfer`, `/create`, and `/addfile`, paired with target locations that are generally not typical for legitimate file downloads. The detection relies on process creation logs to identify instances of `bitsadmin.exe` being executed in conjunction with these command line arguments and folder paths, which may suggest malicious intent. This behavior aligns with multiple MITRE ATT&CK tactics, notably **T1197 (Business Email Compromise)** and **T1036.003 (Masquerading: Match Legitimate Name or Path)**, indicating potential evasion techniques used by adversaries to persist within the environment.
  ### Investigation Steps
  - **Validate `bitsadmin.exe`:** Check the process tree in your EDR tool for `bitsadmin.exe` instances and confirm if they have legitimate parent processes.
  - **Command Line Analysis:** Review the command line arguments captured in the process creation logs to identify the suspicious arguments used during execution and correlate them with potential threats.
  - **Check Target Directories:** Investigate the uncommon folders specified in the alert to see if any downloaded files exist that could indicate unauthorized access or data exfiltration.
  - **Monitor User Activity:** Review the user account associated with the `bitsadmin.exe` execution for any atypical activity or other flagged actions in event logs, AV, or proxy logs.
  ### Prioritization
  Alerts generated by this rule should be treated with medium severity due to the potential for file downloads from external sources that may indicate an active breach or compromise of the network. The uncommon target paths further suggest circumvention of established security measures.
  ### Blind Spots and Assumptions
  This rule may not fire if an attacker uses alternate methods to download files that do not involve `bitsadmin.exe`, such as PowerShell or other legitimate download tools. Additionally, the use of deceptive folder names that appear standard could bypass this detection. Assumptions include that all systems log process creation reliably; in cases where logging is disabled or misconfigured, the rule will not trigger, leaving potential threats undetected.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
