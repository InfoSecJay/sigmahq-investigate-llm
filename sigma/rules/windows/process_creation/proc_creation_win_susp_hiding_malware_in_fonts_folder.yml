title: Writing Of Malicious Files To The Fonts Folder
id: ae9b0bd7-8888-4606-b444-0ed7410cb728
status: test
description: Monitors for the hiding possible malicious files in the C:\Windows\Fonts\
  location. This folder doesn't require admin privillege to be written and executed
  from.
references:
- https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/
author: Sreeman
date: 2020-04-21
modified: 2022-03-08
tags:
- attack.t1211
- attack.t1059
- attack.defense-evasion
- attack.persistence
logsource:
  product: windows
  category: process_creation
detection:
  selection_1:
    CommandLine|contains:
    - 'echo'
    - 'copy'
    - 'type'
    - 'file createnew'
    - 'cacls'
  selection_2:
    CommandLine|contains: 'C:\Windows\Fonts\'
  selection_3:
    CommandLine|contains:
    - '.sh'
    - '.exe'
    - '.dll'
    - '.bin'
    - '.bat'
    - '.cmd'
    - '.js'
    - '.msh'
    - '.reg'
    - '.scr'
    - '.ps'
    - '.vb'
    - '.jar'
    - '.pl'
    - '.inf'
    - '.cpl'
    - '.hta'
    - '.msi'
    - '.vbs'
  condition: all of selection_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The detection rule titled "Writing Of Malicious Files To The Fonts Folder" is specifically designed to monitor and identify malicious activity involving the C:\Windows\Fonts directory on Windows systems. This folder is often exploited by attackers to store and execute malicious files, as it does not require administrative privileges for writing or executing files. The rule employs multiple detection criteria utilizing process creation logs, specifically focusing on command-line parameters that indicate the creation or manipulation of files within this directory. Key indicators include commands associated with file creation and modification, followed by an examination of specific file extensions that are commonly associated with potential malware types, such as executable files (.exe) or scripts (.bat, .js, etc.). The rule aligns with the MITRE ATT&CK tactics pertaining to “Defense Evasion” (T1211) and “Script-Based Payloads” (T1059), exploiting the Fonts folder as a method of persistence and obfuscation.
  ### Investigation Steps
  - **Review Process Creation Logs**: Utilize your EDR to search for process creation events that include command-line arguments related to the Fonts directory, specifically focusing on unauthorized file manipulations.
  - **Correlate with Event Logs**: Analyze Windows Security and System event logs to identify any correlated logins or admin activities around the time of the alert that could indicate potential misuse.
  - **Inspect File Modifications**: Check the Fonts folder for recent file changes or additions, paying close attention to any unfamiliar file types or unusual timestamps.
  - **Analyze Network Activity**: Utilize NDR and proxy logs to identify any outbound connections made by processes related to suspicious file operations, tracing back any possible command and control (C2) communications.
  ### Prioritization
  This alert is classified as medium severity due to the potential for malicious actors to hide malware in the Fonts folder, which could lead to significant security breaches if these files are executed within the environment.
  ### Blind Spots and Assumptions
  The rule may not fire if legitimate applications are incorrectly using this folder for benign purposes, or if an attacker uses an alternative method to conceal malware that does not match the command criteria specified. Additionally, if command-line logging is disabled or if process creation logs are not captured adequately, the rule could fail to detect malicious file operations effectively. Analysts should also consider that determined adversaries may employ tools to obfuscate their activities, making detection more challenging.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
