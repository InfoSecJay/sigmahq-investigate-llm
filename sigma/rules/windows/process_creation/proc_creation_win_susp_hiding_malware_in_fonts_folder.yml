title: Writing Of Malicious Files To The Fonts Folder
id: ae9b0bd7-8888-4606-b444-0ed7410cb728
status: test
description: Monitors for the hiding possible malicious files in the C:\Windows\Fonts\
  location. This folder doesn't require admin privillege to be written and executed
  from.
references:
- https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/
author: Sreeman
date: 2020-04-21
modified: 2022-03-08
tags:
- attack.t1211
- attack.t1059
- attack.defense-evasion
- attack.persistence
logsource:
  product: windows
  category: process_creation
detection:
  selection_1:
    CommandLine|contains:
    - 'echo'
    - 'copy'
    - 'type'
    - 'file createnew'
    - 'cacls'
  selection_2:
    CommandLine|contains: 'C:\Windows\Fonts\'
  selection_3:
    CommandLine|contains:
    - '.sh'
    - '.exe'
    - '.dll'
    - '.bin'
    - '.bat'
    - '.cmd'
    - '.js'
    - '.msh'
    - '.reg'
    - '.scr'
    - '.ps'
    - '.vb'
    - '.jar'
    - '.pl'
    - '.inf'
    - '.cpl'
    - '.hta'
    - '.msi'
    - '.vbs'
  condition: all of selection_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  This detection rule monitors for potentially malicious file creation activities within the `C:\Windows\Fonts\` directory, which is commonly abused by attackers to hide and execute files without requiring administrative privileges. The rule specifically looks for processes that include certain command-line parameters indicative of creating files (`echo`, `copy`, `type`, etc.) and accessing the Fonts directory. Additionally, it checks for the presence of various executable file extensions known to be associated with malicious files (e.g., `.exe`, `.dll`, `.bat`, etc.). By continuously reviewing process creation logs, this rule helps to identify potential threats that aim to establish persistence or evade detection by hiding files in less scrutinized system folders.
  ### Investigation Steps
  - Use EDR tools to review the process creation logs related to any alerts generated by this rule to identify the initiating processes and command-line arguments used.
  - Cross-reference the identified process with threat intelligence feeds to determine if the process or file is associated with known malware or suspicious activity.
  - Inspect the contents and signatures of any files located in the `C:\Windows\Fonts\` directory that were created or modified around the time of the alert to ascertain their legitimacy.
  - Check network and proxy logs for any unusual outbound connections from the detected processes, which may indicate further malicious behavior or data exfiltration.
