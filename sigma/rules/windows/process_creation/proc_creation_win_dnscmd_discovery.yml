title: Potential Discovery Activity Via Dnscmd.EXE
id: b6457d63-d2a2-4e29-859d-4e7affc153d1
status: test
description: Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones
  of a domain. DNS zones used to host the DNS records for a particular domain.
references:
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd
- https://learn.microsoft.com/en-us/azure/dns/dns-zones-records
- https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/
author: '@gott_cyber'
date: 2022-07-31
modified: 2023-02-04
tags:
- attack.discovery
- attack.execution
- attack.t1543.003
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
    Image|endswith: '\dnscmd.exe'
  selection_cli:
    CommandLine|contains:
    - '/enumrecords'
    - '/enumzones'
    - '/ZonePrint'
    - '/info'
  condition: all of selection_*
falsepositives:
- Legitimate administration use
level: medium
notes: |
  ### Technical Context
  The Sigma rule titled "Potential Discovery Activity Via Dnscmd.EXE" is designed to detect potential enumeration activities leveraging the `dnscmd.exe` tool, which is a command-line utility for managing DNS servers in a Windows environment. The rule identifies command executions containing specific parameters such as `/enumrecords`, `/enumzones`, `/ZonePrint`, or `/info`, indicating that an actor may be trying to enumerate DNS zones or records of a domain. Monitoring is conducted through process creation logs, which capture the invocation of processes, including the command-line parameters used during execution. This detection aligns with the MITRE ATT&CK tactic for Discovery (TA0007) particularly focusing on the technique T1543.003, which pertains to the potential misuse of system utilities for reconnaissance purposes.
  ### Investigation Steps
  - **Review Process Creation Logs:** Examine logs from Sysmon or Windows Security that detail the execution of `dnscmd.exe` and the associated command-line parameters for suspicious activity.
  - **Verify the User Context:** Check the user account that executed the command to determine if it is a legitimate administrator account or potentially a compromised user account.
  - **Cross-reference with Network Activity:** Use EDR and network logs to investigate any outbound DNS queries around the same time to see if there are unusual patterns or destinations that might indicate unauthorized scanning or reconnaissance.
  - **Identify Legitimate Administration Tasks:** Consult internal documentation to confirm if the command execution corresponds to known administrative processes; this can help validate potential false positives.
  ### Prioritization
  The alert generated by this rule is prioritized as medium severity due to the potential for malicious use in enumerating DNS records, which could aid an adversary in mapping out an organization's network infrastructure.
  ### Blind Spots and Assumptions 
  There are assumptions that the telemetry for process creation is adequately collected and that `dnscmd.exe` is not being executed as part of legitimate administrative tasks. This rule may not fire if an adversary uses alternate methods or tools to gather DNS data, or if the execution of the command occurs with legitimate user accounts that could mask malicious intent. Additionally, the environment's configuration and the presence of proper access controls can affect the detection's effectiveness.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
