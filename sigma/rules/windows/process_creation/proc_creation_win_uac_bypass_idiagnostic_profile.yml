title: UAC Bypass Using IDiagnostic Profile
id: 4cbef972-f347-4170-b62a-8253f6168e6d
status: test
description: Detects the "IDiagnosticProfileUAC" UAC bypass technique
references:
- https://github.com/Wh04m1001/IDiagnosticProfileUAC
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-07-03
modified: 2024-12-01
tags:
- attack.execution
- attack.defense-evasion
- attack.privilege-escalation
- attack.t1548.002
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    ParentImage|endswith: '\DllHost.exe'
    ParentCommandLine|contains: ' /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}'
    IntegrityLevel:
    - 'High'
    - 'System'
    - 'S-1-16-16384'         # System
    - 'S-1-16-12288'         # High
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The Sigma rule titled "UAC Bypass Using IDiagnostic Profile" is designed to detect a specific technique used by adversaries for bypassing User Account Control (UAC) on Windows systems. The rule focuses on monitoring process creation events where the parent image ends with 'DllHost.exe' and the associated command line contains the string ' /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}', indicating an attempt to utilize the IDiagnosticProfile UAC bypass technique. This scenario typically involves processes running at elevated privilege levels, such as 'High' or 'System', which can lead to unauthorized access if exploited. It leverages telemetry data from Windows process creation logs, particularly looking for events that capture parent-child relationships between processes, thus allowing analysts to discern potential misuse of system resources and violation of security policies.
  This detection is closely related to the MITRE ATT&CK framework, specifically under the category of execution and privilege escalation techniques (T1548.002). By targeting the use of specific parent processes along with high integrity levels, it serves as an important alerting mechanism to uncover potential elevations of privilege that could lead to broader network compromises.
  ### Investigation Steps
  - **Review Process Creation Logs:** Check the Windows Event Logs for any process creation events that match the detection criteria, focusing on 'DllHost.exe' and the specified command line parameters.
  - **Analyze Parent-Child Process Relationships:** Investigate the identified process tree to understand how processes interact, querying for any additional command lines or unusual parent processes that may indicate malicious behavior.
  - **Examine Integrity Levels:** Utilize EDR data to verify the integrity level of the flagged process. Investigate processes running with 'High' or 'System' integrity levels for any signs of misuse.
  - **Correlate with Other Data Sources:** Look into network connections, registry changes, and associated events from other security tools (like AV logs) to seek broader context for the alert and uncover any related suspicious activity.
  ### Prioritization
  Given the high-level alert status, alerts generated by this rule are of critical importance as they may indicate attempts at elevated privilege exploitation, potentially leading to significant security breaches within the enterprise environment.
  ### Blind Spots and Assumptions
  The rule operates under the assumption that it will capture specific UAC bypass attempts associated with the IDiagnosticProfile technique. It may fail to detect variants of this technique or other forms of privilege escalation that do not utilize 'DllHost.exe' or the specified command line parameters. Additionally, it is important to note that if a legitimate application uses the same pattern in its process creation, this may result in false positives, complicating the investigation process. Analysts should be prepared for such complexities and utilize supplementary intelligence to validate findings.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
