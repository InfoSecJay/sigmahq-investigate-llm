title: Wscript Shell Run In CommandLine
id: 2c28c248-7f50-417a-9186-a85b223010ee
status: test
description: Detects the presence of the keywords "Wscript", "Shell" and "Run" in
  the command, which could indicate a suspicious activity
references:
- https://web.archive.org/web/20220830122045/http://blog.talosintelligence.com/2022/08/modernloader-delivers-multiple-stealers.html
- https://blog.talosintelligence.com/modernloader-delivers-multiple-stealers-cryptominers-and-rats/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-08-31
modified: 2023-05-15
tags:
- attack.execution
- attack.t1059
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains|all:
    - 'Wscript.'
    - '.Shell'
    - '.Run'
  condition: selection
falsepositives:
- Inline scripting can be used by some rare third party applications or administrators.
  Investigate and apply additional filters accordingly
level: medium
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potentially suspicious activity associated with the use of Windows Script Host (WSH), specifically when the command line input includes the keywords "Wscript", "Shell", and "Run". These keywords indicate that a script is being executed which may be indicative of malicious behavior, particularly given their frequent use in various malware campaigns. The rule relies on **Process Creation** logs generated by Sysmon or the native Windows security event logs to capture and analyze command line arguments of processes spawned in the environment.
  The keywords specified in the rule may be associated with a variety of malicious activities, including the execution of obfuscated scripts, the delivery of payloads from malicious email attachments, or the invocation of remote commands through scripting. This alert maps to the MITRE ATT&CK framework under the **Execution** tactic, specifically the **T1059: Command and Scripting Interpreter** technique, which encompasses the execution of scripts to achieve an adversary's goals.
  ### Investigation Steps
  - **Examine Process Creation Logs**: Review the event logs related to process creation for instances where the Wscript execution has been logged. Pay particular attention to the parent-child process relationships to identify if the execution context is suspicious.
  - **Inspect Command Line Arguments**: For any alerts triggered, analyze the full command line arguments within the provenance logs. Look for additional parameters or encoded strings that may indicate malicious intent or obfuscation.
  - **Review Sysmon Logs**: Utilize Sysmon logs to track any potentially related network connections, particularly if the executed script attempts to reach out to known malicious domains or IP addresses.
  - **Query for Related Activity**: Use EDR and security tooling to search for any related artifacts such as other process executions, file creations, or registry modifications that coincide with the detected command line invocation.
  ### Prioritization
  The severity level for this alert is set to medium, indicating that while there is potential for significant malicious behavior, the rule may capture legitimate administrative tasks or scripting activities, necessitating further investigation. Responders should evaluate the context of the execution to ascertain whether it represents a legitimate use case or an adversarial action.
  ### Blind Spots and Assumptions
  This rule may miss certain forms of obfuscation or if scripts are executed in a non-standard manner (e.g., embedded or through alternate means unavailable in command line logs). Additionally, legitimate administrative scripts may inadvertently trigger the alert, especially if third-party tools are involved in using WSH. As such, analysts should remain aware that not every alert signifies malicious activity, particularly in environments heavily utilizing scripting for administrative tasks.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
