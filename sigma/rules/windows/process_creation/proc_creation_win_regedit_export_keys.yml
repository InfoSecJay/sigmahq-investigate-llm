title: Exports Registry Key To a File
id: f0e53e89-8d22-46ea-9db5-9d4796ee2f8a
related:
- id: 82880171-b475-4201-b811-e9c826cd5eaa
  type: similar
status: test
description: Detects the export of the target Registry key to a file.
references:
- https://lolbas-project.github.io/lolbas/Binaries/Regedit/
- https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f
author: Oddvar Moe, Sander Wiebing, oscd.community
date: 2020-10-07
modified: 2024-03-13
tags:
- attack.exfiltration
- attack.t1012
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - Image|endswith: '\regedit.exe'
  - OriginalFileName: 'REGEDIT.EXE'
  selection_cli:
    CommandLine|contains|windash: ' -E '
  filter_1:     # filters to avoid intersection with critical keys rule
    CommandLine|contains:
    - 'hklm'
    - 'hkey_local_machine'
  filter_2:
    CommandLine|endswith:
    - '\system'
    - '\sam'
    - '\security'
  condition: all of selection_* and not all of filter_*
fields:
- ParentImage
- CommandLine
falsepositives:
- Legitimate export of keys
level: low
notes: |
  ### Technical Context
  This detection rule monitors for instances where the Windows utility `regedit.exe` is utilized to export the Windows Registry keys to an external file. The rule specifically looks for process creation events involving `regedit.exe`, focusing on command-line parameters that specify the export option (`-E`) while ensuring that the key being exported does not belong to critical areas such as the Security accounts manager (SAM), SYSTEM, or Security keys, which are often targeted by adversaries. The technical data source involved in this detection includes process creation logs that capture how processes are initiated, along with their associated command-line parameters. The alert aligns with the MITRE ATT&CK tactic of "Exfiltration" (T1012), indicating a potential attempt to extract sensitive information from the registry.
  ### Investigation Steps
  - **Verify Process Creation**: Use EDR tools to track the creation of `regedit.exe` processes. Analyze the associated command-line arguments to confirm the specifics of the export action being attempted.
  - **Inspect Exported Files**: Search the file system for files generated by the export operation. Investigate their contents to determine if sensitive or critical information was potentially exposed.
  - **Review Related Logs**: Check Windows Event Logs (Security and Sysmon) for any context around the execution of the `regedit.exe` process. Look specifically for concessions of elevated privileges or unusual access patterns.
  - **Cross-check Network Activity**: Utilize proxy and network logs to see if there were any unusual outbound connections following the registry export. This might indicate the potential exfiltration of sensitive data.
  ### Prioritization
  The alert has been classified as low severity due to the legitimate use of registry exports for administrative purposes; however, the action may warrant further investigation if it deviates from typical usage patterns within the organization.
  ### Blind Spots and Assumptions
  This rule may not fire if the adversary uses an alternative method to access registry keys or utilizes different tools to perform similar actions, such as PowerShell scripts or other third-party applications. Additionally, legitimate administrative activities could also generate false positives if not carefully curated. It assumes that monitoring for `regedit.exe` usage is enabled and that relevant process creation logs are adequately captured.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
