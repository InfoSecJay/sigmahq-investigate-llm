title: Persistence Via TypedPaths - CommandLine
id: ec88289a-7e1a-4cc3-8d18-bd1f60e4b9ba
status: test
description: Detects modification addition to the 'TypedPaths' key in the user or
  admin registry via the commandline. Which might indicate persistence attempt
references:
- https://twitter.com/dez_/status/1560101453150257154
- https://forensafe.com/blogs/typedpaths.html
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-08-22
tags:
- attack.persistence
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains: '\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths'
  condition: selection
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  This Sigma rule focuses on detecting modifications to the 'TypedPaths' registry key in the Windows Registry, which is often an indication of unauthorized persistence mechanisms. Adversaries might leverage command-line interface utilities to modify this key to ensure that specific paths are automatically populated in Windows File Explorerâ€™s address bar, potentially allowing them to maintain persistent access to malicious resources. The rule looks for process creation logs that contain the string `\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths`, utilizing tools such as Sysmon and Windows Event Logs for process creation with specific command-line parameters. The relevant MITRE ATT&CK tactic for this detection is **Persistence**, specifically focusing on techniques related to registry modification.
  ### Investigation Steps
  - **Analyze Command-Line Activity:** Use your EDR to review the process creation events that triggered the alert. Look for the specific command-line arguments and functions utilized in the associated processes.
    
  - **Review Registry Changes:** Utilize Sysinternals tools (like Process Monitor) or Windows Event Logs to check for recent modifications to the 'TypedPaths' registry key. Identify any unauthorized changes and correlate them with user activity.
    
  - **Assess User Behavior:** Investigate the user or system account that made the registry change. Check for known usage patterns or anomalies that could indicate a compromise or unauthorized access.
  - **Cross-Check with AV and Proxy Logs:** Look for any related alerts in your AV or Proxy logs that may provide additional context about the command-line activity or any potentially harmful interactions with network resources.
  ### Prioritization
  Given that modifications to the 'TypedPaths' registry can signify an attempt to establish a persistent foothold within the environment, alerts generated by this rule should be treated with medium priority. Further investigation is warranted, but it may not immediately indicate a complete compromise.
  ### Blind Spots and Assumptions
  This rule may not fire if an adversary modifies the registry using methods that do not involve the command line, such as through Windows Management Instrumentation (WMI) or PowerShell scripts that directly change registry values without triggering process creation logs. Additionally, if the command-line activity is obfuscated or uses alternate techniques to manipulate the registry, it may bypass detection. It is assumed that users typically do not modify their TypedPaths frequently; however, legitimate administrative tasks or software installations may also trigger this rule, leading to potential false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environments and operational needs. Please communicate any changes to the detection engineering team.
