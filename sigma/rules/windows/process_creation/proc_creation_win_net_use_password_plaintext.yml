title: Password Provided In Command Line Of Net.EXE
id: d4498716-1d52-438f-8084-4a603157d131
status: test
description: Detects a when net.exe is called with a password in the command line
references:
- Internal Research
author: Tim Shelton (HAWK.IO)
date: 2021-12-09
modified: 2023-02-21
tags:
- attack.defense-evasion
- attack.initial-access
- attack.persistence
- attack.privilege-escalation
- attack.lateral-movement
- attack.t1021.002
- attack.t1078
logsource:
  category: process_creation
  product: windows
detection:
  selection_img:
  - Image|endswith:
    - '\net.exe'
    - '\net1.exe'
  - OriginalFileName:
    - 'net.exe'
    - 'net1.exe'
  selection_cli:
    CommandLine|contains|all:
    - ' use '
    - ':*\\'
    - '/USER:* *'
  filter_main_empty:
    CommandLine|endswith: ' '
  condition: all of selection_* and not 1 of filter_main_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The Sigma rule titled "Password Provided In Command Line Of Net.EXE" is designed to detect instances where the `net.exe` or `net1.exe` command-line utility is invoked with a password in the command line arguments. Specifically, this detection looks for command lines that contain qualifications to connect to network resources or execute operations that include a password parameter, which can be critical in identifying potential unauthorized access or lateral movement attempts. The detection employs Windows process creation events to monitor the command line inputs, particularly focusing on commands that include the `use` argument for mapping network drives, as well as criteria that involve user credentials.
  The relevant data sources for this detection include process creation logs captured by Sysmon, specifically focusing on the `CommandLine` field to ascertain the presence of sensitive information like passwords. In the context of the MITRE ATT&CK framework, this rule ties closely to tactics such as "Initial Access" (T1078 
  - Valid Accounts) and "Lateral Movement" (T1021.002 
  - SMB/Windows Admin Shares), where adversaries might leverage these techniques to gain higher privileges or move laterally within a network.
  ### Investigation Steps
  - **Review Process Creation Logs:** Check Sysmon and Windows Security logs for entries where `net.exe` or `net1.exe` was executed, filtering for those with command line parameters that include a password.
    
  - **Analyze Command Line Arguments:** Investigate the specifics of the command lines in the process creation logs to confirm if they contain patterns associated with usernames and passwords.
  - **Cross-reference with User Activity:** Use EDR tools to correlate the timestamps and originating user accounts with legitimate user activity to determine if the command execution is suspicious or out of the ordinary.
  - **Inspect Network Connections:** Evaluate network logs from the NDR or Firewall that correspond to the execution times of the command to see if there were any unusual outbound connections or attempts to access network resources.
  ### Prioritization
  Alerts generated by this rule are deemed medium severity due to the potential for misuse of legitimate tools (like `net.exe`) by attackers to gain unauthorized access or escalate privileges. Such activities, particularly in enterprise environments, can compromise sensitive systems if not investigated promptly.
  ### Blind Spots and Assumptions
  This rule may fail to fire in scenarios where the command line is obfuscated, such as being executed through scripts or scheduled tasks, or if the password parameters are passed without explicit keywords that the rule looks for. Additionally, legitimate administrative tasks executed by authorized personnel could trigger false positives. Engineers should consider that attackers might employ alternate methods or tools that do not involve `net.exe` for lateral movement or privilege escalation, thereby evading detection.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
