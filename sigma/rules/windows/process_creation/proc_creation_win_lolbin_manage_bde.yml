title: Potential Manage-bde.wsf Abuse To Proxy Execution
id: c363385c-f75d-4753-a108-c1a8e28bdbda
status: test
description: Detects potential abuse of the "manage-bde.wsf" script as a LOLBIN to
  proxy execution
references:
- https://lolbas-project.github.io/lolbas/Scripts/Manage-bde/
- https://gist.github.com/bohops/735edb7494fe1bd1010d67823842b712
- https://twitter.com/bohops/status/980659399495741441
- https://twitter.com/JohnLaTwC/status/1223292479270600706
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1216/T1216.md
author: oscd.community, Natalia Shornikova, Nasreddine Bencherchali (Nextron Systems)
date: 2020-10-13
modified: 2023-02-03
tags:
- attack.defense-evasion
- attack.t1216
logsource:
  category: process_creation
  product: windows
detection:
  selection_wscript_img:
  - Image|endswith: '\wscript.exe'
  - OriginalFileName: 'wscript.exe'
  selection_wscript_cli:
    CommandLine|contains: 'manage-bde.wsf'
  selection_parent:
    ParentImage|endswith:
    - '\cscript.exe'
    - '\wscript.exe'
    ParentCommandLine|contains: 'manage-bde.wsf'
  selection_filter_cmd:
    Image|endswith: '\cmd.exe'
  condition: all of selection_wscript_* or (selection_parent and not selection_filter_cmd)
falsepositives:
- Unlikely
level: high
notes: |
  ### Technical Context
  The detection rule titled "Potential Manage-bde.wsf Abuse To Proxy Execution" is designed to identify suspicious activity related to the misuse of the Windows script "manage-bde.wsf." This script is often leveraged by malicious actors to invoke the Windows Script Host (WSH) and execute other scripts or commands with elevated privileges, thereby circumventing standard security measures. The rule monitors process creation events, specifically targeting instances where `wscript.exe` is being executed with command-line parameters that include `manage-bde.wsf`. Additionally, the rule inspects the parent processes of `wscript.exe` to ensure they are initiated from legitimate script execution contexts, while also filtering out benign command-line executions involving `cmd.exe`. This detection aligns with the MITRE ATT&CK tactic of Defense Evasion (T1216) as it seeks to uncover techniques used to conceal nefarious activities within permitted administrative functions.
  ### Investigation Steps
  - **Verify Process Context**: Utilize your EDR solution to examine the details of the detected `wscript.exe` processes, including the user context, timestamps, and related parent processes.
  - **Analyze Command-Line Arguments**: Check the command-line parameters associated with the process to understand the intent behind the execution of `manage-bde.wsf`. Pay close attention to the arguments that may indicate unauthorized actions.
  - **Review Parent Process Activity**: Investigate the history of the parent processes identified (such as `cscript.exe` or `wscript.exe`) to determine if they were launched from a legitimate source or through suspicious means.
  - **Cross-Reference with Security Logs**: Check Windows Security and System logs to look for any unusual user activities or configurations that coincide with the timeframe of the alerts, such as administrative account access or policy changes.
  ### Prioritization
  Alerts generated by this rule warrant a high severity classification because the exploitation of `manage-bde.wsf` can lead to significant risk in the environment, enabling unauthorized access or command execution that may compromise sensitive systems or data.
  ### Blind Spots and Assumptions
  This rule may not fire in scenarios where the `manage-bde.wsf` script is executed through non-standard execution methods, such as direct invocation of `wscript.exe` by an internal application without involving typical command-line parameters. Furthermore, legitimate administrative operations involving `manage-bde.wsf` may be falsely flagged as malicious without sufficient contextual analysis. Responders should ensure they consider the behavior of the user account executing the script and be aware that sophisticated adversaries may utilize obfuscation techniques to evade detection by this rule.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
