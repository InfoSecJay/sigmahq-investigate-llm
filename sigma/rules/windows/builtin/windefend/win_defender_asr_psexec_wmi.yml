title: PSExec and WMI Process Creations Block
id: 97b9ce1e-c5ab-11ea-87d0-0242ac130003
status: test
description: Detects blocking of process creations originating from PSExec and WMI
  commands
references:
- https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-process-creations-originating-from-psexec-and-wmi-commands
- https://twitter.com/duff22b/status/1280166329660497920
author: Bhabesh Raj
date: 2020-07-14
modified: 2022-12-25
tags:
- attack.execution
- attack.lateral-movement
- attack.t1047
- attack.t1569.002
logsource:
  product: windows
  service: windefend
  definition: 'Requirements:Enabled Block process creations originating from PSExec
    and WMI commands from Attack Surface Reduction (GUID: d1e49aac-8f56-4280-b9ba-993a6d77406c)'
detection:
  selection:
    EventID: 1121
    ProcessName|endswith:
    - '\wmiprvse.exe'
    - '\psexesvc.exe'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This detection rule is designed to identify and block process creations that originate from PSExec and Windows Management Instrumentation (WMI) commands. By monitoring for specific event IDs generated by the Windows Defender, this rule captures activities related to the execution of processes that are commonly abused by attackers for lateral movement within a network. The log source for this rule relies on Windows Defender's ability to log events related to attempted process creations through PSExec and WMI communications, specifically looking for Event ID 1121, which indicates a blocked process initiation. These techniques correspond to MITRE ATT&CK tactics including execution (T1047 for WMI and T1569.002 for PSExec) and lateral movement.
  ### Investigation Steps
  - **Check Event Logs:** Review Windows Security event logs for Event ID 1121 to confirm the occurrence and details of blocked processes. Pay special attention to timestamps and the source of the command initiating the process.
  - **Review EDR Dashboard:** Utilize your Endpoint Detection and Response (EDR) tools to track down any associated activity linked with PSExec or WMI executions on affected devices. Look for unusual patterns or repeated attempts that indicate malicious behavior.
  - **Network Activity Analysis:** Inspect network logs for any suspicious outbound connections or abnormal communication patterns that coincide with the times of the blocked process creations. This can provide insight into potential external command-and-control (C2) activity.
  - **Assess User Activity:** Analyze user account activity to identify any accounts that triggered the blocked process creation events. Determine if the account is legitimate or may have been compromised and used for lateral movement.
  ### Prioritization
  The alert is categorized as high severity due to the potential risk of lateral movement and exploitation that can arise from the abuse of PSExec and WMI methods. Immediate investigation is necessary to prevent further unauthorized access within the enterprise environment.
  ### Blind Spots and Assumptions
  This rule may not trigger if Windows Defender is improperly configured or if the specific blocking feature for PSExec and WMI commands is disabled. There is also an assumption that attackers will not switch tactics or utilize other tools to bypass detection; hence, they might exploit alternative methods for lateral movement. Additionally, legitimate administrative uses of PSExec and WMI may lead to false positives, complicating the investigation further.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
