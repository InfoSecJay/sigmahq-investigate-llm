title: Windows Defender Malware Detection History Deletion
id: 2afe6582-e149-11ea-87d0-0242ac130003
status: test
description: Windows Defender logs when the history of detected infections is deleted.
references:
- https://learn.microsoft.com/en-us/defender-endpoint/troubleshoot-microsoft-defender-antivirus
- https://web.archive.org/web/20160727113019/https://answers.microsoft.com/en-us/protect/forum/mse-protect_scanning/microsoft-antimalware-has-removed-history-of/f15af6c9-01a9-4065-8c6c-3f2bdc7de45e
author: Cian Heasley
date: 2020-08-13
modified: 2023-11-24
tags:
- attack.defense-evasion
logsource:
  product: windows
  service: windefend
detection:
  selection:
    EventID: 1013     # The antimalware platform deleted history of malware and other potentially unwanted software.
  condition: selection
falsepositives:
- Deletion of Defender malware detections history for legitimate reasons
level: informational
notes: |
  ### Technical Context
  The Sigma rule titled "Windows Defender Malware Detection History Deletion" focuses on detecting instances where the history of detected infections in Windows Defender is purged. This activity can be indicative of attempts to conceal evidence of malicious activity, as attackers may delete logs to evade detection. The rule works by monitoring for specific event ID 1013 generated by the Windows Defender service. When this event is triggered, it reveals that the antimalware platform has deleted its historical records of malware and potentially unwanted software. The key data source for this rule is the Windows Security event log, specifically timestamps and details associated with the deletion events.
  This rule aligns with the MITRE ATT&CK framework under the tactic "Defense Evasion" and specifically addresses the technique of clearing logs, highlighting the importance of maintaining comprehensive and accessible records for incident investigations.
  ### Investigation Steps
  - **Check EDR for Recent Activity:** Review endpoint detection and response (EDR) logs for any suspicious process activity or behaviors around the time of the detected event, focusing on the processes that may have initiated the deletion.
  - **Examine Windows Security Logs:** Investigate the Windows Security event logs surrounding Event ID 1013 for patterns that reveal other activities performed by the same user or process before the history deletion.
  - **Review User Account Activity:** Validate the identity of the user or service account responsible for the deletion by checking its login history and any related actions taken within a suspicious timeframe.
  - **Correlate with Network Traffic:** Use Network Detection and Response (NDR) tools to analyze any outbound or lateral movement traffic around the time of the log deletion to identify possible exfiltration or communication with known malicious hosts.
  ### Prioritization
  The alert is assigned an informational severity level, indicating that while the deletion of malware detection history is concerning and may warrant further investigation, it could also occur for legitimate purposes such as system maintenance or updates.
  ### Blind Spots and Assumptions
  This rule may not fire in scenarios where the deletion of Windows Defender logs is performed by legitimate processes or during routine maintenance; thus, it is essential to contextualize such events. The assumption is that the logging mechanism of Windows Defender is functioning correctly, and any configuration changes do not suppress the logging of Event ID 1013. Adversaries could also employ techniques to manipulate or disable logging features, which could prevent this rule from capturing relevant events.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
