title: Windows Defender Malware And PUA Scanning Disabled
id: bc275be9-0bec-4d77-8c8f-281a2df6710f
related:
- id: fe34868f-6e0e-4882-81f6-c43aa8f15b62
  type: obsolete
status: stable
description: Detects disabling of the Windows Defender feature of scanning for malware
  and other potentially unwanted software
references:
- https://learn.microsoft.com/en-us/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide#event-id-5010
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md
- https://craigclouditpro.wordpress.com/2020/03/04/hunting-malicious-windows-defender-activity/
author: Ján Trenčanský, frack113
date: 2020-07-28
modified: 2023-11-22
tags:
- attack.defense-evasion
- attack.t1562.001
logsource:
  product: windows
  service: windefend
detection:
  selection:
    EventID: 5010     # Scanning for malware and other potentially unwanted software is disabled.
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  This detection rule identifies when Windows Defender's malware and potentially unwanted application (PUA) scanning features are disabled on a Windows system. By monitoring Event ID 5010 from the Windows Defender service, the rule flags occurrences where scanning capabilities have been turned off, which may indicate an attempt to evade detection by adversaries. Such disabling actions can serve as a preliminary indicator of malicious behavior, particularly for those looking to install or run unwanted software without security countermeasures in place. This relates to the MITRE ATT&CK technique T1562.001 (Disable or Modify Security Tools), where attackers manipulate or disable existing security tools to facilitate unauthorized activities.
  ### Investigation Steps
  - **Check Event Logs:** Review Windows Security Event Logs for Event ID 5010 to confirm the disabling of security features and the corresponding user account that executed the action.
    
  - **Assess Timeline:** Analyze the temporal correlation between the occurrence of Event ID 5010 and other security events or alerts using the SIEM to determine any unusual patterns or preceding activities.
    
  - **Validate Defender Status:** Utilize Windows Defender's interface or PowerShell commands to verify the current status of antivirus and PUA scanning features to evaluate any attempts at remediation.
    
  - **Investigate User Activity:** Examine the activity of the user who disabled the scanning features using EDR tools, focusing on their history of logon times, executed commands, and process creations that may indicate malicious intent.
  ### Prioritization
  This alert is assessed as high priority due to the potential risk that disabling Windows Defender poses to the enterprise environment, as it allows for unmonitored system activity that can lead to severe security breaches.
  ### Blind Spots and Assumptions
  This detection rule may not fire if attackers use methods to disable logging or if the Event ID 5010 is suppressed due to system misconfiguration. Additionally, there may be legitimate reasons for disabling these features, such as troubleshooting or changes in system configurations by authorized personnel. Analysts should be aware that some sophisticated threats could use alternative means to disable security features without generating the relevant events.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
