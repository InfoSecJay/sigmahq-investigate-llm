title: Windows Defender Grace Period Expired
id: 360a1340-398a-46b6-8d06-99b905dc69d2
related:
- id: fe34868f-6e0e-4882-81f6-c43aa8f15b62
  type: obsolete
status: stable
description: |
  Detects the expiration of the grace period of Windows Defender. This means protection against viruses, spyware, and other potentially unwanted software is disabled.
references:
- https://learn.microsoft.com/en-us/defender-endpoint/troubleshoot-microsoft-defender-antivirus?view=o365-worldwide#event-id-5101
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md
- https://craigclouditpro.wordpress.com/2020/03/04/hunting-malicious-windows-defender-activity/
author: Ján Trenčanský, frack113
date: 2020-07-28
modified: 2023-11-22
tags:
- attack.defense-evasion
- attack.t1562.001
logsource:
  product: windows
  service: windefend
detection:
  selection:
    EventID: 5101     # The antimalware platform is expired.
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  ### Technical Context
  The "Windows Defender Grace Period Expired" detection rule is designed to identify the expiration of the grace period for Windows Defender Antivirus on a Windows operating system. When the grace period expires, Windows Defender will cease to provide protection against viruses, spyware, and other potentially harmful software. This rule specifically monitors Event ID 5101, which indicates that the antimalware platform has expired. Detection is achieved via Windows Security logs that are generated when the Windows Defender service alters its protection status. The rule aligns with the MITRE ATT&CK tactic of "Defense Evasion" and the technique T1562.001, which highlights how adversaries might manipulate security controls to bypass detection mechanisms.
  ### Investigation Steps
  - **Review Security Event Logs**: Utilize Windows Security logs to locate Event ID 5101. Analyze timestamps and correlating logs to determine the context of the event and any associated activity leading to the expiration.
    
  - **Check System Status**: Investigate the status of Windows Defender using the EDR solution to confirm whether real-time protection is enabled or disabled. This can provide insights into whether the expiration may have been exploited or if it occurred naturally due to misconfiguration.
  - **Analyze Recent Changes**: Look for any recent updates or configuration changes that may have affected Windows Defender's status. This can include checking for updates in group policy settings or recent deployments of third-party software.
  - **Traffic Monitoring**: Examine network logs for unusual traffic that could indicate exploitation attempts or malware communication once the Defender protection is disabled. Use Network Detection and Response (NDR) solutions to correlate any anomalies with this alert.
  ### Prioritization
  The alert is deemed high severity due to the critical nature of antivirus protection in enterprise environments. An expired Windows Defender grace period may leave systems vulnerable to exploitation, increasing the risk of malware infections.
  ### Blind Spots and Assumptions
  One potential blind spot of this detection rule is that it may not fire if the Windows Defender service is disabled or uninstalled before the grace period expires. Additionally, if an adversary takes precautions to re-enable or silence Windows Defender after an attack, the associated event may not be recorded. Furthermore, this rule relies on proper logging configurations; if logs are not retained or are insufficiently detailed due to policy limitations, the rule may fail to trigger.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and clarity, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
