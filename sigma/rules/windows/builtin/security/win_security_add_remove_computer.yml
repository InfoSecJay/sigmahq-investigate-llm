title: Add or Remove Computer from DC
id: 20d96d95-5a20-4cf1-a483-f3bda8a7c037
status: test
description: Detects the creation or removal of a computer. Can be used to detect
  attacks such as DCShadow via the creation of a new SPN.
references:
- https://github.com/Yamato-Security/EnableWindowsLogSettings/blob/7f6d755d45ac7cc9fc35b0cbf498e6aa4ef19def/ConfiguringSecurityLogAuditPolicies.md
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4741
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4743
author: frack113
date: 2022-10-14
tags:
- attack.defense-evasion
- attack.t1207
logsource:
  service: security
  product: windows
detection:
  selection:
    EventID:
    - 4741
    - 4743
  condition: selection
falsepositives:
- Unknown
level: low
notes: |
  ### Technical Context
  This detection rule is designed to monitor for the addition or removal of computers from a Windows Domain Controller (DC), specifically via events logged as Event ID 4741 (computer account creation) and Event ID 4743 (computer account deletion). These events are crucial for identifying potential attacks such as DCShadow, where adversaries might create or modify computer accounts to facilitate unauthorized access or maintain persistence within a network environment. The rule relies on Windows Security logs, which capture these critical changes in the Active Directory infrastructure. By analyzing these events, incident responders can uncover actions that may not align with standard administrative practices, leading to early detection of malicious activities targeting the integrity of the DC.
  The identified MITRE ATT&CK techniques relevant to this rule include the defense evasion tactic (T1207), focusing on how attackers may seek to manipulate or impersonate legitimate domain entities by adding or removing computer accounts.
  ### Investigation Steps
  - **Review Security Logs:** Utilize the Security logs to investigate the specific Event IDs (4741, 4743) captured around the time of the alert. Pay particular attention to the user account that performed these actions, as well as any anomalies in the timestamps.
  - **Check Account Permissions:** Verify the permissions of the user or service account responsible for the computer account change. Determine if the account has legitimate rights to perform such operations according to your organizational policy.
  - **Analyze Related Network Activity:** Utilize EDR or NDR tools to monitor for any unusual outbound network connections or unauthorized access attempts made by the associated computer account. This can help indicate whether there are further signs of compromise.
  - **Cross-Reference AD Changes:** Cross-reference changes with Active Directory change logs and audit policies to identify any suspicious patterns or actions that deviate from typical administrative behavior within your network.
  ### Prioritization
  Given the potential implications of unauthorized changes to computer accounts on a Domain Controller, the severity of alerts generated by this rule is considered low but crucial. However, any indication of such changes should prompt a swift investigation due to the sensitive nature of Active Directory and the risk of exploitation.
  ### Blind Spots and Assumptions
  This detection rule may not fire in environments where logging for the specified Event IDs (4741, 4743) is not properly configured or enabled in the Windows Security settings. Additionally, if legitimate users with domain administrative rights execute these actions, they could mask suspicious behavior. Adversaries may attempt to obscure their activities by creating false accounts or changing system times, which may not be captured by this rule. It is essential for security teams to regularly review and update their auditing policies to ensure comprehensive coverage of relevant events.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
