title: Tap Driver Installation - Security
id: 9c8afa4d-0022-48f0-9456-3712466f9701
related:
- id: 8e4cf0e5-aa5d-4dc3-beff-dc26917744a9
  type: derived
status: test
description: |
  Detects the installation of a well-known TAP driver service. This could be a sign of potential preparation for data exfiltration using tunnelling techniques.
references:
- https://community.openvpn.net/openvpn/wiki/ManagingWindowsTAPDrivers
author: Daniil Yugoslavskiy, Ian Davis, oscd.community
date: 2019-10-24
modified: 2022-11-29
tags:
- attack.exfiltration
- attack.t1048
logsource:
  product: windows
  service: security
  definition: 'Requirements: The System Security Extension audit subcategory need
    to be enabled to log the EID 4697'
detection:
  selection:
    EventID: 4697
    ServiceFileName|contains: 'tap0901'
  condition: selection
falsepositives:
- Legitimate OpenVPN TAP installation
level: low
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect the installation of a specific TAP driver service (tap0901) commonly associated with OpenVPN. When a TAP driver is installed on a Windows system, it creates a tunneling interface that can potentially be exploited for data exfiltration. The rule relies on Event ID 4697 from Windows Security logs, which captures events related to the installation of services. By monitoring for this specific event and filtering for the service file name containing 'tap0901', the rule aims to identify potentially suspicious installations that may indicate preparation for unauthorized data transmission. The detection aligns with the MITRE ATT&CK tactic of exfiltration (T1048), highlighting its relevance in the broader context of threat detection.
  ### Investigation Steps
  - **Check Security Logs:** Review Windows Security Event Logs, specifically Event ID 4697, to confirm the details of the TAP driver installation, including the user account and any associated processes.
  - **Review Process Creation:** Utilize an EDR tool to analyze process creation logs around the time of the TAP driver installation to identify any anomalous or unauthorized processes that might indicate malicious activity.
  - **Network Traffic Analysis:** Investigate network connections established by the newly installed TAP driver using network detection and response (NDR) tools to detect any unusual or unauthorized data flows that may suggest exfiltration attempts.
  - **Assess OpenVPN Usage:** Review user activity and audit logs for legitimate use of OpenVPN within the organization to differentiate between authorized installations and potential malicious intent.
  ### Prioritization
  The alert generated by this rule is categorized as low severity, primarily due to the possibility of legitimate TAP driver installations for VPN purposes, which may not always indicate malicious behavior. However, it warrants investigation to differentiate between benign and malicious activity.
  ### Blind spots and Assumptions
  This rule may not fire if Event ID 4697 is not enabled in the security audit policy, leading to missed detections for legitimate installations. Additionally, sophisticated adversaries may utilize methods to obfuscate driver installations or employ custom drivers not matching the specified string, resulting in a failure to detect their activities. Analysts should remain aware of environment-specific configurations and the potential for false negatives due to these factors.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
