title: Password Protected ZIP File Opened
id: 00ba9da1-b510-4f6b-b258-8d338836180f
status: test
description: Detects the extraction of password protected ZIP archives. See the filename
  variable for more details on which file has been opened.
references:
- https://twitter.com/sbousseaden/status/1523383197513379841
author: Florian Roth (Nextron Systems)
date: 2022-05-09
tags:
- attack.defense-evasion
- attack.t1027
logsource:
  product: windows
  service: security
detection:
  selection:
    EventID: 5379
    TargetName|contains: 'Microsoft_Windows_Shell_ZipFolder:filename'
  filter:    # avoid overlaps with 54f0434b-726f-48a1-b2aa-067df14516e4
    TargetName|contains: '\Temporary Internet Files\Content.Outlook'
  condition: selection and not filter
falsepositives:
- Legitimate used of encrypted ZIP files
level: medium
notes: |
  n
  ### Technical Context
  The Sigma rule titled "Password Protected ZIP File Opened" monitors for specific activities related to the extraction of password-protected ZIP archives on Windows systems. This detection focuses primarily on Windows Security Event ID 5379, which indicates a user's interaction with a secure ZIP file. The rule filters for instances where the file is not located in the Temporary Internet Files generated by Outlook, as these are often legitimate uses of encrypted ZIP files. By looking for file extractions tied to encrypted ZIP archives, this rule seeks to identify potential evasion techniques employed by adversaries in response to security measures, particularly with respect to file transfer or exploitation processes. The rule aligns with the MITRE ATT&CK framework under the defense evasion tactic (T1027), which encompasses various methods that adversaries may use to avoid detection.
  ### Investigation Steps
  - **Review Event Details:** Examine the Event ID 5379 logs in the Windows Security event log to identify the user account, timestamp, and specific ZIP file accessed.
  - **Cross-Check User Activity:** Verify the context of user activity around the time of the alert using EDR telemetry to establish if there was any suspicious behavior or previous alerts related to the same account.
  - **Correlate with Other Logs:** Look for any corresponding network connections, file creations, or PowerShell executions that occurred shortly after the zip file extraction to identify potential malicious activity.
  - **Engage Threat Intelligence:** Utilize threat intelligence resources to ascertain if the specific ZIP file pattern or sender is linked to known threats or malicious campaigns.
  ### Prioritization
  The alert severity is set to medium due to the potential risk associated with password-protected ZIP files being used for data exfiltration or as a delivery method for malicious payloads. However, legitimate business activities may also trigger this detection.
  ### Blind Spots and Assumptions
  This rule assumes that the event logs are configured correctly and that the alert can occur only in environments using Microsoft's methods for handling ZIP files. It may not fire if adversaries employ alternative means of file extraction or use non-standard archiving tools. Additionally, legitimate uses of encrypted ZIP files can lead to false positives, which may cause disruptions if not monitored effectively.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
