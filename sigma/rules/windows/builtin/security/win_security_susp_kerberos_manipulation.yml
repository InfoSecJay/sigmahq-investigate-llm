title: Kerberos Manipulation
id: f7644214-0eb0-4ace-9455-331ec4c09253
status: test
description: Detects failed Kerberos TGT issue operation. This can be a sign of manipulations
  of TGT messages by an attacker.
references:
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4771
author: Florian Roth (Nextron Systems)
date: 2017-02-10
modified: 2024-01-16
tags:
- attack.credential-access
- attack.t1212
logsource:
  product: windows
  service: security
detection:
  selection:
    EventID:
    - 675
    - 4768
    - 4769
    - 4771
    Status:
    - '0x9'
    - '0xA'
    - '0xB'
    - '0xF'
    - '0x10'
    - '0x11'
    - '0x13'
    - '0x14'
    - '0x1A'
    - '0x1F'
    - '0x21'
    - '0x22'
    - '0x23'
    - '0x24'
    - '0x26'
    - '0x27'
    - '0x28'
    - '0x29'
    - '0x2C'
    - '0x2D'
    - '0x2E'
    - '0x2F'
    - '0x31'
    - '0x32'
    - '0x3E'
    - '0x3F'
    - '0x40'
    - '0x41'
    - '0x43'
    - '0x44'
  condition: selection
falsepositives:
- Faulty legacy applications
level: high
notes: |
  ### Technical Context
  The "Kerberos Manipulation" detection rule identifies potentially malicious activities related to the manipulation of Kerberos Ticket-Granting Tickets (TGTs) within Windows environments. Specifically, the rule focuses on failed Kerberos authentication events by monitoring specific Security Event IDsâ€”675, 4768, 4769, and 4771. When the system detects these events, it also assesses the accompanying status codes for known error conditions that may indicate malicious attempts to manipulate or forge TGT messages. This behavior correlates with the MITRE ATT&CK tactic of Credential Access (T1212), where an attacker may exploit these authentication mechanisms to gain unauthorized access to resources.
  The telemetry for this rule primarily originates from Windows Security event logs, which catch events associated with authentication requests, including both successful and failed attempts. As attackers may use various tools and techniques to manipulate authentication processes, the significance of the detected status codes (ranging from 0x9 to 0x44) indicates a broad spectrum of potential malicious activities. Therefore, the alerts generated by this rule are essential for identifying and responding to unauthorized access attempts in a timely manner.
  ### Investigation Steps
  - **Review Security Event Logs:** Investigate Security Event IDs 675, 4768, 4769, and 4771 in the Windows Event Logs to correlate failed authentication attempts with specific user accounts and timestamps.
  - **Cross-Reference TGT Issues:** Analyze the detailed information in the events to identify any patterns, such as specific accounts that experience multiple failures, which may indicate targeted attacks or compromised credentials.
  - **Check for Legacy Application Interference:** Examine recent changes to legacy applications that could lead to false positives, particularly if they reportedly experience authentication issues that could trigger the rule.
  - **Investigate User Account Behavior:** Utilize EDR tools to monitor the activity of user accounts flagged in the alerts, assessing for any anomalous behavior or actions consistent with credential manipulation or unauthorized access attempts.
  ### Prioritization
  The alerts generated by this rule are considered high severity in an enterprise environment because they may indicate active manipulation of credentialing processes, which can lead to unauthorized access and potential data breaches.
  ### Blind Spots and Assumptions
  This rule may not fire if there are disruptions or misconfigurations in the Windows Security event logging settings, leading to missed authentication attempts. Additionally, elevated privileges of certain applications or services might mask manipulations if such processes are not thoroughly monitored. It is also feasible that sophisticated adversaries could utilize stealth techniques to manipulate tickets without generating the logged events this rule looks for.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
