title: Win Susp Computer Name Containing Samtheadmin
id: 39698b3f-da92-4bc6-bfb5-645a98386e45
status: test
description: Detects suspicious computer name samtheadmin-{1..100}$ generated by hacktool
references:
- https://twitter.com/malmoeb/status/1511760068743766026
- https://github.com/WazeHell/sam-theadmin/blob/main/sam_the_admin.py
- https://github.com/helloexp/0day/blob/614227a7b9beb0e91e7e2c6a5e532e6f7a8e883c/00-CVE_EXP/CVE-2021-42287/sam-the-admin/sam_the_admin.py
author: elhoim
date: 2022-09-09
modified: 2023-01-04
tags:
- cve.2021-42278
- cve.2021-42287
- attack.persistence
- attack.privilege-escalation
- attack.t1078
logsource:
  service: security
  product: windows
detection:
    # Not adding an EventID on purpose to try to match on any event in security (including use of account), not just 4741 (computer account created)
  selection1:
    SamAccountName|startswith: 'SAMTHEADMIN-'
    SamAccountName|endswith: '$'
  selection2:
    TargetUserName|startswith: 'SAMTHEADMIN-'
    TargetUserName|endswith: '$'
  condition: 1 of selection*
fields:
- EventID
- SamAccountName
- SubjectUserName
- TargetUserName
falsepositives:
- Unknown
level: critical
notes: |
  ### Technical Context
  This detection rule is designed to identify the creation of suspicious computer accounts with names starting with "SAMTHEADMIN-" and ending with a dollar sign ($). These types of accounts are often associated with the exploitation of vulnerabilities (CVE-2021-42278 and CVE-2021-42287) and can be indicative of an adversaryâ€™s attempt to establish persistence through illicit account creation. The rule leverages Windows Security logs, monitoring for changes related to account management. Specifically, it inspects the `SamAccountName` and `TargetUserName` fields, helping to reveal potentially malicious automated behaviors. This behavior aligns with the MITRE ATT&CK tactics of Persistence (T1078) and Privilege Escalation, raising the likelihood of detecting an ongoing attack.
  ### Investigation Steps
  - **Check Account Creation:** Review Windows Security event logs for EventIDs associated with account creation to identify the specific events triggering this rule.
  - **Assess User Activity:** Investigate any activities linked to the detected "SAMTHEADMIN-" accounts using EDR to trace their login events and actions taken on the system.
  - **Examine System Changes:** Utilize Sysmon logs to identify any associated suspicious processes, command-line arguments, or unusual behaviors corresponding to these accounts.
  - **Correlate with Known Indicators:** Cross-reference incident data with external threat intelligence sources, including the references provided, to assess potential links to known attack patterns and techniques.
  ### Prioritization
  The alert is categorized as critical due to the potential for serious security breaches stemming from unauthorized account creations, which may lead to privilege escalation or prolonged access into enterprise environments.
  ### Blind Spots and Assumptions
  This detection rule may not fire in environments where logging is incomplete or improperly configured, leading to gaps in visibility over account creation events. Additionally, legitimate administrative actions might trigger false positives if they resemble the pattern defined in the rule. It is important to note that attackers may use obfuscation techniques or variations in naming conventions to bypass this detection mechanism.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
