title: Hacktool Ruler
id: 24549159-ac1b-479c-8175-d42aea947cae
status: test
description: This events that are generated when using the hacktool Ruler by Sensepost
references:
- https://github.com/sensepost/ruler
- https://github.com/sensepost/ruler/issues/47
- https://github.com/staaldraad/go-ntlm/blob/cd032d41aa8ce5751c07cb7945400c0f5c81e2eb/ntlm/ntlmv1.go#L427
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4776
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4624
author: Florian Roth (Nextron Systems)
date: 2017-05-31
modified: 2022-10-09
tags:
- attack.discovery
- attack.execution
- attack.t1087
- attack.t1114
- attack.t1059
- attack.t1550.002
logsource:
  product: windows
  service: security
detection:
  selection1:
    EventID: 4776
    Workstation: 'RULER'
  selection2:
    EventID:
    - 4624
    - 4625
    WorkstationName: 'RULER'
  condition: (1 of selection*)
falsepositives:
- Go utilities that use staaldraad awesome NTLM library
level: high
notes: |
  ### Technical Context
  The "Hacktool Ruler" detection rule is designed to identify potential misuse of the "Ruler" hacking tool developed by Sensepost. This tool is known for its capabilities to automate NTLM password cracking and can be indicative of malicious intent or reconnaissance activity when detected in a network environment. The rule primarily looks for specific Windows Security Event IDs, particularly Event ID 4776 which logs NTLM authentication attempts, and Event IDs 4624 and 4625 that signify successful and failed logon attempts respectively. These events are cross-referenced with the workstation name "RULER" to determine whether the tool is being executed in the environment. The rule aligns with several MITRE ATT&CK tactics including Discovery (T1087), Execution (T1059), Credential Dumping (T1550.002), and others that focus on gathering and exploiting credentials.
  ### Investigation Steps
  - **Review Security Event Logs**: Examine the Windows Security Event Logs for Event ID 4776, 4624, and 4625, focusing on the entries where the workstation name is "RULER" to identify authentication attempts made by the tool.
  - **Analyze Process Execution**: Utilize EDR tools to trace the execution of the "Ruler" tool by checking for process creation logs and any associated command-line parameters that may indicate its full functionality and usage context.
  - **Check Network Connections**: If available, inspect network traffic logs for unusual connections initiated from the "RULER" workstation, especially those that may be targeting sensitive systems or services associated with credential harvesting.
  - **Assess User Accounts**: Investigate actions related to user accounts that may have been compromised or could be related to the Ruler tool, focusing on suspicious or atypical login patterns and usage within privileged accounts.
  ### Prioritization
  The alert generated by this rule warrants a high-severity classification as its detection points to possible malicious activity involving credential manipulation, which can lead to unauthorized access and potential lateral movement within the network.
  ### Blind Spots and Assumptions
  This detection rule may not trigger in environments where the "Ruler" tool is operated under a different workstation name or in scenarios where logs have been cleared or modified after the fact. Additionally, legitimate applications that utilize the NTLM library may generate similar event IDs, leading to potential false positives. Adversaries might circumvent detection by operating the tool from non-standard machines or by using stealthy methods to avoid generating these specific event logs.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
