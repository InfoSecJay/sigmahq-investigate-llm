title: Successful Account Login Via WMI
id: 5af54681-df95-4c26-854f-2565e13cfab0
status: stable
description: Detects successful logon attempts performed with WMI
references:
- Internal Research
author: Thomas Patzke
date: 2019-12-04
modified: 2024-01-17
tags:
- attack.execution
- attack.t1047
logsource:
  product: windows
  service: security
detection:
  selection:
    EventID: 4624
    ProcessName|endswith: '\WmiPrvSE.exe'
  condition: selection
falsepositives:
- Monitoring tools
- Legitimate system administration
level: low
notes: |
  ### Technical Context
  This detection rule identifies successful account logon attempts that are executed via Windows Management Instrumentation (WMI), specifically monitoring events generated by the `WmiPrvSE.exe` process. When an account successfully logs in using WMI, it triggers a Security Event log with Event ID 4624. This log entry contains essential information, including the account that was used for the logon attempt, the logon type, and the originating IP address, among other details. The significance of this rule lies in its ability to detect potentially unauthorized or unusual logon activities, especially as WMI can be leveraged by adversaries to execute commands and maintain persistence on compromised systems. The related MITRE ATT&CK technique for this detection is T1047 (Windows Management Instrumentation).
  ### Investigation Steps
  - **Review Security Event Logs:** Use the SIEM to search for Event ID 4624. Filter the results for events initiated by `WmiPrvSE.exe` to identify the nature of the logins.
    
  - **Correlate with User Activity:** Cross-reference the accounts involved in the logon events against user activity logs and scheduled tasks to identify any abnormal behavior or unauthorized access.
  - **Inspect Process and Network Activity:** Utilize EDR tools to analyze processes spawned by WMI logon events, as well as any associated network connections that may indicate malicious activity.
  - **Examine Account Permissions:** Check the permissions and roles of the accounts identified in the logins to verify if they have legitimate access and to determine if any accounts are being used out of their intended scope.
  ### Prioritization
  This alert has a low severity level because successful logon attempts via WMI can often be legitimate, such as those performed by authorized system administrators using monitoring tools. However, contextual investigation is essential to rule out any potential misuse.
  ### Blind Spots and Assumptions
  There are assumptions that every successful login via WMI is malicious, which is not always the case. This rule may not fire if the WMI logon is not logged due to misconfiguration or if the WMI service is being used legitimately by administrative tools. Additionally, if an adversary uses the legitimate credentials of an active user, it may evade detection, highlighting the necessity of correlating this rule with other logs and behavioral indicators.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and comprehensiveness, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
