title: New Module Module Added To IIS Server
id: dd857d3e-0c6e-457b-9b48-e82ae7f86bd7
status: experimental
description: Detects the addition of a new module to an IIS server.
references:
- https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis
- https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/
- https://www.microsoft.com/en-us/security/blog/2022/07/26/malicious-iis-extensions-quietly-open-persistent-backdoors-into-servers/
- https://learn.microsoft.com/en-us/iis/get-started/introduction-to-iis/iis-modules-overview
author: frack113
date: 2024-10-06
tags:
- attack.defense-evasion
- attack.persistence
- attack.t1562.002
- attack.t1505.004
logsource:
  product: windows
  service: iis-configuration
detection:
  selection:
    EventID: 29
    Configuration|contains: '/system.webServer/modules/add'
  filter_main_builtin:
    NewValue:
    - 'AnonymousAuthenticationModule'
    - 'CustomErrorModule'
    - 'DefaultDocumentModule'
    - 'DirectoryListingModule'
    - 'FileCacheModule'
    - 'HttpCacheModule'
    - 'HttpLoggingModule'
    - 'ProtocolSupportModule'
    - 'RequestFilteringModule'
    - 'StaticCompressionModule'
    - 'StaticFileModule'
    - 'TokenCacheModule'
    - 'UriCacheModule'
  filter_main_remove:
    NewValue: ''
  condition: selection and not 1 of filter_main_*
falsepositives:
- Legitimate administrator activity
level: medium
notes: |
  ### Technical Context
  This detection rule identifies the addition of new modules to an Internet Information Services (IIS) server configuration, specifically monitoring for modifications to the `/system.webServer/modules` section. The rule focuses on events generated by IIS where `EventID 29` indicates that a module has been added. By examining the specifics of the configuration changes, it can differentiate between potentially malicious entries—which may represent web shells or backdoors—and standard configurations, which often include built-in modules like AnonymousAuthenticationModule or DefaultDocumentModule. This allows the SOC team to hone in on unexpected or unauthorized module additions that can compromise server security.
  To detect these changes, the rule leverages IIS configuration logs, particularly looking for entries that contain the phrase `'/system.webServer/modules/add'` while filtering out common, legitimate modules that could otherwise trigger false positives. This targeted approach helps ensure that incident responders can effectively focus their investigations on genuine threats while minimizing noise from typical administrative changes.
  ### Investigation Steps
  - Review the IIS configuration logs in the EDR tool to identify the timestamps and details surrounding the addition of the new module.
  - Cross-reference the changes against the list of approved modules to determine if the newly added module is legitimate or potentially malicious.
  - Utilize the SIEM to analyze historical data for any unusual patterns or repeated changes in module additions, connecting the data to user accounts involved in the modifications.
  - Investigate network traffic logs from the NDR for any anomalous connections originating from the IIS server following the addition of the new module.
