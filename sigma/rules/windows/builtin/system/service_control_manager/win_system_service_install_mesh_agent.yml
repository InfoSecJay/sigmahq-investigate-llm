title: Mesh Agent Service Installation
id: e0d1ad53-c7eb-48ec-a87a-72393cc6cedc
status: test
description: Detects a Mesh Agent service installation. Mesh Agent is used to remotely
  manage computers
references:
- https://thedfirreport.com/2022/11/28/emotet-strikes-again-lnk-file-leads-to-domain-wide-ransomware/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022-11-28
tags:
- attack.command-and-control
- attack.t1219
logsource:
  product: windows
  service: system
detection:
  selection_root:
    Provider_Name: 'Service Control Manager'
    EventID: 7045
  selection_service:
  - ImagePath|contains: 'MeshAgent.exe'
  - ServiceName|contains: 'Mesh Agent'
  condition: all of selection_*
falsepositives:
- Legitimate use of the tool
level: medium
notes: |
  ### Technical Context
  The Sigma rule titled "Mesh Agent Service Installation" is designed to detect the installation of the Mesh Agent service, which is commonly employed for remote management of computers. This detection is achieved by monitoring the Windows System event logs, specifically looking for Event ID 7045 generated by the Service Control Manager. The rule identifies potential installations by analyzing the `ImagePath` and `ServiceName` fields, ensuring they contain the values 'MeshAgent.exe' and 'Mesh Agent', respectively. By focusing on these specifics, the rule aims to identify unauthorized or malicious installations of the Mesh Agent, which could be indicative of command-and-control activities, as per the MITRE ATT&CK tactics, particularly under the technique T1219 (Remote Access Software).
  ### Investigation Steps
  - **Review EDR Logs:** Check EDR logs for any recent installations or modifications related to the Mesh Agent service, focusing on timestamps that align with the alert generation.
  - **Analyze Event Logs:** Investigate Windows Event Logs for Event ID 7045 to find additional context around the service's installation, including the user account that initiated the action.
  - **Examine Network Activity:** Utilize network detection tools to inspect outbound connections related to Mesh Agent, especially connections to unfamiliar IP addresses or domains.
  - **Check for Malware Artifacts:** Use antivirus (AV) and endpoint security tools to scan for any associated threats or malicious indicators linked to the use of the Mesh Agent application.
  ### Prioritization
  This alert is categorized with a medium severity level because the installation of the Mesh Agent can be a legitimate administrative task, but it may also indicate a potential security breach or misuse of remote access tools within the enterprise.
  ### Blind Spots and Assumptions
  There are several blind spots associated with this rule. First, legitimate administrative use of the Mesh Agent may result in false positives, leading to unnecessary investigations. Additionally, if an adversary modifies the ImagePath or ServiceName fields to disguise the installation, the rule may fail to detect the unauthorized service. It is also assumed that all installations will generate the designated Event ID; however, manual or script-based installations that bypass standard service controls may not trigger the relevant logs.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
