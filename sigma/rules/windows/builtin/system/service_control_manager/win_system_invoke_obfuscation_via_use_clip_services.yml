title: Invoke-Obfuscation Via Use Clip - System
id: 63e3365d-4824-42d8-8b82-e56810fefa0c
status: test
description: Detects Obfuscated Powershell via use Clip.exe in Scripts
references:
- https://github.com/SigmaHQ/sigma/issues/1009     # (Task29)
author: Nikita Nazarov, oscd.community
date: 2020-10-09
modified: 2022-11-29
tags:
- attack.defense-evasion
- attack.t1027
- attack.execution
- attack.t1059.001
logsource:
  product: windows
  service: system
detection:
  selection:
    Provider_Name: 'Service Control Manager'
    EventID: 7045
    ImagePath|contains: '(Clipboard|i'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  This detection rule identifies the use of obfuscated PowerShell commands invoked via `Clip.exe`, a standard Windows utility that manipulates the clipboard. The rule focuses on events from the Windows System logs, specifically monitoring for Event ID 7045 generated by the Service Control Manager. When an application attempts to use `Clip.exe` in a manner associated with obfuscation, it is flagged as a potential indicator of an adversarial technique aimed at evading detection. This aligns with the MITRE ATT&CK tactics of Defense Evasion (T1027) and Execution (T1059.001), as attackers often use such methods to obscure their malicious activities and avoid detection by traditional security mechanisms.
  ### Investigation Steps
  - **Review EDR Alerts:** Check the endpoint security solution for any alerts related to the execution of PowerShell and `Clip.exe` during the time frame of the incident to assess the context of execution.
  - **Analyze Windows Event Logs:** Query the Windows System logs for Event ID 7045 to investigate other processes or users that may have interacted with `Clip.exe` around the same time, indicating potential lateral movement or coordinated actions.
  - **Examine Process Creation Details:** Utilize Sysmon logs for process creation events to identify any parent processes that invoked PowerShell and assess command-line arguments used, which might reveal further obfuscation efforts.
  - **Check Network Activity:** Investigate if any network connections were made from the endpoint to unusual or blacklisted addresses during the same time period to understand possible data exfiltration attempts.
  ### Prioritization
  This alert is prioritized as high severity due to the potential implications of evasion techniques being employed within the environment, which may indicate active malicious activity or a compromise requiring immediate investigation.
  ### Blind Spots and Assumptions
  The rule may not fire if attackers employ alternative methods for obfuscation that do not involve `Clip.exe`, or if they utilize personal devices not monitored by organizational controls. Additionally, if `Clip.exe` or similar processes are used for legitimate purposes, it may lead to false positives. Responder teams should always consider that well-crafted evasion techniques could limit the visibility of such tactics.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
