title: Service Installation in Suspicious Folder
id: 5e993621-67d4-488a-b9ae-b420d08b96cb
status: test
description: Detects service installation in suspicious folder appdata
author: pH-T (Nextron Systems)
references:
- Internal Research
date: 2022-03-18
modified: 2024-01-18
tags:
- attack.persistence
- attack.privilege-escalation
- car.2013-09-005
- attack.t1543.003
logsource:
  product: windows
  service: system
detection:
  selection:
    Provider_Name: 'Service Control Manager'
    EventID: 7045
    ImagePath|contains:
    - '\AppData\'
    - '\\\\127.0.0.1'
    - '\\\\localhost'
  filter_optional_zoom:
    ServiceName: 'Zoom Sharing Service'
    ImagePath|contains: ':\Program Files\Common Files\Zoom\Support\CptService.exe'
  condition: selection and not 1 of filter_optional_*
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The "Service Installation in Suspicious Folder" rule detects attempts to install services directly within the user-specific AppData directory on Windows systems. This behavior is atypical and often indicates malicious activity, as legitimate services are usually installed in the `%ProgramFiles%` or `%SystemRoot%` directories. The rule triggers based on events generated by the Service Control Manager (SCM), specifically Event ID 7045, which captures instances of service creation. Key indicators monitored include the service provider name and the image path, with particular attention to paths containing `\AppData\`, `\\127.0.0.1`, or `\\localhost`. The rule also filters out specific optional services for common software like Zoom to reduce false positives. This detection falls under the MITRE ATT&CK tactic of "Persistence" (T1543.003) and relates closely to privilege escalation techniques.
  ### Investigation Steps
  - **Check Service Details:** Open the Service Management Console or utilize PowerShell to investigate the newly created service, including its status, dependencies, and the executable path to verify legitimacy.
  - **Review Event Logs:** Analyze Windows Event Logs, particularly Security and System logs, for corresponding events that provide context on the service installation and any user activities that preceded it.
  - **Examine EDR Alerts:** Use EDR tools to identify any other suspicious activities associated with the service installation, such as unusual process creations or attempted file modifications in the AppData directory.
  - **Network Analysis:** Check network connection logs to identify any outbound connections initiated by the suspicious service, especially those targeting uncommon external hosts or using non-standard ports.
  ### Prioritization
  This alert is classified with medium severity because service installations in unexpected directories can indicate potential compromise or misconfigured systems. Timely investigation is essential to rule out malicious activity.
  ### Blind Spots and Assumptions
  This rule may not fire in cases where the service installation is executed without triggering Event ID 7045, such as through direct registry edits or if the service creation is done within an elevated context bypassing event logging. Additionally, if users have legitimate reasons for using `AppData` for service installations (e.g., internal applications), there may be an assumption of normal operations that could lead to a higher rate of false positives.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and clarity, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
