title: Potential CVE-2021-42287 Exploitation Attempt
id: e80a0fee-1a62-4419-b31e-0d0db6e6013a
related:
- id: 44bbff3e-4ca3-452d-a49a-6efa4cafa06f
  type: similar
status: test
description: |
  The attacker creates a computer object using those permissions with a password known to her.
  After that she clears the attribute ServicePrincipalName on the computer object.
  Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.
references:
- https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/
author: frack113
date: 2021-12-15
modified: 2023-04-14
tags:
- attack.credential-access
- attack.t1558.003
logsource:
  product: windows
  service: system
detection:
  selection:
    Provider_Name: Microsoft-Windows-Directory-Services-SAM      # Active Directory
    EventID:
    - 16990         # Object class and UserAccountControl validation failure
    - 16991         # SAM Account Name validation failure
  condition: selection
falsepositives:
- Unknown
fields:
- samAccountName
level: medium
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potential exploitation attempts of CVE-2021-42287, which involves attackers manipulating Active Directory (AD) objects. Specifically, the rule looks for events related to the creation of computer objects with specific attributes altered in an unauthorized manner. By monitoring the `Microsoft-Windows-Directory-Services-SAM` provider, the rule identifies event IDs 16990 and 16991, which indicate issues with object class validation and SAM Account Name validation failures, respectively. When an attacker creates a computer object and modifies its attributes, particularly clearing the `ServicePrincipalName`, they gain elevated privileges due to the rights associated with the object they created.
  ### Investigation Steps
  - Review the EDR for suspicious process creation events and track any created computer objects within the Active Directory.
  - Analyze event logs in Active Directory for the specified Event IDs (16990 and 16991) to check for patterns of suspicious object creation or modification.
  - Utilize SIEM to search for related logs that indicate unauthorized permission changes or abnormal account activity associated with the affected objects.
  - Correlate findings with network traffic data from NDR systems to detect any unusual communications that may indicate further exploitation or lateral movement attempts.
