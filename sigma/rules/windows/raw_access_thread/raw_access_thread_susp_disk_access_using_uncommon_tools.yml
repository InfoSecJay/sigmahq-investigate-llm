title: Potential Defense Evasion Via Raw Disk Access By Uncommon Tools
id: db809f10-56ce-4420-8c86-d6a7d793c79c
status: test
description: Detects raw disk access using uncommon tools or tools that are located
  in suspicious locations (heavy filtering is required), which could indicate possible
  defense evasion attempts
references:
- https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment
author: Teymur Kheirkhabarov, oscd.community
date: 2019-10-22
modified: 2023-11-28
tags:
- attack.defense-evasion
- attack.t1006
logsource:
  product: windows
  category: raw_access_thread
detection:
  filter_main_floppy:
    Device|contains: floppy
  filter_main_generic:
    Image|contains:
    - ':\$WINDOWS.~BT\'
    - ':\Program Files (x86)\'
    - ':\Program Files\'
    - ':\Windows\CCM\'
    - ':\Windows\explorer.exe'
    - ':\Windows\servicing\'
    - ':\Windows\SoftwareDistribution\'
    - ':\Windows\System32\'
    - ':\Windows\SystemApps\'
    - ':\Windows\uus\'
    - ':\Windows\WinSxS\'
  filter_main_system_images:
    Image:
    - 'Registry'
    - 'System'
  filter_main_windefender:
    Image|contains: ':\ProgramData\Microsoft\Windows Defender\Platform\'
    Image|endswith: '\MsMpEng.exe'
  filter_main_microsoft_appdata:
    Image|contains|all:
    - ':\Users\'
    - '\AppData\'
    - '\Microsoft\'
  filter_main_ssd_nvme:
    Image|contains: ':\Windows\Temp\'
    Image|endswith:
    - '\Executables\SSDUpdate.exe'
    - '\HostMetadata\NVMEHostmetadata.exe'
  filter_main_null:
    Image:
  filter_main_systemsettings:
    Image|endswith: ':\Windows\ImmersiveControlPanel\SystemSettings.exe'
  filter_optional_github_desktop:
    Image|contains: '\AppData\Local\GitHubDesktop\app-'
    Image|endswith: '\resources\app\git\mingw64\bin\git.exe'
  filter_optional_nextron:
    Image|contains: ':\Windows\Temp\asgard2-agent\'
    Image|endswith: '\thor.exe'
  filter_optional_Keybase:
    Image|contains: '\AppData\Local\Keybase\upd.exe'
  condition: not 1 of filter_main_* and not 1 of filter_optional_*
falsepositives:
- Likely
level: low
notes: |
  ### Technical Context
  This detection rule identifies potential defense evasion activities by monitoring raw disk access initiated by uncommon tools or those located in suspicious directories. The rule utilizes event logs generated by Windows Sysmon to analyze activity related to raw access threadsâ€”specifically looking for process images that originate from predefined suspicious paths, including system directories and application folders known for safe or common operations. By targeting these unconventional processes, the rule aims to detect manipulative behavior that might suggest an attacker is attempting to bypass security mechanisms and conceal their actions. This relates to the MITRE ATT&CK technique **T1006**, which focuses on 'Credential Dumping' and similarly deceptive strategies employed by adversaries.
  ### Investigation Steps
  - **Review Sysmon Logs**: Use Windows Sysmon logs to identify any raw disk access events associated with the suspicious process paths highlighted in the rule, focusing on the timestamps and associated user accounts.
  - **Cross-reference EDR Alerts**: Check your Endpoint Detection and Response (EDR) system for alerts related to the identified processes. Investigate any notable behavior patterns and additional alerts that might indicate malicious activity.
  - **Analyze Process Metadata**: For any flagged processes, analyze associated command-line arguments and parent-child relationships to understand the execution context and determine if escalation or lateral movement is occurring.
  - **Monitor Network Activity**: Examine network connection logs (using NDR) to identify any unusual outbound connections made by the detected processes, potentially revealing data exfiltration attempts or communication with command and control (C2) servers.
  ### Prioritization
  The alert is assigned a low severity level, as the detection is based on uncommon tool usage and specific conditions that may not always indicate malicious intent. However, any raw access attempts from non-standard applications warrant further investigation to rule out defense evasion strategies.
  ### Blind spots and Assumptions
  This rule may not trigger in scenarios where the suspicious process does not fall under the specified filtering conditions or if it utilizes common disk access patterns that don't align with the predefined suspicious paths. Additionally, if an attacker has administrative privileges or uses legitimate tools for their access needs, the detection might fail. It's assumed that all monitored systems have adequate Sysmon configuration for comprehensive coverage; without proper logging enablement, critical events may go unnoticed.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
