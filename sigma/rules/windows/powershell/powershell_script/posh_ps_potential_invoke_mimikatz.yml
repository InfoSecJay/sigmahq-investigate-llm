title: Potential Invoke-Mimikatz PowerShell Script
id: 189e3b02-82b2-4b90-9662-411eb64486d4
status: test
description: Detects Invoke-Mimikatz PowerShell script and alike. Mimikatz is a credential
  dumper capable of obtaining plaintext Windows account logins and passwords.
references:
- https://www.elastic.co/guide/en/security/current/potential-invoke-mimikatz-powershell-script.html#potential-invoke-mimikatz-powershell-script
author: Tim Rauch, Elastic (idea)
date: 2022-09-28
tags:
- attack.credential-access
- attack.t1003
logsource:
  category: ps_script
  product: windows
detection:
  selection_1:
    ScriptBlockText|contains|all:
    - 'DumpCreds'
    - 'DumpCerts'
  selection_2:
    ScriptBlockText|contains: 'sekurlsa::logonpasswords'
  selection_3:
    ScriptBlockText|contains|all:
    - 'crypto::certificates'
    - 'CERT_SYSTEM_STORE_LOCAL_MACHINE'
  condition: 1 of selection*
falsepositives:
- Mimikatz can be useful for testing the security of networks
level: high
notes: |
  ### Technical Context
  This detection rule aims to identify instances of the Invoke-Mimikatz PowerShell script, a well-known credential dumper that can extract plaintext Windows account logins and passwords from memory. The rule specifically targets various indicators within PowerShell script blocks, which are common when Mimikatz is invoked. It looks for script block text that includes key commands associated with Mimikatz, such as 'DumpCreds', 'DumpCerts', and 'sekurlsa::logonpasswords', alongside other phrases that reference certificate dumping functions. By monitoring script block text in real-time PowerShell execution logs, the detection leverages data sourced from Windows Sysmon to effectively spot potential credential theft activities.
  This rule aligns with the MITRE ATT&CK tactic "Credential Access" and specifically targets the technique T1003, which pertains to credential dumping methods. Since credential access is a critical concern for enterprise security, this detection is prioritized to prevent unauthorized access to sensitive information and ensure the integrity of user credentials across the network.
  ### Investigation Steps
  - **Check EDR Alerts:** Review alerts generated by the Endpoint Detection and Response (EDR) tool for any unusual PowerShell activities or suspicious process creations that coincide with the detection of the Mimikatz script.
  - **Examine Process Creation Logs:** Utilize Windows Event Logs, specifically the security and Sysmon logs, to identify when and how the PowerShell process was initiated, noting any anomalous parent processes.
  - **Analyze PowerShell Logs:** Review PowerShell script block logging and transcription logs to understand the command context and any associated parameters or variables that may reveal further malicious intent.
  - **Evaluate User Activity:** Check user account logs via SIEM for suspicious login activities or privilege escalations, especially under the account that executed the PowerShell script, as this may indicate targeted credential theft.
  ### Prioritization
  This alert is classified as high severity due to the inherent risk associated with credential dumping activities, which can lead to unauthorized access, account compromise, and potential breaches within the enterprise environment.
  ### Blind Spots and Assumptions
  The rule may not fire in scenarios where PowerShell script block logging is disabled, or if the Mimikatz invocation is obscured by obfuscation techniques. Furthermore, legitimate security testing practices using Mimikatz may trigger false positives. It's also assumed that the environment is properly configured to log the necessary telemetry. Adversaries employing sophisticated evasion techniques may defeat detection methods by altering script contents or utilizing other tools.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
