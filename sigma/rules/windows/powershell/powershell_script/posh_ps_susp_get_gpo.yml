title: Suspicious GPO Discovery With Get-GPO
id: eb2fd349-ec67-4caa-9143-d79c7fb34441
status: test
description: Detect use of Get-GPO to get one GPO or all the GPOs in a domain.
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1615/T1615.md
- https://learn.microsoft.com/en-us/powershell/module/grouppolicy/get-gpo?view=windowsserver2022-ps
author: frack113
date: 2022-06-04
tags:
- attack.discovery
- attack.t1615
logsource:
  product: windows
  category: ps_script
  definition: 'Requirements: Script Block Logging must be enabled'
detection:
  selection:
    ScriptBlockText|contains: Get-GPO
  condition: selection
falsepositives:
- Legitimate PowerShell scripts
level: low
notes: |
  ### Technical Context
  This Sigma rule is designed to detect potentially unauthorized use of the PowerShell command `Get-GPO`, which retrieves Group Policy Objects (GPOs) in a Windows domain. The command can be utilized by legitimate administrators; however, it may also indicate reconnaissance efforts during lateral movement or privilege escalation by an adversary. The rule monitors PowerShell script execution logs, necessitating that Script Block Logging is enabled on target systems. When a script is executed that contains the string `Get-GPO`, an alert is triggered. This activity correlates with the MITRE ATT&CK tactic of **Discovery** and the specific technique referenced as **T1615: Accessing Group Policy Objects**. 
  ### Investigation Steps
  - **Review PowerShell Logs:** Check the PowerShell script block logs in Windows Event Logs to identify the exact commands executed before and after the `Get-GPO` command to gather context around the action.
  - **Correlate User Activity:** Utilize EDR tools to analyze the user account associated with the `Get-GPO` execution. Determine if the account exhibits signs of anomalous behavior, such as accessing resources beyond usual permissions or logging in at unusual hours.
  - **Inspect GPO Changes:** Verify if any changes have been made to GPOs recently. This can be accomplished by reviewing the GPO change logs in the Group Policy Management Console or via relevant Windows Security logs.
  - **Evaluate the Environment for Misconfigurations:** Access logs from your Active Directory environment to ensure appropriate user permissions are maintained. Investigate if there have been any recent changes to administrative roles or policy applications.
  ### Prioritization
  The alert generated by this rule is deemed low severity because while the usage of `Get-GPO` can be indicative of reconnaissance, it is also commonly used by legitimate administrators during routine tasks. Contextual investigation is necessary to ascertain whether the activity is malicious or benign.
  ### Blind spots and Assumptions
  This rule could fail to detect certain anomalous activities if Script Block Logging is not enabled on the target systems, as required. Furthermore, legitimate use cases from authorized users may generate false positives; hence, a comprehensive understanding of the environment is crucial. Adversaries may also use obfuscation techniques or modify the command syntax to bypass detection, leading to potential blind spots in monitoring.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
