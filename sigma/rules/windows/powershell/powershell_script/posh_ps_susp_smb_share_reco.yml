title: Suspicious Get Information for SMB Share
id: 95f0643a-ed40-467c-806b-aac9542ec5ab
status: test
description: |
  Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as
  a precursor for Collection and to identify potential systems of interest for Lateral Movement.
  Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md
author: frack113
date: 2021-12-15
modified: 2022-12-25
tags:
- attack.discovery
- attack.t1069.001
logsource:
  product: windows
  category: ps_script
  definition: 'Requirements: Script Block Logging must be enabled'
detection:
  selection:
    ScriptBlockText|contains: get-smbshare
  condition: selection
falsepositives:
- Unknown
level: low
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect suspicious attempts to enumerate shared network folders using the `Get-SmbShare` PowerShell cmdlet. Adversaries often leverage this technique as a means to discover shared resources on remote systems, providing insight into potential targets for information gathering or lateral movement efforts. The rule listens for specific events captured as script block logs in Windows environments, specifically looking for instances where `Get-SmbShare` is invoked. This rule aligns with the MITRE ATT&CK tactic of Discovery and the technique T1069.001, which focuses on remote system sharing enumeration.
  The key technical data source involved in this detection is Winodws Script Block Logging. For this rule to function, it is essential that Script Block Logging is enabled, as it ensures all executed PowerShell scripts and commands—including any that might contain the call to `Get-SmbShare`—are logged for analysis.
  ### Investigation Steps
  - **Check PowerShell Logs**: Utilize EDR tools to examine PowerShell logs for the execution context of the `Get-SmbShare` command, noting the user account that executed it and the timestamp of the event.
  - **Analyze Network Connections**: Review network connection logs for any suspicious outbound requests from the host that executed the command, particularly towards internal or external SMB services.
  - **Review User Activity**: Cross-reference the user account that ran the command with historical login events and any other security alerts, assessing the user's role and permissions within the organization.
  - **Inspect File Shares**: Conduct a manual examination of the identified SMB shares on the targeted systems to ascertain whether the access aligns with legitimate user behavior or indicates potential reconnaissance activity.
  ### Prioritization
  The alert generated by this rule is categorized as low severity. However, it should be prioritized for further investigation as it may indicate preparatory steps taken by an adversary, potentially leading to more serious threats such as unauthorized data access or lateral movement within the network.
  ### Blind Spots and Assumptions
  This detection rule operates under the assumption that Script Block Logging is appropriately configured and enabled across the environment. A potential blind spot may occur if these logs are not being captured or monitored effectively. Additionally, sophisticated adversaries may employ obfuscation techniques to disguise their use of `Get-SmbShare`, or combine it with other PowerShell commands to evade detection. There is also the risk of generating false positives if legitimate administrative users execute the command for benign purposes.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
