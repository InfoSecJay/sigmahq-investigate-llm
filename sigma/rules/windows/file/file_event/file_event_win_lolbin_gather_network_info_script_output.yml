title: GatherNetworkInfo.VBS Reconnaissance Script Output
id: f92a6f1e-a512-4a15-9735-da09e78d7273
related:
- id: 575dce0c-8139-4e30-9295-1ee75969f7fe     # ProcCreation LOLBIN
  type: similar
- id: 07aa184a-870d-413d-893a-157f317f6f58     # ProcCreation Susp
  type: similar
status: test
description: Detects creation of files which are the results of executing the built-in
  reconnaissance script "C:\Windows\System32\gatherNetworkInfo.vbs".
references:
- https://posts.slayerlabs.com/living-off-the-land/#gathernetworkinfovbs
- https://www.mandiant.com/resources/blog/trojanized-windows-installers-ukrainian-government
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-02-08
tags:
- attack.discovery
logsource:
  product: windows
  category: file_event
detection:
  selection:
    TargetFilename|startswith: 'C:\Windows\System32\config'
    TargetFilename|endswith:
    - '\Hotfixinfo.txt'
    - '\netiostate.txt'
    - '\sysportslog.txt'
    - '\VmSwitchLog.evtx'
  condition: selection
falsepositives:
- Unknown
level: medium
notes: |
  ### Technical Context
  The detection rule "GatherNetworkInfo.VBS Reconnaissance Script Output" is designed to identify potential reconnaissance activities performed using the built-in Windows script `gatherNetworkInfo.vbs`, which is part of the operating system. This rule specifically looks for the creation of files generated by this script, typically located in the `C:\Windows\System32\config` directory, and includes specific file names such as `Hotfixinfo.txt`, `netiostate.txt`, `sysportslog.txt`, and `VmSwitchLog.evtx`. By monitoring file events related to these outputs, the rule aims to detect potential malicious activities where an adversary may be gathering network information to facilitate further attacks.
  The detection leverages Windows file event logs, which provide insights into file creation activities on the system. Given the context of reconnaissance operations, this rule is mapped to the MITRE ATT&CK framework under the "Discovery" tactic, specifically related to techniques that involve collecting information about the environment, such as network configurations and system settings.
  ### Investigation Steps
  - **Check File Creation Logs**: Review the relevant file event logs on the impacted host to confirm the creation of suspicious files matching the rule's criteria.
    
  - **Analyze Process Activity**: Utilize EDR tools to view the process tree and identify any parent processes that executed the `gatherNetworkInfo.vbs` script, confirming its execution context.
  - **Examine Network Traffic**: Investigate any unusual or unauthorized network connections made by the host post script execution, focusing on outbound connections during the period of activity.
  - **Correlate with System Events**: Access the Windows Security, System, or Application logs for additional context around the time of the detected file creation, looking for suspicious logon events or process creation anomalies.
  ### Prioritization
  This alert is categorized as medium priority due to the potential for reconnaissance activities to precede a more significant attack. Identifying this behavior early on is critical in preventing further exploitation.
  ### Blind Spots and Assumptions
  This detection may not fire in environments where the `gatherNetworkInfo.vbs` script is legitimately used for administrative purposes, thereby leading to potential false positives. Additionally, if an adversary renames or modifies the script or its output files, the detection rule may fail to trigger. It is also assumed that file logging is enabled and functioning correctly; if logging is disabled or misconfigured, relevant events may not be captured.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
