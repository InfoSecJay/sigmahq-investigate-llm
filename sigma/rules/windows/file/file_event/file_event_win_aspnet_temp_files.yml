title: Assembly DLL Creation Via AspNetCompiler
id: 4c7f49ee-2638-43bb-b85b-ce676c30b260 # TMP File
related:
- id: 9ccba514-7cb6-4c5c-b377-700758f2f120     # SuspChild
  type: similar
- id: 9f50fe98-fe5c-4a2d-86c7-fad7f63ed622     # Susp Paths
  type: similar
- id: a01b8329-5953-4f73-ae2d-aa01e1f35f00     # Exec
  type: similar
status: test
description: |
  Detects the creation of new DLL assembly files by "aspnet_compiler.exe", which could be a sign of "aspnet_compiler" abuse to proxy execution through a build provider.
references:
- Internal Research
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-08-14
tags:
- attack.execution
logsource:
  product: windows
  category: file_event
detection:
  selection:
    Image|endswith: '\aspnet_compiler.exe'
    TargetFilename|contains|all:
    - '\Temporary ASP.NET Files\'
    - '\assembly\tmp\'
    - '.dll'
  condition: selection
falsepositives:
- Legitimate assembly compilation using a build provider
level: medium
notes: |
  n
  ### Technical Context
  This Sigma rule is designed to detect the creation of new Dynamic Link Library (DLL) files using the "aspnet_compiler.exe" process, which is commonly associated with ASP.NET applications. An attacker may exploit this legitimate tool to create unauthorized assemblies and execute malicious payloads, taking advantage of the build provider mechanism. The rule specifically looks for instances where the target filename contains paths indicating temporary ASP.NET files and includes directories like `\Temporary ASP.NET Files\` and `\assembly\tmp\`. By monitoring the execution of the "aspnet_compiler.exe" image, the rule correlates with the MITRE ATT&CK technique of "Execution" (T1203), noting behavioral patterns that might signify abuse of this process for nefarious purposes. Key data sources utilized in this detection include file event logs that capture filesystem changes alongside process execution logs.
  ### Investigation Steps
  - **Review Alert Details:** Examine the alert generated by the Sigma rule for specific metadata including timestamps, source IP addresses, and the TargetFilename to contextualize the event.
  - **Check Process Activity:** Utilize EDR tools to investigate the use of "aspnet_compiler.exe" on the host, reviewing command-line arguments and parent-child process relationships to identify if there are any anomalous patterns.
  - **Correlate with Other Logs:** Search Windows Event Logs (Security, Application) and Sysmon logs for additional context around the time of the DLL creation, focusing on related process creation events or any suspicious network connections initiated from the same host.
  - **Assess File Integrity:** Investigate the created DLL file by checking its hash value and properties using AV solutions or file analysis tools to determine if it matches known malicious signatures or exhibits traits typical of malicious software.
  ### Prioritization
  This alert is categorized as medium severity because while the creation of a DLL via "aspnet_compiler.exe" could be a legitimate action, its occurrence warrants further investigation due to the potential for exploitation in a production or sensitive environment.
  ### Blind Spots and Assumptions
  This rule may not fire if "aspnet_compiler.exe" is executed in a non-standard way or if it's run with elevated privileges that bypass notification mechanisms. Additionally, legitimate assembly compilations using a build provider could generate false positives, leading to alerts that are neither malicious nor indicative of an ongoing attack. Analysts should also consider that adversaries could overwrite or manipulate legitimate tools to avoid detection, which may prevent this rule from triggering.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
