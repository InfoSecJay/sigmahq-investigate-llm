title: Potential Persistence Via Microsoft Office Startup Folder
id: 0e20c89d-2264-44ae-8238-aeeaba609ece
status: test
description: Detects creation of Microsoft Office files inside of one of the default
  startup folders in order to achieve persistence.
references:
- https://insight-jp.nttsecurity.com/post/102hojk/operation-restylink-apt-campaign-targeting-japanese-companies
- https://learn.microsoft.com/en-us/office/troubleshoot/excel/use-startup-folders
author: Max Altgelt (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2022-06-02
modified: 2023-06-22
tags:
- attack.persistence
- attack.t1137
logsource:
  category: file_event
  product: windows
detection:
  selection_word_paths:
  - TargetFilename|contains: '\Microsoft\Word\STARTUP'
  - TargetFilename|contains|all:
    - '\Office'
    - '\Program Files'
    - '\STARTUP'
  selection_word_extension:
    TargetFilename|endswith:
    - '.doc'
    - '.docm'
    - '.docx'
    - '.dot'
    - '.dotm'
    - '.rtf'
  selection_excel_paths:
  - TargetFilename|contains: '\Microsoft\Excel\XLSTART'
  - TargetFilename|contains|all:
    - '\Office'
    - '\Program Files'
    - '\XLSTART'
  selection_excel_extension:
    TargetFilename|endswith:
    - '.xls'
    - '.xlsm'
    - '.xlsx'
    - '.xlt'
    - '.xltm'
  filter_main_office:
    Image|endswith:
    - '\WINWORD.exe'
    - '\EXCEL.exe'
  condition: (all of selection_word_* or all of selection_excel_*) and not filter_main_office
falsepositives:
- Loading a user environment from a backup or a domain controller
- Synchronization of templates
level: high
notes: |
  n
  ### Technical Context
  This detection rule targets potential persistence mechanisms leveraging Microsoft Office by identifying the creation of Office files in specific startup directories, such as the Word STARTUP folder or Excel XLSTART folder. These folders are designated for loading templates upon starting the respective Office applications. The rule checks for specific filename extensions associated with Microsoft Word and Excel documents, including various document and template formats (e.g., `.docx`, `.xlsm`). By monitoring file creation events in the relevant paths, the rule can help detect unauthorized attempts by threat actors to maintain a foothold within the environment, a technique documented under MITRE ATT&CK as T1137 (Office Application Startup Folder). 
  The detection leverages telemetry from file event logs generated by Windows, capturing relevant details about newly created files and their paths. Effective monitoring of file creation events, in conjunction with specific naming patterns and paths, enhances the ability of SOC analysts to recognize patterns that may indicate malicious persistence mechanisms.
  ### Investigation Steps
  - **Check Event Logs:** Review the Windows Security logs to trace the creation of Office files and identify the user account responsible for this activity, focusing on any unusual patterns or times.
  - **Examine File Properties:** Investigate the properties of the created Office files, including timestamps, file size, and associated user credentials to determine if they were legitimate creations or potential artifacts of unauthorized activity.
  - **Review Office Application Logs:** Check application logs for Microsoft Word and Excel to gather additional context on the usage of these applications around the time the files were created.
  - **Analyze EDR Alerts:** Utilize EDR tools to search for related alerts or anomalies involving the Office applications, specifically looking for any suspicious activities tied to the accounts that created the files.
  ### Prioritization
  The severity of this alert is rated as high due to the potential for malicious actors to establish persistence in the environment, particularly through commonly used applications like Microsoft Office. This persistence could indicate ongoing compromise, requiring immediate investigation and response.
  ### Blind Spots and Assumptions
  This rule may not fire if an adversary uses legitimate administrative privileges to create files in these directories or if the files are created during legitimate operations such as user environment restores or synchronization activities. Additionally, false positives may occur during legitimate template loading from a backup. Understanding these nuances is crucial for analysts to avoid misinterpretation of alerts and ensure accurate triage.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
