title: HackTool - Mimikatz Kirbi File Creation
id: 9e099d99-44c2-42b6-a6d8-54c3545cab29
related:
- id: 034affe8-6170-11ec-844f-0f78aa0c4d66
  type: obsolete
status: test
description: Detects the creation of files created by mimikatz such as ".kirbi", "mimilsa.log",
  etc.
references:
- https://cobalt.io/blog/kerberoast-attack-techniques
- https://pentestlab.blog/2019/10/21/persistence-security-support-provider/
author: Florian Roth (Nextron Systems), David ANDRE
date: 2021-11-08
modified: 2024-06-27
tags:
- attack.credential-access
- attack.t1558
logsource:
  category: file_event
  product: windows
detection:
  selection:
    TargetFilename|endswith:
    - '.kirbi'         # Kerberos tickets
    - 'mimilsa.log'         # MemSSP default file
  condition: selection
falsepositives:
- Unlikely
level: critical
notes: |
  n
  ### Technical Context
  This detection rule targets the creation of files associated with Mimikatz, specifically files with the extensions '.kirbi' and 'mimilsa.log'. Mimikatz is a well-known post-exploitation tool used for credential dumping and manipulation, particularly in Windows environments. The detection relies on file event logs generated by the Windows operating system, monitoring for the creation of suspicious files that are indicative of a potential Kerberos credential theft attempt. The rule is aligned with the MITRE ATT&CK framework, specifically addressing the "Credential Access" tactic and the "Enable Credential Dumping" technique (T1558). By leveraging file event logs, the rule helps to highlight unauthorized attempts to create these files, alerting SOC analysts to investigate further.
  ### Investigation Steps
  - **Review File Creation Logs**: Utilize the Windows file event logs to find the details of the created files. Confirm the paths and timestamps to establish if they align with expected user behavior during the times of interest.
    
  - **Check the Source Process**: Investigate the process that initiated the file creation using EDR data. Identify any anomalous or unauthorized processes that may have led to the creation of the Mimikatz files.
  - **Analyze System Activity**: Examine Sysmon logs, specifically focusing on process creations and network connections, to identify any suspicious activities or unusual patterns suggesting exploitation.
  - **Cross-Reference User Actions**: Verify the credentials of the user account associated with the file creation. Look at proxy logs or VPN activity to ascertain if there were any unusual access patterns consistent with credential abuse.
  ### Prioritization
  The severity level of "critical" for this alert is justified due to the potentially severe consequences associated with credential theft, which can lead to unauthorized access and system compromise. Given that such activities often precede larger attacks, immediate investigation is essential.
  ### Blind Spots and Assumptions
  This rule may not fire if Mimikatz files are created through a method that circumvents typical file event logging, such as in-memory execution or alternative file creation techniques that do not leverage standard APIs. Adversaries may also employ techniques to delete or alter file metadata post-creation, obscuring their activities. It is assumed that proper logging configurations are in place to capture all relevant file events, including those created by services or high-privilege users.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
