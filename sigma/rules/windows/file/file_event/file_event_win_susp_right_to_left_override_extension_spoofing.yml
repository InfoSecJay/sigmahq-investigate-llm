title: Potential File Extension Spoofing Using Right-to-Left Override
id: 979baf41-ca44-4540-9d0c-4fcef3b5a3a4
related:
- id: ad691d92-15f2-4181-9aa4-723c74f9ddc3
  type: derived
status: experimental
description: |
  Detects suspicious filenames that contain a right-to-left override character and a potentially spoofed file extensions.
references:
- https://redcanary.com/blog/right-to-left-override/
- https://www.malwarebytes.com/blog/news/2014/01/the-rtlo-method
author: Jonathan Peters (Nextron Systems), Florian Roth (Nextron Systems)
date: 2024-11-17
tags:
- attack.execution
- attack.defense-evasion
- attack.t1036.002
logsource:
  category: file_event
  product: windows
detection:
  selection_rtlo_unicode:
    TargetFilename|contains: '\u202e'
  selection_extensions:
    TargetFilename|contains:
    - 'fpd..'
    - 'nls..'
    - 'vsc..'
    - 'xcod.'
    - 'xslx.'
  condition: all of selection_*
falsepositives:
- Filenames that contains scriptures such as arabic or hebrew might make use of this
  character
level: high
notes: |
  ### Technical Context
  The detection rule for "Potential File Extension Spoofing Using Right-to-Left Override" aims to identify suspiciously named files that utilize the Right-to-Left Override (RTLO) character. This character can manipulate the order of text rendering in filenames, potentially tricking users and security solutions into misinterpreting the actual file extension, which creates opportunities for malware execution. Specifically, the rule looks for filenames that contain the RTLO character (`\u202e`) along with common spoofed extensions like `.fpd`, `.nls`, `.vsc`, `.xcod`, and `.xslx`. By monitoring file event logs on Windows systems, particularly through Sysmon, the rule integrates data from essential telemetry sources such as file creation and access events, ensuring a comprehensive detection capability. This rule aligns with the MITRE ATT&CK tactics of Execution (T1203) and Defense Evasion (T1036.002).
  ### Investigation Steps
  - **Check EDR Alerts:** Start by querying the Endpoint Detection and Response (EDR) platform for alerts related to the detected filenames, including additional context about process execution or user actions that may have triggered the alert.
  - **Review File Event Logs:** Cross-reference the suspicious file creations or modifications in the Windows Sysmon logs to gather insights into their creation time, associated processes, and user accounts involved.
  - **Analyze Process Activity:** Use process creation logs to identify any unusual activity linked to the suspicious filenames, focusing on parent-child relationships that might indicate malicious intent or user interactions.
  - **Correlate Threat Intelligence:** Examine threat intelligence feeds and correlate any reports about the specific file extensions flagged in the alert, leveraging firewall and proxy logs to identify any external interactions involving the suspicious files.
  ### Prioritization
  This alert is categorized with a high severity level due to the significant risk posed by attackers using file extension spoofing techniques to bypass security measures, potentially leading to the execution of malicious payloads on enterprise systems.
  ### Blind Spots and Assumptions
  There are several potential blind spots with this detection rule. For instance, legitimate file names containing the RTLO character, such as those in various languages or scripts, could generate false positives. Additionally, if adversaries employ less common or customized file extensions not covered by the rule, they may circumvent detection. Furthermore, this rule operates under the assumption that all relevant Sysmon file event logs are enabled and properly configured; without comprehensive telemetry coverage, detection may be incomplete. Analysts should stay aware of these nuances when interpreting alerts generated by this rule.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
