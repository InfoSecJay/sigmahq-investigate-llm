title: HackTool - NPPSpy Hacktool Usage
id: cad1fe90-2406-44dc-bd03-59d0b58fe722
status: test
description: Detects the use of NPPSpy hacktool that stores cleartext passwords of
  users that logged in to a local file
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003/T1003.md#atomic-test-2---credential-dumping-with-nppspy
- https://twitter.com/0gtweet/status/1465282548494487554
author: Florian Roth (Nextron Systems)
date: 2021-11-29
modified: 2024-06-27
tags:
- attack.credential-access
logsource:
  product: windows
  category: file_event
detection:
  selection:
    TargetFilename|endswith:
    - '\NPPSpy.txt'
    - '\NPPSpy.dll'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  The Sigma rule titled "HackTool 
  - NPPSpy Hacktool Usage" is designed to detect the use of NPPSpy, a known hacking tool that captures and stores cleartext passwords from usersâ€™ sessions in files named `NPPSpy.txt` or `NPPSpy.dll`. The detection focuses on file events where these specific filenames are created or written to. By monitoring these file creation events, the rule uses Windows telemetry to identify potentially malicious activity indicative of credential dumping, which falls under the MITRE ATT&CK tactic of Credential Access (T1003). Relevant technical data sources include file event logs that capture file access and modifications.
  ### Investigation Steps
  - **Check File Event Logs:** Investigate Windows file event logs to confirm the creation or modification of `NPPSpy.txt` or `NPPSpy.dll`, noting the user account associated with these actions.
  - **Analyze User Behavior:** Use EDR tools to assess the user behavior leading up to the file creation, focusing on whether any suspicious activities or process executions were recorded.
  - **Review Account Access:** Examine authentication logs for any unusual or unauthorized logins around the time the NPPSpy files were created, cross-referencing with legitimate user behavior.
  - **Scan for Other Artifacts:** Utilize AV and behavioral analysis tools to scan the endpoint for additional signs of compromise or other related artifacts that may indicate the presence of other credential dumping tools.
  ### Prioritization
  Given that the NPPSpy hacktool deals directly with credential theft, alerts generated by this rule should be treated with high severity due to the potential risk of significant data breaches and unauthorized access to sensitive information.
  ### Blind Spots and Assumptions
  This rule may not fire if the files `NPPSpy.txt` or `NPPSpy.dll` are deleted immediately after creation or if an adversary uses alternative filenames for their malicious activities. Additionally, legitimate processes might generate similar filenames, leading to potential false positives. This detection mechanism inherently assumes that file creation logging is adequately configured and enabled on monitored endpoints.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
