title: BloodHound Collection Files
id: 02773bed-83bf-469f-b7ff-e676e7d78bab
status: test
description: Detects default file names outputted by the BloodHound collection tool
  SharpHound
references:
- https://academy.hackthebox.com/course/preview/active-directory-bloodhound/bloodhound--data-collection
author: C.J. May
date: 2022-08-09
modified: 2023-03-29
tags:
- attack.discovery
- attack.t1087.001
- attack.t1087.002
- attack.t1482
- attack.t1069.001
- attack.t1069.002
- attack.execution
- attack.t1059.001
logsource:
  product: windows
  category: file_event
detection:
  selection:
    TargetFilename|endswith:
    - 'BloodHound.zip'
    - '_computers.json'
    - '_containers.json'
    - '_domains.json'
    - '_gpos.json'
    - '_groups.json'
    - '_ous.json'
    - '_users.json'
  filter_optional_ms_winapps:
    Image|endswith: '\svchost.exe'
    TargetFilename|startswith: 'C:\Program Files\WindowsApps\Microsoft.'
    TargetFilename|endswith: '\pocket_containers.json'
  condition: selection and not 1 of filter_optional_*
falsepositives:
- Some false positives may arise in some environment and this may require some tuning.
  Add additional filters or reduce level depending on the level of noise
level: high
notes: |
  n
  ### Technical Context
  The BloodHound Collection Files Sigma rule detects instances where the BloodHound data collection tool, SharpHound, outputs default file names indicative of potentially malicious activity in an Active Directory (AD) environment. The rule specifically looks for file events where the target filenames end with known BloodHound output such as `BloodHound.zip`, `_users.json`, `_computers.json`, and others. This rule utilizes Windows file event logging as its data source, focusing on the creation or modification of files that match these patterns. Since BloodHound is often used by attackers to gather detailed information about AD configurations and user relationships, detecting the generation of these files can signal unauthorized reconnaissance activities within the network. The relevant MITRE ATT&CK techniques include `T1087.001` (Account enumeration: User), `T1087.002` (Account enumeration: Group), `T1482` (Domain Group Discovery), and others associated with discovery and execution processes.
  ### Investigation Steps
  - **Verify File Creation:** Check the file paths and creation timestamps in the Windows Security and Application logs to confirm the legitimacy of the detected files. Identify any unexpected sources or patterns indicating potential misuse of the BloodHound tool.
    
  - **Analyze User Context:** Use EDR tools to analyze the user account that created the BloodHound files. Investigate if this account has legitimate access to perform such actions and whether any suspicious activities are linked to it.
  - **Inspect Process Activity:** Review process creation logs (Sysmon) around the same timeframe whenever the BloodHound files were created. Look for executables or scripts that initiated the collection, paying close attention to any atypical process chains.
  - **Check Network Activity:** Correlate the file creation events with network connection logs (NDR) to assess whether the BloodHound tool communicated with external servers or engaged in unusual traffic patterns, which could suggest data exfiltration or command-and-control activity.
  ### Prioritization
  The alert generated by this rule is considered high severity because the presence of BloodHound collection files typically indicates a serious security risk, specifically in identifying potential threats targeting the integrity of the Active Directory environment.
  ### Blind spots and Assumptions
  This rule may not fire if the BloodHound tool is executed in an environment where its file output patterns are altered, or if the monitoring of relevant file creation events is not enabled. Additionally, higher privileged users might routinely generate these files for legitimate administrative purposes, potentially leading to false positives. It is assumed that all production systems are monitored; thus, if they are selectively logged, this detection may yield incomplete visibility.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality and relevance, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
