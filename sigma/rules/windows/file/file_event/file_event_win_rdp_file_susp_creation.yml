title: .RDP File Created By Uncommon Application
id: fccfb43e-09a7-4bd2-8b37-a5a7df33386d
related:
- id: f748c45a-f8d3-4e6f-b617-fe176f695b8f
  type: derived
status: test
description: |
  Detects creation of a file with an ".rdp" extension by an application that doesn't commonly create such files.
references:
- https://www.blackhillsinfosec.com/rogue-rdp-revisiting-initial-access-methods/
- https://web.archive.org/web/20230726144748/https://blog.thickmints.dev/mintsights/detecting-rogue-rdp/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-04-18
modified: 2024-11-01
tags:
- attack.defense-evasion
logsource:
  product: windows
  category: file_event
detection:
  selection:
    TargetFilename|endswith: '.rdp'
    Image|endswith:
            # Covers browsers
    - '\brave.exe'
    - '\CCleaner Browser\Application\CCleanerBrowser.exe'
    - '\chromium.exe'
    - '\firefox.exe'
    - '\Google\Chrome\Application\chrome.exe'
    - '\iexplore.exe'
    - '\microsoftedge.exe'
    - '\msedge.exe'
    - '\Opera.exe'
    - '\Vivaldi.exe'
    - '\Whale.exe'
            # Covers email clients
    - '\olk.exe'         # Outlook
    - '\Outlook.exe'
    - '\RuntimeBroker.exe'         # If the windows mail client is used
    - '\Thunderbird.exe'
            # Covers chat applications
    - '\Discord.exe'         # Should open the browser for download, but just in case.
    - '\Keybase.exe'
    - '\msteams.exe'
    - '\Slack.exe'
    - '\teams.exe'
  condition: selection
falsepositives:
- Unknown
level: high
notes: |
  n
  ### Technical Context
  This detection rule identifies the creation of Remote Desktop Protocol (RDP) files, which have the `.rdp` file extension, by applications that are not typically associated with such actions. Specifically, the rule focuses on monitoring file events generated by a variety of applications, such as web browsers (e.g., Chrome, Firefox), email clients (e.g., Outlook, Thunderbird), and chat applications (e.g., Teams, Discord). The detection leverages Windows file event logs to inspect file creation activities and cross-references the originating application against a pre-defined list of uncommon RDP file creators. 
  The significance of this detection lies in its capacity to flag potential suspicious behavior that could indicate an attempt at unauthorized remote access or lateral movement within an environment. It aligns with the MITRE ATT&CK tactic of Defense Evasion, specifically the technique of creating files with potentially malicious intent to bypass security measures.
  ### Investigation Steps
  - **Verify File Origin:** Retrieve the details of the detected `.rdp` file creation event using EDR or Windows Security logs to ascertain the application responsible for the action.
  - **Analyze Process Tree:** Utilize EDR to examine the process creation tree leading to the creation of the `.rdp` file to identify any unusual or unauthorized activity preceding this action.
  - **Check for User Activity:** Cross-reference the timestamp of the file creation with user activities logged in service logs or email communications to validate whether the action was legitimate.
  - **Network Connection Review:** Analyze network logs (NDR and NGFW) for any outbound connections made from the creating application around the same timeframe to look for suspicious RDP connections.
  ### Prioritization
  The alert holds a high severity level due to the potential implications of unauthorized remote access facilitated by malicious or compromised software, which could lead to broader security breaches within the organization.
  ### Blind Spots and Assumptions
  This rule may not fire if the application creating the `.rdp` file is not included in the defined list, or if the creation occurs via other means that circumvent file event logging. Moreover, certain legitimate applications may exhibit similar behavior without malicious intent, potentially leading to false positives. It is essential for detection engineers to continuously update the list of monitored applications based on evolving software usage patterns in the enterprise to enhance detection efficacy.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
