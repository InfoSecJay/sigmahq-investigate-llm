title: Process Monitor Driver Creation By Non-Sysinternals Binary
id: a05baa88-e922-4001-bc4d-8738135f27de
status: test
description: Detects creation of the Process Monitor driver by processes other than
  Process Monitor (procmon) itself.
references:
- Internal Research
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023-05-05
tags:
- attack.persistence
- attack.privilege-escalation
- attack.t1068
logsource:
  product: windows
  category: file_event
detection:
  selection:
    TargetFilename|contains: '\procmon'
    TargetFilename|endswith: '.sys'
  filter_main_process_explorer:
    Image|endswith:
    - '\procmon.exe'
    - '\procmon64.exe'
  condition: selection and not 1 of filter_main_*
falsepositives:
- Some false positives may occur with legitimate renamed process monitor binaries
level: medium
notes: |
  ### Technical Context
  This detection rule is designed to identify potential unauthorized or malicious attempts to manipulate the Process Monitor driver (`procmon.sys`) by processes that are not the official Process Monitor application (i.e., `procmon.exe` or `procmon64.exe`). It focuses on file events on Windows systems, particularly monitoring for the creation of driver files that contain "procmon" in their name and end with the `.sys` extension. By filtering out the legitimate Process Monitor processes, the rule aims to detect attempts at privilege escalation or persistence tactics (MITRE ATT&CK Tactic: **Persistence**, Technique: **T1068**). When all the conditions are met, an alert is triggered, signaling potential misuse or threat activity.
  ### Investigation Steps
  - **Review Process Creation Logs**: Examine the Windows Security event logs for any associated process creation events leading to the creation of the suspicious driver. Take note of the user context under which the event occurred.
  - **Correlate with EDR Insights**: Utilize endpoint detection and response (EDR) tools to check for anomalies or suspicious behavior linked to the processes involved. Look for any unusual parent-child process relationships or flags indicating abnormal execution.
  - **Analyze Network Connections**: Check for any outbound or suspicious network activity generated by the processes related to this alert. Utilize your Network Detection and Response (NDR) tools to find any unauthorized external communications.
  - **Examine File Integrity**: Use file integrity monitoring tools or filesystem logs to determine if there were any unauthorized modifications to the driver files or their locations. Compare these findings against a known baseline of your file system.
  ### Prioritization
  The alert is assigned a medium severity level as the creation of the `procmon.sys` driver by unauthorized processes can indicate an attempted privilege escalation or persistence threat, which if left unchecked, could lead to more significant compromise.
  ### Blind Spots and Assumptions
  This rule may generate false positives when legitimate renamed versions of Process Monitor are utilized in an enterprise environment. Additionally, the detection relies on the presence of file event logging, which may not capture all instances if logging policies are misconfigured. It assumes that no legitimate reasons exist for processes other than `procmon.exe` to create the Process Monitor driver, which may not hold true in all contexts, especially with custom monitoring tools that could mimic this behavior.
  > **Disclaimer:** This investigation guide was created using generative AI technology and has not been reviewed for its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit specific environment and operational needs. Please communicate any changes to the detection engineering team.
